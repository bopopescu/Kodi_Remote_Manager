import base64;exec base64.b64decode('IyAtKi0gY29kaW5nOiB1dGYtOCAtKi0KaW1wb3J0IHVybGxpYgppbXBvcnQgdXJsbGliMgppbXBvcnQgZGF0ZXRpbWUKaW1wb3J0IHJlCmltcG9ydCBvcwppbXBvcnQgYmFzZTY0CmltcG9ydCB4Ym1jcGx1Z2luCmltcG9ydCB4Ym1jZ3VpCmltcG9ydCB4Ym1jYWRkb24KaW1wb3J0IHhibWN2ZnMKaW1wb3J0IHRyYWNlYmFjawppbXBvcnQgY29va2llbGliCmZyb20gQmVhdXRpZnVsU291cCBpbXBvcnQgQmVhdXRpZnVsU3RvbmVTb3VwLCBCZWF1dGlmdWxTb3VwLCBCZWF1dGlmdWxTT0FQCnRyeToKICAgIGltcG9ydCBqc29uCmV4Y2VwdDoKICAgIGltcG9ydCBzaW1wbGVqc29uIGFzIGpzb24KaW1wb3J0IHRpbWUKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCBfRWRpdAoKTmZsID0gJycKRm9vdGJhbGwgPSAnJwpDcmlja2V0ID0gJycKVGVubmlzID0gJycgCkJveGluZyA9ICcnCkdvbGYgPSAnJwpNb3RvcnNwb3J0cyA9ICcnClJ1Z2J5ID0gJycKSG9ja2V5ID0gJycKTmJhID0gJycKRGFydHMgPSAnJwpXd2UgPSAnJwpIb3JzZV9SYWNpbmcgPSAnJwpVZmMgPSAnJwpCYXNlYmFsbCA9ICcnCgkKcmVzb2x2ZV91cmw9WycxZmljaGllci5jb20nLCAnYWxsZGVicmlkLmNvbScsICdhbGxteXZpZGVvcy5uZXQnLCAnYWxsdmlkLmNoJywgJ2F1ZW5naW5lLmNvbScsICdiZXN0c3RyZWFtcy5uZXQnLCAnYnJpc2tmaWxlLmNvbScsICdjYXN0YW1wLmNvbScsICdjbGlja251cGxvYWQuY29tJywgJ2NsaWNrbnVwbG9hZC5tZScsICdjbGlja251cGxvYWQubGluaycsICdjbG91ZHkuZWMnLCAnY2xvdWR6aWxsYS50bycsICduZW9kcml2ZS5jbycsICdjcnVuY2h5cm9sbC5jb20nLCAnZGFjbGlwcy5pbicsICdkYWNsaXBzLmNvbScsICdkYWlseW1vdGlvbi5jb20nLCAnZGl2eHN0YWdlLmV1JywgJ2RpdnhzdGFnZS5uZXQnLCAnZGl2eHN0YWdlLnRvJywgJ2NvdWxkdGltZS50bycsICdlY29zdHJlYW0udHYnLCAnZXhhc2hhcmUuY29tJywgJ2VzdHJlYW0udG8nLCAnZmFjZWJvb2suY29tJywgJ2Zhc3RwbGF5LmNjJywgJ2Zhc3RwbGF5LnRvJywgJ2Zhc3RwbGF5LnN4JywgJ2ZpbGVob290LmNvbScsICdmaWxlbnVrZS5jb20nLCAnZmlsZXB1cC5uZXQnLCAnZmlsbXNob3dvbmxpbmUubmV0JywgJ2ZsYXNoeC50dicsICdwbHVzLmdvb2dsZS5jb20nLCAnZ29vZ2xldmlkZW8uY29tJywgJ3BpY2FzYXdlYi5nb29nbGUuY29tJywgJ2dvb2dsZXVzZXJjb250ZW50LmNvbScsICdnb29nbGVkcml2ZS5jb20nLCAnZ29yaWxsYXZpZC5pbicsICdnb3JpbGxhdmlkLmNvbScsICdnb3JpbGxhdmlkLmluJywgJ2dyaWZ0aG9zdC5jb20nLCAnaHVnZWZpbGVzLm5ldCcsICdpZG93YXRjaC5uZXQnLCAnaW5kYXZpZGVvLmh1JywgJ2lzaGFyZWQuZXUnLCAnamV0bG9hZC50dicsICdraW5nZmlsZXMubmV0JywgJ2xldHdhdGNoLnVzJywgJ2xldHdhdGNoLnRvJywgJ3ZpZHNoYXJlLnVzJywgJ21haWwucnUnLCAnbXkubWFpbC5ydScsICd2aWRlb2FwaS5teS5tYWlsLnJ1JywgJ2FwaS52aWRlby5tYWlsLnJ1JywgJ21lZ2EtZGVicmlkLmV1JywgJ21lZ2FtcDQubmV0JywgJ21lcnNhbGFheWl0dGVuLmNvbScsICdtb3ZkaXZ4LmNvbScsICdtb3Zwb2QubmV0JywgJ21vdnBvZC5pbicsICdtb3ZzaGFyZS5uZXQnLCAnd2hvbGVjbG91ZC5uZXQnLCAnbXA0ZW5naW5lLmNvbScsICdtcDRzdHJlYW0uY29tJywgJ21wNHVwbG9hZC5jb20nLCAnbXl2aWRzdHJlYW0ubmV0JywgJ25vc3ZpZGVvLmNvbScsICdub3Nsb2NrZXIuY29tJywgJ2F1cm9yYXZpZC50bycsICdub3ZhbW92LmNvbScsICdub3d2aWRlby5zeCcsICdub3d2aWRlby5ldScsICdub3d2aWRlby5jaCcsICdub3d2aWRlby5zeCcsICdub3d2aWRlby5jbycsICdub3d2aWRlby5saScsICdub3d2aWRlby5lYycsICdub3d2aWRlby5hdCcsICdub3d2aWRlby5mbycsICdvay5ydScsICdvZG5va2xhc3NuaWtpLnJ1JywgJ29wZW5sb2FkLmlvJywgJ29wZW5sb2FkLmNvJywgJ3BsYXk0NC5uZXQnLCAncGxheWVkLnRvJywgJ3BsYXloZC52aWRlbycsICdwbGF5aGQuZm8nLCAncGxheXUubmV0JywgJ3BsYXl1Lm1lJywgJ3BsYXl3aXJlLmNvbScsICdQcmVtaXVtaXplLm1lJywgJ3ByaW1lc2hhcmUudHYnLCAncHJvbXB0ZmlsZS5jb20nLCAncHVyZXZpZC5jb20nLCAncmFwaWR2aWRlby53cycsICdyYXBpZHZpZGVvLmNvbScsICdyZy50bycsICdhcGkucmVhbC1kZWJyaWQuY29tJywgJ3ByZW1pdW0ucnBuZXQuYml6JywgJ3J1dHViZS5ydScsICdzaGFyZWQyLm1lJywgJ3NoYXJlZC5zeCcsICdzaGFyZXJlcG8uY29tJywgJ3NoYXJlc2l4LmNvbScsICdzaW1wbHktZGVicmlkLmNvbScsICdzcGVlZHBsYXkueHl6JywgJ3NwZWVkcGxheS51cycsICdzcGVlZHBsYXkzLnB3JywgJ3NwZWVkdmlkZW8ubmV0JywgJ3N0YWdldnUuY29tJywgJ3N0cmVhbWNsb3VkLmV1JywgJ3N0cmVhbWluLnRvJywgJ3N0cmVhbS5tb2UnLCAnc3RyZWFtYW5nby5jb20nLCAnc3RyZWFtY2hlcnJ5LmNvbScsICd0ZXJhbWl4ZXIuY29tJywgJ3RoZXZpZGVvLm1lJywgJ3RoZXZpZC5uZXQnLCAndGhldmlkZW9zLnR2JywgJ3RvbHRzZC1mZWwudGsnLCAndHJvbGx2aWQubmV0JywgJ3R1bmUucGsnLCAndHVzZmlsZXMubmV0JywgJ3R3aXRjaC50dicsICd1cDJzdHJlYW0uY29tJywgJ3VwbG9hZC5hZicsICd1cGxvYWRjLmNvbScsICd1cGxvYWRjLmNoJywgJ3phbGFhLmNvbScsICd1cGxvYWR4Lm9yZycsICd1cHRvYm94LmNvbScsICd1cHRvc3RyZWFtLmNvbScsICd1c2VyZmlsZXMuY29tJywgJ3VzZXJzY2xvdWQuY29tJywgJ3ZlZWhkLmNvbScsICd2ZW9oLmNvbScsICd2aWQuYWcnLCAndmlkYnVsbC5jb20nLCAndmlkY3JhenkubmV0JywgJ3VwbG9hZGNyYXp5Lm5ldCcsICd0aGV2aWRlb2JlZS50bycsICd2aWRlb2JveGVyLmNvJywgJ3ZpZGdnLnRvJywgJ3ZpZC5nZycsICd2aWRlb2h1dC50bycsICd2aWRlb21lZ2EudHYnLCAndmlkZW9yYWoudG8nLCAndmlkZW9yZXYuY2MnLCAndmlkZW9za3kudG8nLCAndmlkZW8udHQnLCAndmlkZW93ZWVkLmVzJywgJ2JpdHZpZC5zeCcsICd2aWRlb3dlZWQuY29tJywgJ3ZpZGVvd29vZC50dicsICdieXpvby5vcmcnLCAncGxheXBhbmRhLm5ldCcsICd2aWRlb3pvby5tZScsICd2aWRlb3dpbmcubWUnLCAndmlkZW93aW5nLm1lJywgJ2Vhc3l2aWRlby5tZScsICdwbGF5NDQubmV0JywgJ3BsYXliYi5tZScsICd2aWRlbzQ0Lm5ldCcsICd2aWRpby5zeCcsICd2aWRsb3gudHYnLCAndmlkLm1lJywgJ3ZpZHNwb3QubmV0JywgJ3ZpZHRvLm1lJywgJ3ZpZHVwLm1lJywgJ3ZpZHVwLm9yZycsICd2aWR6aS50dicsICd2aW1lby5jb20nLCAndml2by5zeCcsICd2ay5jb20nLCAndmtwYXNzLmNvbScsICd2b2Rsb2NrZXIuY29tJywgJ3ZzaGFyZS5pbycsICd2c2hhcmUuZXUnLCAnd2F0Y2hlcnMudG8nLCAnd2F0Y2hvbmxpbmUudG8nLCAnd2F0Y2h2aWRlby51cycsICd3YXRjaHZpZGVvMi51cycsICd3YXRjaHZpZGVvMy51cycsICd3YXRjaHZpZGVvNC51cycsICd3YXRjaHZpZGVvNS51cycsICd3YXRjaHZpZGVvNi51cycsICd3YXRjaHZpZGVvNy51cycsICd3YXRjaHZpZGVvOC51cycsICd3YXRjaHZpZGVvOS51cycsICd3ZXNoYXJlLm1lJywgJ3h2aWRzdGFnZS5jb20nLCAneW91bG9sLmJpeicsICdzaGl0bW92aWUuY29tJywgJ3lvdXJ1cGxvYWQuY29tJywgJ3lvdXR1YmUuY29tJywgJ3lvdXR1LmJlJywgJ3lvdXdhdGNoLm9yZycsICdhcGkuemV2ZXJhLmNvbScsICd6ZXR0YWhvc3QudHYnLCAnenN0cmVhbS50byddCmdfaWdub3JlU2V0UmVzb2x2ZWQ9WydwbHVnaW4udmlkZW8uZHJhbWFzb25saW5lJywncGx1Z2luLnZpZGVvLmY0bVRlc3RlcicsJ3BsdWdpbi52aWRlby5zaGFoaWRtYmNuZXQnLCdwbHVnaW4udmlkZW8uU3BvcnRzRGV2aWwnLCdwbHVnaW4uc3RyZWFtLnZhdWdobmxpdmUudHYnLCdwbHVnaW4udmlkZW8uWmVtVFYtc2hhbmknXQoKY2xhc3MgTm9SZWRpcmVjdGlvbih1cmxsaWIyLkhUVFBFcnJvclByb2Nlc3Nvcik6CiAgIGRlZiBodHRwX3Jlc3BvbnNlKHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgIHJldHVybiByZXNwb25zZQogICBodHRwc19yZXNwb25zZSA9IGh0dHBfcmVzcG9uc2UKICAgICAgIAphZGRvbiA9IF9FZGl0LmFkZG9uCmFkZG9uX3ZlcnNpb24gPSBhZGRvbi5nZXRBZGRvbkluZm8oJ3ZlcnNpb24nKQpwcm9maWxlID0geGJtYy50cmFuc2xhdGVQYXRoKGFkZG9uLmdldEFkZG9uSW5mbygncHJvZmlsZScpLmRlY29kZSgndXRmLTgnKSkKaG9tZSA9IHhibWMudHJhbnNsYXRlUGF0aChhZGRvbi5nZXRBZGRvbkluZm8oJ3BhdGgnKS5kZWNvZGUoJ3V0Zi04JykpCmZhdm9yaXRlcyA9IG9zLnBhdGguam9pbihwcm9maWxlLCAnZmF2b3JpdGVzJykKaGlzdG9yeSA9IG9zLnBhdGguam9pbihwcm9maWxlLCAnaGlzdG9yeScpCgpSRVYgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ2xpc3RfcmV2aXNpb24nKQppY29uID0gb3MucGF0aC5qb2luKGhvbWUsICdpY29uLnBuZycpCkZBTkFSVCA9IG9zLnBhdGguam9pbihob21lLCAnZmFuYXJ0LmpwZycpCnNvdXJjZV9maWxlID0gb3MucGF0aC5qb2luKHByb2ZpbGUsICdzb3VyY2VfZmlsZScpCmZ1bmN0aW9uc19kaXIgPSBwcm9maWxlCmRlYnVnID0gYWRkb24uZ2V0U2V0dGluZygnZGVidWcnKQppZiBvcy5wYXRoLmV4aXN0cyhmYXZvcml0ZXMpPT1UcnVlOgogICAgRkFWID0gb3BlbihmYXZvcml0ZXMpLnJlYWQoKQplbHNlOiBGQVYgPSBbXQppZiBvcy5wYXRoLmV4aXN0cyhzb3VyY2VfZmlsZSk9PVRydWU6CiAgICBTT1VSQ0VTID0gb3Blbihzb3VyY2VfZmlsZSkucmVhZCgpCmVsc2U6IFNPVVJDRVMgPSBbXQoKCmRlZiBhZGRvbl9sb2coc3RyaW5nKToKICAgIGlmIGRlYnVnID09ICd0cnVlJzoKICAgICAgICB4Ym1jLmxvZygiW2FkZG9uLmxpdmUuR2VuLVggTGlzdHMtJXNdOiAlcyIgJShhZGRvbl92ZXJzaW9uLCBzdHJpbmcpKQoKCmRlZiBtYWtlUmVxdWVzdCh1cmwsIGhlYWRlcnM9Tm9uZSk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBoZWFkZXJzIGlzIE5vbmU6CiAgICAgICAgICAgICAgICBoZWFkZXJzID0geydVc2VyLWFnZW50JyA6ICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjE7IFdPVzY0OyBydjoxOS4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzE5LjAnfQogICAgICAgICAgICByZXEgPSB1cmxsaWIyLlJlcXVlc3QodXJsLE5vbmUsaGVhZGVycykKICAgICAgICAgICAgcmVzcG9uc2UgPSB1cmxsaWIyLnVybG9wZW4ocmVxKQogICAgICAgICAgICBkYXRhID0gcmVzcG9uc2UucmVhZCgpCiAgICAgICAgICAgIHJlc3BvbnNlLmNsb3NlKCkKICAgICAgICAgICAgcmV0dXJuIGRhdGEKICAgICAgICBleGNlcHQgdXJsbGliMi5VUkxFcnJvciwgZToKICAgICAgICAgICAgYWRkb25fbG9nKCdVUkw6ICcrdXJsKQogICAgICAgICAgICBpZiBoYXNhdHRyKGUsICdjb2RlJyk6CiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ1dlIGZhaWxlZCB3aXRoIGVycm9yIGNvZGUgLSAlcy4nICUgZS5jb2RlKQogICAgICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oR2VuLVgsV2UgZmFpbGVkIHdpdGggZXJyb3IgY29kZSAtICIrc3RyKGUuY29kZSkrIiwxMDAwMCwiK2ljb24rIikiKQogICAgICAgICAgICBlbGlmIGhhc2F0dHIoZSwgJ3JlYXNvbicpOgogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdXZSBmYWlsZWQgdG8gcmVhY2ggYSBzZXJ2ZXIuJykKICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnUmVhc29uOiAlcycgJWUucmVhc29uKQogICAgICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oR2VuLVgsV2UgZmFpbGVkIHRvIHJlYWNoIGEgc2VydmVyLiAtICIrc3RyKGUucmVhc29uKSsiLDEwMDAwLCIraWNvbisiKSIpCgoJCQkJCmRlZiBTS2luZGV4KCk6CiAgICBhZGRvbl9sb2coIlNLaW5kZXgiKQogICAgZ2V0RGF0YShfRWRpdC5NYWluQmFzZSwnJykKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKCQkKZGVmIE9wZW5fVXJsKHVybCk6CiAgICByZXEgPSB1cmxsaWIyLlJlcXVlc3QodXJsKQogICAgcmVxLmFkZF9oZWFkZXIoJ1VzZXItQWdlbnQnLCAnTW96aWxsYS81LjAgKFdpbmRvd3M7IFU7IFdpbmRvd3MgTlQgNS4xOyBlbi1HQjsgcnY6MS45LjAuMykgR2Vja28vMjAwODA5MjQxNyBGaXJlZm94LzMuMC4zJykKICAgIHJlc3BvbnNlID0gJycKICAgIGxpbmsgPSAnJwogICAgdHJ5OiAKICAgICAgICByZXNwb25zZSA9IHVybGxpYjIudXJsb3BlbihyZXEpCiAgICAgICAgbGluaz1yZXNwb25zZS5yZWFkKCkKICAgICAgICByZXNwb25zZS5jbG9zZSgpCiAgICBleGNlcHQ6IHBhc3MKICAgIGlmIGxpbmsgIT0gJyc6CiAgICAgICAgcmV0dXJuIGxpbmsKICAgIGVsc2U6CiAgICAgICAgbGluayA9ICdPcGVuZWQnCiAgICAgICAgcmV0dXJuIGxpbmsKCQpkZWYgU2VhcmNoX2lucHV0KHVybCk6CiAgICBEaWFsb2cgPSB4Ym1jZ3VpLkRpYWxvZygpCiAgICBTZWFyY2hfdGl0bGUgPSBEaWFsb2cuaW5wdXQoJ1NlYXJjaCcsIHR5cGU9eGJtY2d1aS5JTlBVVF9BTFBIQU5VTSkKICAgIFNlYXJjaF9uYW1lID0gU2VhcmNoX3RpdGxlLmxvd2VyKCkKICAgIGlmIFNlYXJjaF9uYW1lID09ICcnOgogICAgICAgIHBhc3MKICAgIGVsc2U6CiAgICAgICAgU2VhcmNoX2xvb3AoU2VhcmNoX25hbWUsdXJsKSAgICAKCQpkZWYgU2VhcmNoX2xvb3AoU2VhcmNoX25hbWUsdXJsKToKICAgIEhUTUwgPSBPcGVuX1VybCh1cmwpCiAgICBpZiBIVE1MICE9ICdGYWlsZWQnOgogICAgICAgIG1hdGNoID0gcmUuY29tcGlsZSgnPGNoYW5uZWw+Lis/PG5hbWU+KC4rPyk8L25hbWU+Lis/PHRodW1ibmFpbD4oLis/KTwvdGh1bWJuYWlsPi4rPzxleHRlcm5hbGxpbms+KC4rPyk8L2V4dGVybmFsbGluaz4uKz88ZmFuYXJ0PiguKz8pPC9mYW5hcnQ+Lis/PC9jaGFubmVsPicscmUuRE9UQUxMKS5maW5kYWxsKEhUTUwpCiAgICAgICAgZm9yIG5hbWUsaW1hZ2UsdXJsLGZhbmFydCBpbiBtYXRjaDoKICAgICAgICAgICAgaWYgbm90ICdodHRwOicgaW4gdXJsOgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgU2VhcmNoX2xvb3AoU2VhcmNoX25hbWUsdXJsKQogICAgICAgIG1hdGNoMiA9IHJlLmNvbXBpbGUoJzx0aXRsZT4oLis/KTwvdGl0bGU+Lis/PGxpbms+KC4rPyk8L2xpbms+Lis/PHRodW1ibmFpbD4oLis/KTwvdGh1bWJuYWlsPi4rPzxmYW5hcnQ+KC4rPyk8L2ZhbmFydD4nLHJlLkRPVEFMTCkuZmluZGFsbChIVE1MKQogICAgICAgIGZvciBuYW1lLHVybCxpbWFnZSxmYW5hcnQgaW4gbWF0Y2gyOgogICAgICAgICAgICBpZiAnaHR0cDonIGluIHVybDoKICAgICAgICAgICAgICAgIGlmIFNlYXJjaF9uYW1lLmxvd2VyKCkgaW4gbmFtZS5sb3dlcigpOgogICAgICAgICAgICAgICAgICAgIGFkZExpbmsodXJsLCBuYW1lLGltYWdlLGZhbmFydCwnJywnJywnJywnJyxOb25lLCcnLDEpCgkJCgkJCmRlZiBnZXRTb3VyY2VzKCk6CiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoZmF2b3JpdGVzKSA9PSBUcnVlOgogICAgICAgICAgICBhZGREaXIoJ0Zhdm9yaXRlcycsJ3VybCcsNCxvcy5wYXRoLmpvaW4oaG9tZSwgJ3Jlc291cmNlcycsICdmYXZvcml0ZS5wbmcnKSxGQU5BUlQsJycsJycsJycsJycpCiAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygiYnJvd3NlX3htbF9kYXRhYmFzZSIpID09ICJ0cnVlIjoKICAgICAgICAgICAgYWRkRGlyKCdYTUwgRGF0YWJhc2UnLCdodHRwOi8veGJtY3BsdXMueGIuZnVucGljLmRlL3d3dy1kYXRhL2ZpbGVzeXN0ZW0vJywxNSxpY29uLEZBTkFSVCwnJywnJywnJywnJykKICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCJicm93c2VfY29tbXVuaXR5IikgPT0gInRydWUiOgogICAgICAgICAgICBhZGREaXIoJ0NvbW11bml0eSBGaWxlcycsJ2NvbW11bml0eV9maWxlcycsMTYsaWNvbixGQU5BUlQsJycsJycsJycsJycpCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoaGlzdG9yeSkgPT0gVHJ1ZToKICAgICAgICAgICAgYWRkRGlyKCdTZWFyY2ggSGlzdG9yeScsJ2hpc3RvcnknLDI1LG9zLnBhdGguam9pbihob21lLCAncmVzb3VyY2VzJywgJ2Zhdm9yaXRlLnBuZycpLEZBTkFSVCwnJywnJywnJywnJykKICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCJzZWFyY2h5dCIpID09ICJ0cnVlIjoKICAgICAgICAgICAgYWRkRGlyKCdTZWFyY2g6WW91dHViZScsJ3lvdXR1YmUnLDI1LGljb24sRkFOQVJULCcnLCcnLCcnLCcnKQogICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoInNlYXJjaERNIikgPT0gInRydWUiOgogICAgICAgICAgICBhZGREaXIoJ1NlYXJjaDpkYWlseW1vdGlvbicsJ2Rtb3Rpb24nLDI1LGljb24sRkFOQVJULCcnLCcnLCcnLCcnKQogICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoIlB1bHNhck0iKSA9PSAidHJ1ZSI6CiAgICAgICAgICAgIGFkZERpcignUHVsc2FyOklNREInLCdJTURCaWRwbGF5JywyNyxpY29uLEZBTkFSVCwnJywnJywnJywnJykgICAgICAgICAgICAKICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhzb3VyY2VfZmlsZSk9PVRydWU6CiAgICAgICAgICAgIHNvdXJjZXMgPSBqc29uLmxvYWRzKG9wZW4oc291cmNlX2ZpbGUsInIiKS5yZWFkKCkpCiAgICAgICAgICAgICNwcmludCAnc291cmNlcycsc291cmNlcwogICAgICAgICAgICBpZiBsZW4oc291cmNlcykgPiAxOgogICAgICAgICAgICAgICAgZm9yIGkgaW4gc291cmNlczoKICAgICAgICAgICAgICAgICAgICAjIyBmb3IgcHJlIDEuMC44IHNvdXJjZXMKICAgICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKGksIGxpc3QpOgogICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIoaVswXS5lbmNvZGUoJ3V0Zi04JyksaVsxXS5lbmNvZGUoJ3V0Zi04JyksMSxpY29uLEZBTkFSVCwnJywnJywnJywnJywnc291cmNlJykKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICB0aHVtYiA9IGljb24KICAgICAgICAgICAgICAgICAgICAgICAgZmFuYXJ0ID0gRkFOQVJUCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2MgPSAnJwogICAgICAgICAgICAgICAgICAgICAgICBkYXRlID0gJycKICAgICAgICAgICAgICAgICAgICAgICAgY3JlZGl0cyA9ICcnCiAgICAgICAgICAgICAgICAgICAgICAgIGdlbnJlID0gJycKICAgICAgICAgICAgICAgICAgICAgICAgaWYgaS5oYXNfa2V5KCd0aHVtYm5haWwnKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRodW1iID0gaVsndGh1bWJuYWlsJ10KICAgICAgICAgICAgICAgICAgICAgICAgaWYgaS5oYXNfa2V5KCdmYW5hcnQnKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbmFydCA9IGlbJ2ZhbmFydCddCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuaGFzX2tleSgnZGVzY3JpcHRpb24nKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2MgPSBpWydkZXNjcmlwdGlvbiddCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuaGFzX2tleSgnZGF0ZScpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZSA9IGlbJ2RhdGUnXQogICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmhhc19rZXkoJ2dlbnJlJyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZW5yZSA9IGlbJ2dlbnJlJ10KICAgICAgICAgICAgICAgICAgICAgICAgaWYgaS5oYXNfa2V5KCdjcmVkaXRzJyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVkaXRzID0gaVsnY3JlZGl0cyddCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihpWyd0aXRsZSddLmVuY29kZSgndXRmLTgnKSxpWyd1cmwnXS5lbmNvZGUoJ3V0Zi04JyksMSx0aHVtYixmYW5hcnQsZGVzYyxnZW5yZSxkYXRlLGNyZWRpdHMsJ3NvdXJjZScpCgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaWYgbGVuKHNvdXJjZXMpID09IDE6CiAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShzb3VyY2VzWzBdLCBsaXN0KToKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0RGF0YShzb3VyY2VzWzBdWzFdLmVuY29kZSgndXRmLTgnKSxGQU5BUlQpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0RGF0YShzb3VyY2VzWzBdWyd1cmwnXSwgc291cmNlc1swXVsnZmFuYXJ0J10pCgoKZGVmIGFkZFNvdXJjZSh1cmw9Tm9uZSk6CiAgICAgICAgaWYgdXJsIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIG5vdCBhZGRvbi5nZXRTZXR0aW5nKCJuZXdfZmlsZV9zb3VyY2UiKSA9PSAiIjoKICAgICAgICAgICAgICAgc291cmNlX3VybCA9IGFkZG9uLmdldFNldHRpbmcoJ25ld19maWxlX3NvdXJjZScpLmRlY29kZSgndXRmLTgnKQogICAgICAgICAgICBlbGlmIG5vdCBhZGRvbi5nZXRTZXR0aW5nKCJuZXdfdXJsX3NvdXJjZSIpID09ICIiOgogICAgICAgICAgICAgICBzb3VyY2VfdXJsID0gYWRkb24uZ2V0U2V0dGluZygnbmV3X3VybF9zb3VyY2UnKS5kZWNvZGUoJ3V0Zi04JykKICAgICAgICBlbHNlOgogICAgICAgICAgICBzb3VyY2VfdXJsID0gdXJsCiAgICAgICAgaWYgc291cmNlX3VybCA9PSAnJyBvciBzb3VyY2VfdXJsIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIGFkZG9uX2xvZygnQWRkaW5nIE5ldyBTb3VyY2U6ICcrc291cmNlX3VybC5lbmNvZGUoJ3V0Zi04JykpCgogICAgICAgIG1lZGlhX2luZm8gPSBOb25lCiAgICAgICAgI3ByaW50ICdzb3VyY2VfdXJsJyxzb3VyY2VfdXJsCiAgICAgICAgZGF0YSA9IGdldFNvdXAoc291cmNlX3VybCkKICAgICAgICBwcmludCAnc291cmNlX3VybCcsc291cmNlX3VybAogICAgICAgIGlmIGlzaW5zdGFuY2UoZGF0YSxCZWF1dGlmdWxTT0FQKToKICAgICAgICAgICAgaWYgZGF0YS5maW5kKCdjaGFubmVsc19pbmZvJyk6CiAgICAgICAgICAgICAgICBtZWRpYV9pbmZvID0gZGF0YS5jaGFubmVsc19pbmZvCiAgICAgICAgICAgIGVsaWYgZGF0YS5maW5kKCdpdGVtc19pbmZvJyk6CiAgICAgICAgICAgICAgICBtZWRpYV9pbmZvID0gZGF0YS5pdGVtc19pbmZvCiAgICAgICAgaWYgbWVkaWFfaW5mbzoKICAgICAgICAgICAgc291cmNlX21lZGlhID0ge30KICAgICAgICAgICAgc291cmNlX21lZGlhWyd1cmwnXSA9IHNvdXJjZV91cmwKICAgICAgICAgICAgdHJ5OiBzb3VyY2VfbWVkaWFbJ3RpdGxlJ10gPSBtZWRpYV9pbmZvLnRpdGxlLnN0cmluZwogICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICAgICAgdHJ5OiBzb3VyY2VfbWVkaWFbJ3RodW1ibmFpbCddID0gbWVkaWFfaW5mby50aHVtYm5haWwuc3RyaW5nCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsnZmFuYXJ0J10gPSBtZWRpYV9pbmZvLmZhbmFydC5zdHJpbmcKICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWydnZW5yZSddID0gbWVkaWFfaW5mby5nZW5yZS5zdHJpbmcKICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWydkZXNjcmlwdGlvbiddID0gbWVkaWFfaW5mby5kZXNjcmlwdGlvbi5zdHJpbmcKICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWydkYXRlJ10gPSBtZWRpYV9pbmZvLmRhdGUuc3RyaW5nCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsnY3JlZGl0cyddID0gbWVkaWFfaW5mby5jcmVkaXRzLnN0cmluZwogICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICBlbHNlOgogICAgICAgICAgICBpZiAnLycgaW4gc291cmNlX3VybDoKICAgICAgICAgICAgICAgIG5hbWVTdHIgPSBzb3VyY2VfdXJsLnNwbGl0KCcvJylbLTFdLnNwbGl0KCcuJylbMF0KICAgICAgICAgICAgaWYgJ1xcJyBpbiBzb3VyY2VfdXJsOgogICAgICAgICAgICAgICAgbmFtZVN0ciA9IHNvdXJjZV91cmwuc3BsaXQoJ1xcJylbLTFdLnNwbGl0KCcuJylbMF0KICAgICAgICAgICAgaWYgJyUnIGluIG5hbWVTdHI6CiAgICAgICAgICAgICAgICBuYW1lU3RyID0gdXJsbGliLnVucXVvdGVfcGx1cyhuYW1lU3RyKQogICAgICAgICAgICBrZXlib2FyZCA9IHhibWMuS2V5Ym9hcmQobmFtZVN0ciwnRGlzcGxheWVkIE5hbWUsIFJlbmFtZT8nKQogICAgICAgICAgICBrZXlib2FyZC5kb01vZGFsKCkKICAgICAgICAgICAgaWYgKGtleWJvYXJkLmlzQ29uZmlybWVkKCkgPT0gRmFsc2UpOgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIG5ld1N0ciA9IGtleWJvYXJkLmdldFRleHQoKQogICAgICAgICAgICBpZiBsZW4obmV3U3RyKSA9PSAwOgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIHNvdXJjZV9tZWRpYSA9IHt9CiAgICAgICAgICAgIHNvdXJjZV9tZWRpYVsndGl0bGUnXSA9IG5ld1N0cgogICAgICAgICAgICBzb3VyY2VfbWVkaWFbJ3VybCddID0gc291cmNlX3VybAogICAgICAgICAgICBzb3VyY2VfbWVkaWFbJ2ZhbmFydCddID0gZmFuYXJ0CgogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHNvdXJjZV9maWxlKT09RmFsc2U6CiAgICAgICAgICAgIHNvdXJjZV9saXN0ID0gW10KICAgICAgICAgICAgc291cmNlX2xpc3QuYXBwZW5kKHNvdXJjZV9tZWRpYSkKICAgICAgICAgICAgYiA9IG9wZW4oc291cmNlX2ZpbGUsInciKQogICAgICAgICAgICBiLndyaXRlKGpzb24uZHVtcHMoc291cmNlX2xpc3QpKQogICAgICAgICAgICBiLmNsb3NlKCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBzb3VyY2VzID0ganNvbi5sb2FkcyhvcGVuKHNvdXJjZV9maWxlLCJyIikucmVhZCgpKQogICAgICAgICAgICBzb3VyY2VzLmFwcGVuZChzb3VyY2VfbWVkaWEpCiAgICAgICAgICAgIGIgPSBvcGVuKHNvdXJjZV9maWxlLCJ3IikKICAgICAgICAgICAgYi53cml0ZShqc29uLmR1bXBzKHNvdXJjZXMpKQogICAgICAgICAgICBiLmNsb3NlKCkKICAgICAgICBhZGRvbi5zZXRTZXR0aW5nKCduZXdfdXJsX3NvdXJjZScsICIiKQogICAgICAgIGFkZG9uLnNldFNldHRpbmcoJ25ld19maWxlX3NvdXJjZScsICIiKQogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKEdlbi1YLE5ldyBzb3VyY2UgYWRkZWQuLDUwMDAsIitpY29uKyIpIikKICAgICAgICBpZiBub3QgdXJsIGlzIE5vbmU6CiAgICAgICAgICAgIGlmICd4Ym1jcGx1cy54Yi5mdW5waWMuZGUnIGluIHVybDoKICAgICAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuQ29udGFpbmVyLlVwZGF0ZSglcz9tb2RlPTE0LHJlcGxhY2UpIiAlc3lzLmFyZ3ZbMF0pCiAgICAgICAgICAgIGVsaWYgJ2NvbW11bml0eS1saW5rcycgaW4gdXJsOgogICAgICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Db250YWluZXIuVXBkYXRlKCVzP21vZGU9MTAscmVwbGFjZSkiICVzeXMuYXJndlswXSkKICAgICAgICBlbHNlOiBhZGRvbi5vcGVuU2V0dGluZ3MoKQoJCgpkZWYgcm1Tb3VyY2UobmFtZSk6CiAgICAgICAgc291cmNlcyA9IGpzb24ubG9hZHMob3Blbihzb3VyY2VfZmlsZSwiciIpLnJlYWQoKSkKICAgICAgICBmb3IgaW5kZXggaW4gcmFuZ2UobGVuKHNvdXJjZXMpKToKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShzb3VyY2VzW2luZGV4XSwgbGlzdCk6CiAgICAgICAgICAgICAgICBpZiBzb3VyY2VzW2luZGV4XVswXSA9PSBuYW1lOgogICAgICAgICAgICAgICAgICAgIGRlbCBzb3VyY2VzW2luZGV4XQogICAgICAgICAgICAgICAgICAgIGIgPSBvcGVuKHNvdXJjZV9maWxlLCJ3IikKICAgICAgICAgICAgICAgICAgICBiLndyaXRlKGpzb24uZHVtcHMoc291cmNlcykpCiAgICAgICAgICAgICAgICAgICAgYi5jbG9zZSgpCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGlmIHNvdXJjZXNbaW5kZXhdWyd0aXRsZSddID09IG5hbWU6CiAgICAgICAgICAgICAgICAgICAgZGVsIHNvdXJjZXNbaW5kZXhdCiAgICAgICAgICAgICAgICAgICAgYiA9IG9wZW4oc291cmNlX2ZpbGUsInciKQogICAgICAgICAgICAgICAgICAgIGIud3JpdGUoanNvbi5kdW1wcyhzb3VyY2VzKSkKICAgICAgICAgICAgICAgICAgICBiLmNsb3NlKCkKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuQ29udGFpbmVyLlJlZnJlc2giKQoKCgpkZWYgZ2V0X3htbF9kYXRhYmFzZSh1cmwsIGJyb3dzZT1GYWxzZSk6CiAgICAgICAgaWYgdXJsIGlzIE5vbmU6CiAgICAgICAgICAgIHVybCA9ICdodHRwOi8veGJtY3BsdXMueGIuZnVucGljLmRlL3d3dy1kYXRhL2ZpbGVzeXN0ZW0vJwogICAgICAgIHNvdXAgPSBCZWF1dGlmdWxTb3VwKG1ha2VSZXF1ZXN0KHVybCksIGNvbnZlcnRFbnRpdGllcz1CZWF1dGlmdWxTb3VwLkhUTUxfRU5USVRJRVMpCiAgICAgICAgZm9yIGkgaW4gc291cCgnYScpOgogICAgICAgICAgICBocmVmID0gaVsnaHJlZiddCiAgICAgICAgICAgIGlmIG5vdCBocmVmLnN0YXJ0c3dpdGgoJz8nKToKICAgICAgICAgICAgICAgIG5hbWUgPSBpLnN0cmluZwogICAgICAgICAgICAgICAgaWYgbmFtZSBub3QgaW4gWydQYXJlbnQgRGlyZWN0b3J5JywgJ3JlY3ljbGVfYmluLyddOgogICAgICAgICAgICAgICAgICAgIGlmIGhyZWYuZW5kc3dpdGgoJy8nKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgYnJvd3NlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK2hyZWYsMTUsaWNvbixmYW5hcnQsJycsJycsJycpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwraHJlZiwxNCxpY29uLGZhbmFydCwnJywnJywnJykKICAgICAgICAgICAgICAgICAgICBlbGlmIGhyZWYuZW5kc3dpdGgoJy54bWwnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgYnJvd3NlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK2hyZWYsMSxpY29uLGZhbmFydCwnJywnJywnJywnJywnZG93bmxvYWQnKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoc291cmNlX2ZpbGUpPT1UcnVlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5hbWUgaW4gU09VUkNFUzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUrJyAoaW4gdXNlKScsdXJsK2hyZWYsMTEsaWNvbixmYW5hcnQsJycsJycsJycsJycsJ2Rvd25sb2FkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwraHJlZiwxMSxpY29uLGZhbmFydCwnJywnJywnJywnJywnZG93bmxvYWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwraHJlZiwxMSxpY29uLGZhbmFydCwnJywnJywnJywnJywnZG93bmxvYWQnKQoKCmRlZiBnZXRDb21tdW5pdHlTb3VyY2VzKGJyb3dzZT1GYWxzZSk6CiAgICAgICAgdXJsID0gJ2h0dHA6Ly9jb21tdW5pdHktbGlua3MuZ29vZ2xlY29kZS5jb20vc3ZuL3RydW5rLycKICAgICAgICBzb3VwID0gQmVhdXRpZnVsU291cChtYWtlUmVxdWVzdCh1cmwpLCBjb252ZXJ0RW50aXRpZXM9QmVhdXRpZnVsU291cC5IVE1MX0VOVElUSUVTKQogICAgICAgIGZpbGVzID0gc291cCgndWwnKVswXSgnbGknKVsxOl0KICAgICAgICBmb3IgaSBpbiBmaWxlczoKICAgICAgICAgICAgbmFtZSA9IGkoJ2EnKVswXVsnaHJlZiddCiAgICAgICAgICAgIGlmIGJyb3dzZToKICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCtuYW1lLDEsaWNvbixmYW5hcnQsJycsJycsJycsJycsJ2Rvd25sb2FkJykKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCtuYW1lLDExLGljb24sZmFuYXJ0LCcnLCcnLCcnLCcnLCdkb3dubG9hZCcpCgoKZGVmIGdldFNvdXAodXJsLGRhdGE9Tm9uZSk6CiAgICAgICAgcHJpbnQgJ2dldHNvdXAnLHVybCxkYXRhCiAgICAgICAgaWYgdXJsLnN0YXJ0c3dpdGgoJ2h0dHA6Ly8nKSBvciB1cmwuc3RhcnRzd2l0aCgnaHR0cHM6Ly8nKToKICAgICAgICAgICAgZGF0YSA9IG1ha2VSZXF1ZXN0KHVybCkKICAgICAgICAgICAgaWYgcmUuc2VhcmNoKCIjRVhUTTNVIixkYXRhKSBvciAnbTN1JyBpbiB1cmw6IAogICAgICAgICAgICAgICAgcHJpbnQgJ2ZvdW5kIG0zdSBkYXRhJyxkYXRhCiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YQogICAgICAgICAgICAgICAgCiAgICAgICAgZWxpZiBkYXRhID09IE5vbmU6CiAgICAgICAgICAgIGlmIHhibWN2ZnMuZXhpc3RzKHVybCk6CiAgICAgICAgICAgICAgICBpZiB1cmwuc3RhcnRzd2l0aCgic21iOi8vIikgb3IgdXJsLnN0YXJ0c3dpdGgoIm5mczovLyIpOgogICAgICAgICAgICAgICAgICAgIGNvcHkgPSB4Ym1jdmZzLmNvcHkodXJsLCBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ3RlbXAnLCAnc29yY2VfdGVtcC50eHQnKSkKICAgICAgICAgICAgICAgICAgICBpZiBjb3B5OgogICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gb3Blbihvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ3RlbXAnLCAnc29yY2VfdGVtcC50eHQnKSwgInIiKS5yZWFkKCkKICAgICAgICAgICAgICAgICAgICAgICAgeGJtY3Zmcy5kZWxldGUob3MucGF0aC5qb2luKHByb2ZpbGUsICd0ZW1wJywgJ3NvcmNlX3RlbXAudHh0JykpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJmYWlsZWQgdG8gY29weSBmcm9tIHNtYjoiKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBkYXRhID0gb3Blbih1cmwsICdyJykucmVhZCgpCiAgICAgICAgICAgICAgICAgICAgaWYgcmUubWF0Y2goIiNFWFRNM1UiLGRhdGEpb3IgJ20zdScgaW4gdXJsOiAKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2ZvdW5kIG0zdSBkYXRhJyxkYXRhCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlNvdXAgRGF0YSBub3QgZm91bmQhIikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgIHJldHVybiBCZWF1dGlmdWxTT0FQKGRhdGEsIGNvbnZlcnRFbnRpdGllcz1CZWF1dGlmdWxTdG9uZVNvdXAuWE1MX0VOVElUSUVTKQoKCmRlZiBnZXREYXRhKHVybCxmYW5hcnQpOgogICAgcHJpbnQgJ3VybC1nZXREYXRhJyx1cmwKICAgIFNldFZpZXdMYXlvdXQgPSAiTGlzdCIKICAgICAKICAgIHNvdXAgPSBnZXRTb3VwKHVybCkKICAgICNwcmludCB0eXBlKHNvdXApCiAgICBpZiBpc2luc3RhbmNlKHNvdXAsQmVhdXRpZnVsU09BUCk6CiAgICAgICAgaWYgbGVuKHNvdXAoJ2xheW91dHlwZScpKSA+IDA6CiAgICAgICAgICAgIFNldFZpZXdMYXlvdXQgPSAiVGh1bWJuYWlsIgkJICAgIAoKICAgICAgICBpZiBsZW4oc291cCgnY2hhbm5lbHMnKSkgPiAwOgogICAgICAgICAgICBjaGFubmVscyA9IHNvdXAoJ2NoYW5uZWwnKQogICAgICAgICAgICBmb3IgY2hhbm5lbCBpbiBjaGFubmVsczoKIyAgICAgICAgICAgICAgICBwcmludCBjaGFubmVsCgogICAgICAgICAgICAgICAgbGlua2VkVXJsPScnCiAgICAgICAgICAgICAgICBsY291bnQ9MAogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGxpbmtlZFVybCA9ICBjaGFubmVsKCdleHRlcm5hbGxpbmsnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICBsY291bnQ9bGVuKGNoYW5uZWwoJ2V4dGVybmFsbGluaycpKQogICAgICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgICAgICAgICAjcHJpbnQgJ2xpbmtlZFVybCcsbGlua2VkVXJsLGxjb3VudAogICAgICAgICAgICAgICAgaWYgbGNvdW50PjE6IGxpbmtlZFVybD0nJwoKICAgICAgICAgICAgICAgIG5hbWUgPSBjaGFubmVsKCduYW1lJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSBjaGFubmVsKCd0aHVtYm5haWwnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgIGlmIHRodW1ibmFpbCA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9ICcnCgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBjaGFubmVsKCdmYW5hcnQnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygndXNlX3RodW1iJykgPT0gInRydWUiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gdGh1bWJuYWlsCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBmYW5hcnQKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBjaGFubmVsKCdmYW5hcnQnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICBpZiBmYW5BcnQgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBmYW5hcnQKCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgZGVzYyA9IGNoYW5uZWwoJ2luZm8nKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICBpZiBkZXNjID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgZGVzYyA9ICcnCgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGdlbnJlID0gY2hhbm5lbCgnZ2VucmUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICBpZiBnZW5yZSA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIGdlbnJlID0gJycKCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgZGF0ZSA9IGNoYW5uZWwoJ2RhdGUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICBpZiBkYXRlID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgZGF0ZSA9ICcnCgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGNyZWRpdHMgPSBjaGFubmVsKCdjcmVkaXRzJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgaWYgY3JlZGl0cyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIGNyZWRpdHMgPSAnJwoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBpZiBsaW5rZWRVcmw9PScnOgogICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpLHVybC5lbmNvZGUoJ3V0Zi04JyksMix0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxjcmVkaXRzLFRydWUpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbmFtZSA9PSAnW0NPTE9SIHJlZF1MaXZlIFNwb3J0Wy9DT0xPUl0nOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcpLGxpbmtlZFVybC5lbmNvZGUoJ3V0Zi04JyksMzEsdGh1bWJuYWlsLGZhbkFydCxkZXNjLGdlbnJlLGRhdGUsTm9uZSwnc291cmNlJykKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKCQkJCQkJICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSxsaW5rZWRVcmwuZW5jb2RlKCd1dGYtOCcpLDEsdGh1bWJuYWlsLGZhbkFydCxkZXNjLGdlbnJlLGRhdGUsTm9uZSwnc291cmNlJykKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ1RoZXJlIHdhcyBhIHByb2JsZW0gYWRkaW5nIGRpcmVjdG9yeSBmcm9tIGdldERhdGEoKTogJytuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYWRkb25fbG9nKCdObyBDaGFubmVsczogZ2V0SXRlbXMnKQogICAgICAgICAgICBnZXRJdGVtcyhzb3VwKCdpdGVtJyksZmFuYXJ0KQogICAgZWxzZToKICAgICAgICBwYXJzZV9tM3Uoc291cCkKCiAgICBpZiBTZXRWaWV3TGF5b3V0ID09ICJUaHVtYm5haWwiOgogICAgICAgU2V0Vmlld1RodW1ibmFpbCgpCgkgICAKZGVmIFdpekhETWVudSh1cmwsaWNvbmltYWdlLGZhbmFydCk6CglhZGREaXIoJ0dlbi1YUGxheWxpc3RlZCcsdXJsLDEsaWNvbmltYWdlLGZhbmFydCwnJywnJywnJyxOb25lLCdzb3VyY2UnKQoJaHRtbCA9IHJlcXVlc3RzLmdldCgnaHR0cDovL3dpemhkc3BvcnRzLmlzLycpLmNvbnRlbnQKCWJsb2NrID0gcmUuY29tcGlsZSgnPHVsIGNsYXNzPSJzcG9ydHNfbWVudSI+KC4rPyk8L3VsPicscmUuRE9UQUxMKS5maW5kYWxsKGh0bWwpCglmb3IgaXRlbSBpbiBibG9jazoKCQltYXRjaCA9IHJlLmNvbXBpbGUoJzxhIGhyZWY9IiguKz8pIi4rP3NyYz0iKC4rPykiLis/PiAoLis/KTwvbGk+JykuZmluZGFsbChzdHIoaXRlbSkpCgkJZm9yIHVybDIsaWNvbmltYWdlLG5hbWUgaW4gbWF0Y2g6CgkJCW5hbWUgPSBuYW1lLnRpdGxlKCkKCQkJaWYgbmFtZSA9PSAnTmZsJzppbWFnZSA9IE5mbAoJCQllbGlmIG5hbWUgPT0gJ0Zvb3RiYWxsJzppbWFnZSA9IEZvb3RiYWxsCgkJCWVsaWYgbmFtZSA9PSAnQ3JpY2tldCc6aW1hZ2UgPSBDcmlja2V0CgkJCWVsaWYgbmFtZSA9PSAnVGVubmlzJzppbWFnZSA9IFRlbm5pcwoJCQllbGlmIG5hbWUgPT0gJ0JveGluZyc6aW1hZ2UgPSBCb3hpbmcKCQkJZWxpZiBuYW1lID09ICdHb2xmJzppbWFnZSA9IEdvbGYKCQkJZWxpZiBuYW1lID09ICdNb3Rvc3BvcnRzJzppbWFnZSA9IE1vdG9yc3BvcnRzCgkJCWVsaWYgbmFtZSA9PSAnUnVnYnknOmltYWdlID0gUnVnYnkKCQkJZWxpZiBuYW1lID09ICdIb2NrZXknOmltYWdlID0gSG9ja2V5CgkJCWVsaWYgbmFtZSA9PSAnTmJhJzppbWFnZSA9IE5iYQoJCQllbGlmIG5hbWUgPT0gJ0RhcnRzJzppbWFnZSA9IERhcnRzCgkJCWVsaWYgbmFtZSA9PSAnV3dlJzppbWFnZSA9IFd3ZQoJCQllbGlmIG5hbWUgPT0gJ0hvcnNlIFJhY2luZyc6aW1hZ2UgPSBIb3JzZV9SYWNpbmcKCQkJZWxpZiBuYW1lID09ICdVZmMnOmltYWdlID0gVWZjCgkJCWVsaWYgbmFtZSA9PSAnQmFzZWJhbGwnOmltYWdlID0gQmFzZWJhbGwKCQkJaWYgbmFtZSA9PSAnVHYgU2hvd3MnOnBhc3MKCQkJZWxpZiBuYW1lID09ICdPdGhlcnMnOnBhc3MKCQkJZWxpZiBuYW1lID09ICdQMlAgT25saW5lJzpwYXNzCgkJCWVsc2U6CgkJCQlpZiBpbWFnZSA9PSAnJzoKCQkJCQlpbWFnZSA9IGljb25pbWFnZQoJCQkJYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcpLHVybDIuZW5jb2RlKCd1dGYtOCcpLDMyLGltYWdlLGZhbmFydCwnJywnJywnJyxOb25lLCdzb3VyY2UnKQoJCQkJCmRlZiBXaXpfR2V0X3VybCh1cmwpOgoJTGlzdCA9IFtdCgoJZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKCXRvZGF5c19kYXkgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgnJWQnKQoJdG9kYXlzX21vbnRoID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVtJykKCXRvZGF5c195ZWFyID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVZJykKCXRvZGF5c19ob3VyID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVIJykKCXRvZGF5c19taW51dGUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgnJU0nKQoJZmluX2RhdGUgPSB0b2RheXNfZGF5KyctJyt0b2RheXNfbW9udGgrJy0nK3RvZGF5c195ZWFyCglodG1sID0gcmVxdWVzdHMuZ2V0KHVybCkuY29udGVudAoJYmxvY2sgPSByZS5jb21waWxlKCc8aDM+Lis/R2FtZXMgT24gOiAoLis/KTwvaDM+KC4rPyk8bGkgY2xhc3M9XCdzcG9ydHNfcmVkX2JhclwnPicscmUuRE9UQUxMKS5maW5kYWxsKGh0bWwpCglmb3IgZGF0ZSxyZXN0IGluIGJsb2NrOgoJCWlmIGRhdGUgPT0gZmluX2RhdGU6CgkJCW1hdGNoID0gcmUuY29tcGlsZSgnPGRpdiBjbGFzcz1cJ2NvbC1tZC0yXCc+Lis/PC9zcGFuPiguKz8pPC9kaXY+Lis/PGRpdiBjbGFzcz1cJ2NvbC1tZC02XCc+KC4rPyk8L2Rpdj4uKz9kaXYgY2xhc3M9ImNhcmQtYmxvY2sgZHJvcF9ib3giPiguKz8pPGRpdiBjbGFzcz0iY2FyZCI+JyxyZS5ET1RBTEwpLmZpbmRhbGwoc3RyKHJlc3QpKQoJCQlmb3IgdGltZSx0ZWFtcyxsaW5rX2Jsb2NrIGluIG1hdGNoOgoJCQkJdG90YWwgPSBsZW4obWF0Y2gpCgkJCQl0ZWFtcyA9IHRlYW1zLnJlcGxhY2UoJyAgJywnJykucmVwbGFjZSgnCScsJycpCgkJCQlsaW5rX2Jsb2NrID0gbGlua19ibG9jay5yZXBsYWNlKCcgICcsJycpCgkJCQl0aW1lX3NwbGl0ID0gcmUuZmluZGFsbCgnKC4rPyk6KC4rPyktKC4rPyk6KC4rPyk+JyxzdHIodGltZSsnPicpKQoJCQkJZm9yIHN0YXJ0X2hvdXIsc3RhcnRfbWluLGZpbl9ob3VyLGZpbl9taW4gaW4gdGltZV9zcGxpdDoKCQkJCQlzdGFydF9ubyA9IGludChzdGFydF9ob3VyKSoyNCtpbnQoc3RhcnRfbWluKQoJCQkJCWZpbl9ubyA9IGludChmaW5faG91cikqMjQraW50KGZpbl9taW4pCgkJCQkJdGltZV9ub3cgPSBpbnQodG9kYXlzX2hvdXIpKjI0K2ludCh0b2RheXNfbWludXRlKQoJCQkJCWlmIGZpbl9ubz50aW1lX25vdz5zdGFydF9ubzoKCQkJCQkJbmFtZSA9ICdbQ09MT1JncmVlbl0nKyB0ZWFtcysnWy9DT0xPUl0nCgkJCQkJZWxzZToKCQkJCQkJbmFtZSA9IHRlYW1zCgkJCQlsaW5rX2dldCA9IHJlLmNvbXBpbGUoIjxhIGhyZWY9JyguKz8pJz4uKz8+KC4rPyk8L2Rpdj48L2E+IikuZmluZGFsbChzdHIobGlua19ibG9jaykpCgkJCQlmb3IgbGluayxjaG5sIGluIGxpbmtfZ2V0OgoJCQkJCWxpbmsgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLlNwb3J0c0RldmlsLz9tb2RlPTEmYW1wO2l0ZW09Y2F0Y2hlciUzZHN0cmVhbXMlMjZ1cmw9JytsaW5rCgkJCQkJaWYgbGVuKGxpbmtfZ2V0KT4xOgoJCQkJCQlMaXN0LmFwcGVuZCgobGluayxjaG5sKSkKCQkJCQllbHNlOgoJCQkJCQlhZGRMaW5rKGxpbmssdGltZS5yZXBsYWNlKCcgJywnJykrJy0nK25hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSxpY29uLEZBTkFSVCwnJywnJywnJyxUcnVlLE5vbmUscmVnZXhzLHRvdGFsKQkJCQkJCQoJCQkJaWYgbGVuKExpc3QpPjE6CgkJCQkJdnVybCA9IHN0cihMaXN0KS5yZXBsYWNlKCdbJywnc3VibGluaycpLnJlcGxhY2UoJ10nLCcjJykucmVwbGFjZSgnc3VibGluayhcJycsJ3N1Ymxpbms6JykucmVwbGFjZSgncGx1Z2luOicsJ0xJU1RTT1VSQ0U6cGx1Z2luOicpLnJlcGxhY2UoIicsICciLCc6OkxJU1ROQU1FOicpLnJlcGxhY2UoIicpLCAoJyIsJzo6I3N1YmxpbmsnKS5yZXBsYWNlKCInKSIsJycpLnJlcGxhY2UoJ3N1YmxpbmtMSVNUU09VUkNFJywnc3VibGluazpMSVNUU09VUkNFJykKCQkJCQl4Ym1jLmxvZyh2dXJsKQoJCQkJCWFkZERpcih0aW1lLnJlcGxhY2UoJyAnLCcnKSsnLScrbmFtZSx2dXJsLDMwLGljb24sRkFOQVJULCcnLCcnLCcnLCcnKQoJCQkJCWRlbCBMaXN0WzpdCgkJCgoKCQoKIyBib3Jyb3cgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vZW5lbjkyL1AyUC1TdHJlYW1zLVhCTUMvYmxvYi9tYXN0ZXIvcGx1Z2luLnZpZGVvLnAycC1zdHJlYW1zL3Jlc291cmNlcy9jb3JlL2xpdmVzdHJlYW1zLnB5CiMgVGhpcyB3aWxsIG5vdCBnbyB0aHJvdWdoIHRoZSBnZXRJdGVtcyBmdW5jdGlvbnMgKCBtZWFucyB5b3UgbXVzdCBoYXZlIHJlYWR5IHRvIHBsYXkgdXJsLCBubyByZWdleCkKZGVmIHBhcnNlX20zdShkYXRhKToKICAgIGNvbnRlbnQgPSBkYXRhLnJzdHJpcCgpCiAgICBtYXRjaCA9IHJlLmNvbXBpbGUocicjRVhUSU5GOiguKz8pLCguKj8pW1xuXHJdKyhbXlxuXSspJykuZmluZGFsbChjb250ZW50KQogICAgdG90YWwgPSBsZW4obWF0Y2gpCiAgICBwcmludCAndG90YWwgbTN1IGxpbmtzJyx0b3RhbAogICAgZm9yIG90aGVyLGNoYW5uZWxfbmFtZSxzdHJlYW1fdXJsIGluIG1hdGNoOgogICAgICAgIGlmICd0dmctbG9nbycgaW4gb3RoZXI6CiAgICAgICAgICAgIHRodW1ibmFpbCA9IHJlX21lKG90aGVyLCd0dmctbG9nbz1bXCciXSguKj8pW1wnIl0nKQogICAgICAgICAgICBpZiB0aHVtYm5haWw6CiAgICAgICAgICAgICAgICBpZiB0aHVtYm5haWwuc3RhcnRzd2l0aCgnaHR0cCcpOgogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IHRodW1ibmFpbAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbGlmIG5vdCBhZGRvbi5nZXRTZXR0aW5nKCdsb2dvLWZvbGRlclBhdGgnKSA9PSAiIjoKICAgICAgICAgICAgICAgICAgICBsb2dvX3VybCA9IGFkZG9uLmdldFNldHRpbmcoJ2xvZ28tZm9sZGVyUGF0aCcpCiAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gbG9nb191cmwgKyB0aHVtYm5haWwKCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IHRodW1ibmFpbAogICAgICAgICAgICAjZWxzZToKICAgICAgICAgICAgCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdGh1bWJuYWlsID0gJycKICAgICAgICBpZiAndHlwZScgaW4gb3RoZXI6CiAgICAgICAgICAgIG1vZGVfdHlwZSA9IHJlX21lKG90aGVyLCd0eXBlPVtcJyJdKC4qPylbXCciXScpCiAgICAgICAgICAgIGlmIG1vZGVfdHlwZSA9PSAneXQtZGwnOgogICAgICAgICAgICAgICAgc3RyZWFtX3VybCA9IHN0cmVhbV91cmwgKyImbW9kZT0xOCIKICAgICAgICAgICAgZWxpZiBtb2RlX3R5cGUgPT0gJ3JlZ2V4JzoKICAgICAgICAgICAgICAgIHVybCA9IHN0cmVhbV91cmwuc3BsaXQoJyZyZWdleHM9JykKICAgICAgICAgICAgICAgICNwcmludCB1cmxbMF0gZ2V0U291cCh1cmwsZGF0YT1Ob25lKQogICAgICAgICAgICAgICAgcmVnZXhzID0gcGFyc2VfcmVnZXgoZ2V0U291cCgnJyxkYXRhPXVybFsxXSkpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGFkZExpbmsodXJsWzBdLCBjaGFubmVsX25hbWUsdGh1bWJuYWlsLCcnLCcnLCcnLCcnLCcnLE5vbmUscmVnZXhzLHRvdGFsKQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICBhZGRMaW5rKHN0cmVhbV91cmwsIGNoYW5uZWxfbmFtZSx0aHVtYm5haWwsJycsJycsJycsJycsJycsTm9uZSwnJyx0b3RhbCkKCQkKICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIkNvbnRhaW5lci5TZXRWaWV3TW9kZSg1MCkiKQoJCmRlZiBnZXRDaGFubmVsSXRlbXMobmFtZSx1cmwsZmFuYXJ0KToKICAgICAgICBzb3VwID0gZ2V0U291cCh1cmwpCiAgICAgICAgY2hhbm5lbF9saXN0ID0gc291cC5maW5kKCdjaGFubmVsJywgYXR0cnM9eyduYW1lJyA6IG5hbWUuZGVjb2RlKCd1dGYtOCcpfSkKICAgICAgICBpdGVtcyA9IGNoYW5uZWxfbGlzdCgnaXRlbScpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBmYW5BcnQgPSBjaGFubmVsX2xpc3QoJ2ZhbmFydCcpWzBdLnN0cmluZwogICAgICAgICAgICBpZiBmYW5BcnQgPT0gTm9uZToKICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBmYW5BcnQgPSBmYW5hcnQKICAgICAgICBmb3IgY2hhbm5lbCBpbiBjaGFubmVsX2xpc3QoJ3N1YmNoYW5uZWwnKToKICAgICAgICAgICAgbmFtZSA9IGNoYW5uZWwoJ25hbWUnKVswXS5zdHJpbmcKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gY2hhbm5lbCgndGh1bWJuYWlsJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiB0aHVtYm5haWwgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSAnJwogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpZiBub3QgY2hhbm5lbCgnZmFuYXJ0Jyk6CiAgICAgICAgICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygndXNlX3RodW1iJykgPT0gInRydWUiOgogICAgICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSB0aHVtYm5haWwKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gY2hhbm5lbCgnZmFuYXJ0JylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBmYW5BcnQgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGRlc2MgPSBjaGFubmVsKCdpbmZvJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBkZXNjID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgZGVzYyA9ICcnCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBnZW5yZSA9IGNoYW5uZWwoJ2dlbnJlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBnZW5yZSA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGdlbnJlID0gJycKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGRhdGUgPSBjaGFubmVsKCdkYXRlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBkYXRlID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgZGF0ZSA9ICcnCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBjcmVkaXRzID0gY2hhbm5lbCgnY3JlZGl0cycpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgY3JlZGl0cyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGNyZWRpdHMgPSAnJwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSx1cmwuZW5jb2RlKCd1dGYtOCcpLDMsdGh1bWJuYWlsLGZhbkFydCxkZXNjLGdlbnJlLGNyZWRpdHMsZGF0ZSkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdUaGVyZSB3YXMgYSBwcm9ibGVtIGFkZGluZyBkaXJlY3RvcnkgLSAnK25hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSkKICAgICAgICBnZXRJdGVtcyhpdGVtcyxmYW5BcnQpCgoKZGVmIGdldFN1YkNoYW5uZWxJdGVtcyhuYW1lLHVybCxmYW5hcnQpOgogICAgICAgIHNvdXAgPSBnZXRTb3VwKHVybCkKICAgICAgICBjaGFubmVsX2xpc3QgPSBzb3VwLmZpbmQoJ3N1YmNoYW5uZWwnLCBhdHRycz17J25hbWUnIDogbmFtZS5kZWNvZGUoJ3V0Zi04Jyl9KQogICAgICAgIGl0ZW1zID0gY2hhbm5lbF9saXN0KCdzdWJpdGVtJykKICAgICAgICBnZXRJdGVtcyhpdGVtcyxmYW5hcnQpCgojaGFrYW1hYwpkZWYgR2V0U3VibGlua3MobmFtZSx1cmwsaWNvbmltYWdlLGZhbmFydCk6CiAgICB4Ym1jLmxvZygnSSBHT1QgSEVSRSMjIyMjIyMjIyMjIyMjIycpCiAgICBMaXN0PVtdOyBMaXN0VT1bXTsgYz0wCiAgICBhbGxfdmlkZW9zID0gcmVnZXhfZ2V0X2FsbCh1cmwsICdzdWJsaW5rOicsICcjJykKICAgIGZvciBhIGluIGFsbF92aWRlb3M6CiAgICAgICAgaWYgJ0xJU1RTT1VSQ0U6JyBpbiBhOgogICAgICAgICAgICB2dXJsID0gcmVnZXhfZnJvbV90byhhLCAnTElTVFNPVVJDRTonLCAnOjonKQogICAgICAgICAgICBsaW5lbmFtZSA9IHJlZ2V4X2Zyb21fdG8oYSwgJ0xJU1ROQU1FOicsICc6OicpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdnVybCA9IGEucmVwbGFjZSgnc3VibGluazonLCcnKS5yZXBsYWNlKCcjJywnJykKICAgICAgICAgICAgbGluZW5hbWUgPSBuYW1lCiAgICAgICAgaWYgbGVuKHZ1cmwpID4gMTA6CiAgICAgICAgICAgIGM9YysxOyBMaXN0LmFwcGVuZChsaW5lbmFtZSk7IExpc3RVLmFwcGVuZCh2dXJsKQogCiAgICBpZiBjPT0xOgogICAgICAgIHRyeToKICAgICAgICAgICAgI3ByaW50ICdwbGF5IDEgICBOYW1lOicgKyBuYW1lICsgJyAgIHVybDonICsgTGlzdFVbMF0gKyAnICAgICAnICsgc3RyKGMpCiAgICAgICAgICAgIGxpej14Ym1jZ3VpLkxpc3RJdGVtKG5hbWUsIGljb25JbWFnZT1pY29uaW1hZ2UsdGh1bWJuYWlsSW1hZ2U9aWNvbmltYWdlKTsgbGl6LnNldEluZm8oIHR5cGU9IlZpZGVvIiwgaW5mb0xhYmVscz17ICJUaXRsZSI6IG5hbWUgfSApCiAgICAgICAgICAgIG9rPXhibWNwbHVnaW4uYWRkRGlyZWN0b3J5SXRlbShoYW5kbGU9aW50KHN5cy5hcmd2WzFdKSx1cmw9TGlzdFVbMF0sbGlzdGl0ZW09bGl6KQogICAgICAgICAgICB4Ym1jLlBsYXllcigpLnBsYXkodXJsc29sdmVyKExpc3RVWzBdKSwgbGl6KQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwogICAgZWxzZToKICAgICAgICAgZGlhbG9nPXhibWNndWkuRGlhbG9nKCkKICAgICAgICAgck5vPWRpYWxvZy5zZWxlY3QoJ0dlbi1YU2VsZWN0IEEgU291cmNlJywgTGlzdCkKICAgICAgICAgaWYgck5vPj0wOgogICAgICAgICAgICAgck5hbWU9bmFtZQogICAgICAgICAgICAgclVSTD1zdHIoTGlzdFVbck5vXSkKICAgICAgICAgICAgICNwcmludCAnU3VibGlua3MgICBOYW1lOicgKyBuYW1lICsgJyAgIHVybDonICsgclVSTAogICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIHhibWMuUGxheWVyKCkucGxheSh1cmxzb2x2ZXIoclVSTCksIHhibWNndWkuTGlzdEl0ZW0ock5hbWUpKQogICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgIHhibWMuUGxheWVyKCkucGxheShyVVJMLCB4Ym1jZ3VpLkxpc3RJdGVtKHJOYW1lKSkKCgkJCQkKZGVmIFNlYXJjaENoYW5uZWxzKCk6CiNoYWthbWFjIGNvZGUKICAgIEtleWJvYXJkTWVzc2FnZSA9ICdOYW1lIG9mIGNoYW5uZWwgc2hvdyBvciBtb3ZpZScKICAgIFNlYXJjaGtleSA9ICcnCiAgICBrZXlib2FyZCA9IHhibWMuS2V5Ym9hcmQoU2VhcmNoa2V5LCBLZXlib2FyZE1lc3NhZ2UpCiAgICBrZXlib2FyZC5kb01vZGFsKCkKICAgIGlmIGtleWJvYXJkLmlzQ29uZmlybWVkKCk6CiAgICAgICBTZWFyY2hrZXkgPSBrZXlib2FyZC5nZXRUZXh0KCkucmVwbGFjZSgnXG4nLCcnKS5zdHJpcCgpCiAgICAgICBpZiBsZW4oU2VhcmNoa2V5KSA9PSAwOiAKICAgICAgICAgIHhibWNndWkuRGlhbG9nKCkub2soJ1JvYmluSG9vZCcsICdOb3RoaW5nIEVudGVyZWQnKQogICAgICAgICAgcmV0dXJuCSAgIAogICAgCiAgICBTZWFyY2hrZXkgPSBTZWFyY2hrZXkubG93ZXIoKQogICAgTGlzdD1bXQogICAgTGlzdC5hcHBlbmQoX0VkaXQuTWFpbkJhc2UpCiAgICBQYXNzZWRVcmxzID0gMAogICAgRm91bmRDaGFubmVsID0gMSAKICAgIFJlYWRDaGFubmVsID0gMAogICAgRm91bmRNYXRjaCA9IDAKICAgIHByb2dyZXNzID0geGJtY2d1aS5EaWFsb2dQcm9ncmVzcygpCiAgICBwcm9ncmVzcy5jcmVhdGUoJ0dlbi1YU2VhcmNoaW5nIFBsZWFzZSB3YWl0JywnICcpCgkKICAgIHdoaWxlIEZvdW5kQ2hhbm5lbCA8PiBSZWFkQ2hhbm5lbDoKICAgICAgICBCYXNlU2VhcmNoID0gTGlzdFtSZWFkQ2hhbm5lbF0uc3RyaXAoKQogICAgICAgIHByaW50ICdyZWFkIHRoaXMgb25lIGZyb20gZmlsZSBsaXN0ICgnICsgc3RyKFJlYWRDaGFubmVsKSArICcpJyAgCiAgICAgICAgUmVhZENoYW5uZWwgPSBSZWFkQ2hhbm5lbCArIDEKCiAgICAgICAgUGFnZVNvdXJjZSA9ICcnCiAgICAgICAgdHJ5OgogICAgICAgICAgICBQYWdlU291cmNlID0gbmV0Lmh0dHBfR0VUKEJhc2VTZWFyY2gpLmNvbnRlbnQKICAgICAgICAgICAgUGFnZVNvdXJjZSA9IFBhZ2VTb3VyY2UuZW5jb2RlKCdhc2NpaScsICdpZ25vcmUnKS5kZWNvZGUoJ2FzY2lpJykKICAgICAgICAgICAgI3RpbWUuc2xlZXAoMSkKICAgICAgICBleGNlcHQ6IAogICAgICAgICAgICBwYXNzCgkJCiAgICAgICAgaWYgbGVuKFBhZ2VTb3VyY2UpIDwgMTA6CiAgICAgICAgICAgIFBhZ2VTb3VyY2UgPSAnJwogICAgICAgICAgICBQYXNzZWRVcmxzID0gUGFzc2VkVXJscyArIDEKICAgICAgICAgICAgcHJpbnQgJyoqKiBQQVNTRUQgKioqKicgKyBCYXNlU2VhcmNoICsgJyAgKioqKioqKioqKioqKiBUb3RhbCBQYXNzZWQgVXJsczogJyArIHN0cihQYXNzZWRVcmxzKQogICAgICAgICAgICB0aW1lLnNsZWVwKC41KQogCiAgICAgICAgcGVyY2VudCA9IGludCggKCBSZWFkQ2hhbm5lbCAvIDMwMCkgKiAxMDApIAogICAgICAgIG1lc3NhZ2UgPSAnICAgICBQYWdlcyBSZWFkOiAnK3N0cihSZWFkQ2hhbm5lbCkrJyAgICAgICAgTWF0Y2hlcyBGb3VuZDogJyArIHN0cihGb3VuZE1hdGNoKQogICAgICAgIHByb2dyZXNzLnVwZGF0ZShwZXJjZW50LCIiLCBtZXNzYWdlLCAiIiApCgogICAgICAgIGlmIHByb2dyZXNzLmlzY2FuY2VsZWQoKToKICAgICAgICAgICByZXR1cm4KIAkJCiAgICAgICAgaWYgbGVuKFBhZ2VTb3VyY2UpID4gMTA6CiAgICAgICAgICAgIGFsbF9saW5rcyA9IHJlZ2V4X2dldF9hbGwoUGFnZVNvdXJjZSwgJzxjaGFubmVsPicsICc8L2NoYW5uZWw+JykKICAgICAgICAgICAgZm9yIGEgaW4gYWxsX2xpbmtzOgogICAgICAgICAgICAgICAgdnVybCA9IHJlZ2V4X2Zyb21fdG8oYSwgJzxleHRlcm5hbGxpbms+JywgJzwvZXh0ZXJuYWxsaW5rPicpCiAgICAgICAgICAgICAgICAjbmFtZSA9IHJlZ2V4X2Zyb21fdG8oYSwgJzxuYW1lPicsICc8L25hbWU+JykKICAgICAgICAgICAgICAgICNwcmludCBuYW1lICsgJyAgICAnICsgdnVybAogICAgICAgICAgICAgICAgaWYgbGVuKHZ1cmwpID4gNToKICAgICAgICAgICAgICAgICAgIEZvdW5kQ2hhbm5lbCA9IEZvdW5kQ2hhbm5lbCArIDEKICAgICAgICAgICAgICAgICAgIExpc3QuYXBwZW5kKHZ1cmwpCiAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ0ZvdW5kIENoYW5uZWw6ICcrIHN0cihGb3VuZENoYW5uZWwpICsnIDogJysgdnVybCAKCiAgICAgICAgICAgIGFsbF9pdGVtcyA9IHJlZ2V4X2dldF9hbGwoUGFnZVNvdXJjZSwgJzxpdGVtPicsICc8L2l0ZW0+JykKICAgICAgICAgICAgZm9yIGEgaW4gYWxsX2l0ZW1zOgogICAgICAgICAgICAgICAgdnVybCA9IHJlZ2V4X2Zyb21fdG8oYSwgJzxsaW5rPicsICc8L2xpbms+JykKICAgICAgICAgICAgICAgIG5hbWUgPSByZWdleF9mcm9tX3RvKGEsICc8dGl0bGU+JywgJzwvdGl0bGU+JykKICAgICAgICAgICAgICAgIFRlc3ROYW1lID0gJyAgJyArIG5hbWUubG93ZXIoKSArICcgICcKICAgICAgICAgICAgICAgICNwcmludCAnVGVzdGluZzonICsgVGVzdE5hbWUgKyAnICAnICsgU2VhcmNoa2V5CiAgICAgICAgICAgICAgICBpZiBsZW4odnVybCkgPiA1IGFuZCBUZXN0TmFtZS5maW5kKFNlYXJjaGtleSkgPiAwOgogICAgICAgICAgICAgICAgICAgIEZvdW5kTWF0Y2ggPSBGb3VuZE1hdGNoICsgMQogICAgICAgICAgICAgICAgICAgIGZhbmFydCA9ICcnCiAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gcmVnZXhfZnJvbV90byhhLCAnPHRodW1ibmFpbD4nLCAnPC90aHVtYm5haWw+JykKICAgICAgICAgICAgICAgICAgICBmYW5hcnQgPSByZWdleF9mcm9tX3RvKGEsICc8ZmFuYXJ0PicsICc8L2ZhbmFydD4nKQogICAgICAgICAgICAgICAgICAgIGlmIGxlbihmYW5hcnQpIDwgNToKICAgICAgICAgICAgICAgICAgICAgICBmYW5hcnQgPSBpY29uCiAgICAgICAgICAgICAgICAgICAgaWYgdnVybC5maW5kKCdzdWJsaW5rJykgPiAwOgogICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx2dXJsLDMwLHRodW1ibmFpbCxmYW5hcnQsJycsJycsJycsJycpCiAgICAgICAgICAgICAgICAgICAgZWxzZTogCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZExpbmsoc3RyKHZ1cmwpLG5hbWUsdGh1bWJuYWlsLGZhbmFydCwnJywnJywnJyxUcnVlLE5vbmUsJycsMSkKCQkJCQkJCiAgICAKICAgIHByb2dyZXNzLmNsb3NlKCkKICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIkNvbnRhaW5lci5TZXRWaWV3TW9kZSg1MCkiKQoJCmRlZiBTZWFyY2hfbTN1KGRhdGEsU2VhcmNoa2V5KToKICAgIGNvbnRlbnQgPSBkYXRhLnJzdHJpcCgpCiAgICBtYXRjaCA9IHJlLmNvbXBpbGUocicjRVhUSU5GOiguKz8pLCguKj8pW1xuXHJdKyhbXlxuXSspJykuZmluZGFsbChjb250ZW50KQogICAgdG90YWwgPSBsZW4obWF0Y2gpCiAgICBwcmludCAndG90YWwgbTN1IGxpbmtzJyx0b3RhbAogICAgZm9yIG90aGVyLGNoYW5uZWxfbmFtZSxzdHJlYW1fdXJsIGluIG1hdGNoOgogICAgICAgIGlmICd0dmctbG9nbycgaW4gb3RoZXI6CiAgICAgICAgICAgIHRodW1ibmFpbCA9IHJlX21lKG90aGVyLCd0dmctbG9nbz1bXCciXSguKj8pW1wnIl0nKQogICAgICAgICAgICBpZiB0aHVtYm5haWw6CiAgICAgICAgICAgICAgICBpZiB0aHVtYm5haWwuc3RhcnRzd2l0aCgnaHR0cCcpOgogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IHRodW1ibmFpbAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbGlmIG5vdCBhZGRvbi5nZXRTZXR0aW5nKCdsb2dvLWZvbGRlclBhdGgnKSA9PSAiIjoKICAgICAgICAgICAgICAgICAgICBsb2dvX3VybCA9IGFkZG9uLmdldFNldHRpbmcoJ2xvZ28tZm9sZGVyUGF0aCcpCiAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gbG9nb191cmwgKyB0aHVtYm5haWwKCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IHRodW1ibmFpbAogICAgICAgICAgICAjZWxzZToKICAgICAgICAgICAgCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdGh1bWJuYWlsID0gJycKICAgICAgICBpZiAndHlwZScgaW4gb3RoZXI6CiAgICAgICAgICAgIG1vZGVfdHlwZSA9IHJlX21lKG90aGVyLCd0eXBlPVtcJyJdKC4qPylbXCciXScpCiAgICAgICAgICAgIGlmIG1vZGVfdHlwZSA9PSAneXQtZGwnOgogICAgICAgICAgICAgICAgc3RyZWFtX3VybCA9IHN0cmVhbV91cmwgKyImbW9kZT0xOCIKICAgICAgICAgICAgZWxpZiBtb2RlX3R5cGUgPT0gJ3JlZ2V4JzoKICAgICAgICAgICAgICAgIHVybCA9IHN0cmVhbV91cmwuc3BsaXQoJyZyZWdleHM9JykKICAgICAgICAgICAgICAgICNwcmludCB1cmxbMF0gZ2V0U291cCh1cmwsZGF0YT1Ob25lKQogICAgICAgICAgICAgICAgcmVnZXhzID0gcGFyc2VfcmVnZXgoZ2V0U291cCgnJyxkYXRhPXVybFsxXSkpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGFkZExpbmsodXJsWzBdLCBjaGFubmVsX25hbWUsdGh1bWJuYWlsLCcnLCcnLCcnLCcnLCcnLE5vbmUscmVnZXhzLHRvdGFsKQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICBhZGRMaW5rKHN0cmVhbV91cmwsIGNoYW5uZWxfbmFtZSx0aHVtYm5haWwsJycsJycsJycsJycsJycsTm9uZSwnJyx0b3RhbCkKCmRlZiBGaW5kRmlyc3RQYXR0ZXJuKHRleHQscGF0dGVybik6CiAgICByZXN1bHQgPSAiIgogICAgdHJ5OiAgICAKICAgICAgICBtYXRjaGVzID0gcmUuZmluZGFsbChwYXR0ZXJuLHRleHQsIGZsYWdzPXJlLkRPVEFMTCkKICAgICAgICByZXN1bHQgPSBtYXRjaGVzWzBdCiAgICBleGNlcHQ6CiAgICAgICAgcmVzdWx0ID0gIiIKCiAgICByZXR1cm4gcmVzdWx0CgkKZGVmIHJlZ2V4X2dldF9hbGwodGV4dCwgc3RhcnRfd2l0aCwgZW5kX3dpdGgpOgogICAgciA9IHJlLmZpbmRhbGwoIig/aSkoIiArIHN0YXJ0X3dpdGggKyAiW1xTXHNdKz8iICsgZW5kX3dpdGggKyAiKSIsIHRleHQpCiAgICByZXR1cm4gcgkJCQkKCmRlZiByZWdleF9mcm9tX3RvKHRleHQsIGZyb21fc3RyaW5nLCB0b19zdHJpbmcsIGV4Y2x1ZGluZz1UcnVlKToKICAgIGlmIGV4Y2x1ZGluZzoKCSAgIHRyeTogciA9IHJlLnNlYXJjaCgiKD9pKSIgKyBmcm9tX3N0cmluZyArICIoW1xTXHNdKz8pIiArIHRvX3N0cmluZywgdGV4dCkuZ3JvdXAoMSkKCSAgIGV4Y2VwdDogciA9ICcnCiAgICBlbHNlOgogICAgICAgdHJ5OiByID0gcmUuc2VhcmNoKCIoP2kpKCIgKyBmcm9tX3N0cmluZyArICJbXFNcc10rPyIgKyB0b19zdHJpbmcgKyAiKSIsIHRleHQpLmdyb3VwKDEpCiAgICAgICBleGNlcHQ6IHIgPSAnJwogICAgcmV0dXJuIHIKCmRlZiBnZXRJdGVtcyhpdGVtcyxmYW5hcnQpOgogICAgICAgIHRvdGFsID0gbGVuKGl0ZW1zKQogICAgICAgIHByaW50ICdTVEFSVCBHRVQgSVRFTVMgKioqKionCiAgICAgICAgYWRkb25fbG9nKCdUb3RhbCBJdGVtczogJXMnICV0b3RhbCkKICAgICAgICBmb3IgaXRlbSBpbiBpdGVtczoKICAgICAgICAgICAgaXNYTUxTb3VyY2U9RmFsc2UKICAgICAgICAgICAgaXNKc29ucnBjID0gRmFsc2UKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgbmFtZSA9IGl0ZW0oJ3RpdGxlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBuYW1lIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgbmFtZSA9ICd1bmtub3duPycKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdOYW1lIEVycm9yJykKICAgICAgICAgICAgICAgIG5hbWUgPSAnJwoKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlmIGl0ZW0oJ2VwZycpOgogICAgICAgICAgICAgICAgICAgIGlmIGl0ZW0uZXBnX3VybDoKICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCdHZXQgRVBHIFJlZ2V4JykKICAgICAgICAgICAgICAgICAgICAgICAgZXBnX3VybCA9IGl0ZW0uZXBnX3VybC5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXBnX3JlZ2V4ID0gaXRlbS5lcGdfcmVnZXguc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGVwZ19uYW1lID0gZ2V0X2VwZyhlcGdfdXJsLCBlcGdfcmVnZXgpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGVwZ19uYW1lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSArPSAnIC0gJyArIGVwZ19uYW1lCiAgICAgICAgICAgICAgICAgICAgZWxpZiBpdGVtKCdlcGcnKVswXS5zdHJpbmcgPiAxOgogICAgICAgICAgICAgICAgICAgICAgICBuYW1lICs9IGdldGVwZyhpdGVtKCdlcGcnKVswXS5zdHJpbmcpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdFUEcgRXJyb3InKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB1cmwgPSBbXQogICAgICAgICAgICAgICAgaWYgbGVuKGl0ZW0oJ2xpbmsnKSkgPjA6CiMgICAgICAgICAgICAgICAgICAgIHByaW50ICdpdGVtIGxpbmsnLCBpdGVtKCdsaW5rJykKICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdsaW5rJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChpLnN0cmluZykKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ3Nwb3J0c2RldmlsJykpID4wOgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ3Nwb3J0c2RldmlsJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BvcnRzZGV2aWwgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLlNwb3J0c0RldmlsLz9tb2RlPTEmYW1wO2l0ZW09Y2F0Y2hlciUzZHN0cmVhbXMlMjZ1cmw9JyAraS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZXIgPSBpdGVtKCdyZWZlcmVyJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiByZWZlcmVyOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAncmVmZXJlciBmb3VuZCcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcG9ydHNkZXZpbCA9IHNwb3J0c2RldmlsICsgJyUyNnJlZmVyZXI9JyArcmVmZXJlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChzcG9ydHNkZXZpbCkKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ3AycCcpKSA+MDoKICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdwMnAnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAnc29wOi8vJyBpbiBpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvcCA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ucDJwLXN0cmVhbXMvP3VybD0nK2kuc3RyaW5nICsnJmFtcDttb2RlPTImYW1wOycgKyAnbmFtZT0nK25hbWUgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChzb3ApIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwMnA9J3BsdWdpbjovL3BsdWdpbi52aWRlby5wMnAtc3RyZWFtcy8/dXJsPScraS5zdHJpbmcgKycmYW1wO21vZGU9MSZhbXA7JyArICduYW1lPScrbmFtZSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKHAycCkKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ3ZhdWdobicpKSA+MDoKICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCd2YXVnaG4nKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXVnaG4gPSAncGx1Z2luOi8vcGx1Z2luLnN0cmVhbS52YXVnaG5saXZlLnR2Lz9tb2RlPVBsYXlMaXZlU3RyZWFtJmFtcDtjaGFubmVsPScraS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQodmF1Z2huKQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgnaWxpdmUnKSkgPjA6CiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgnaWxpdmUnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgJ2h0dHAnIGluIGkuc3RyaW5nOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlsaXZlID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby50YmguaWxpdmUvP3VybD1odHRwOi8vd3d3LnN0cmVhbWxpdmUudG8vdmlldy8nK2kuc3RyaW5nKycmYW1wO2xpbms9OTkmYW1wO21vZGU9aUxpdmVQbGF5JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbGl2ZSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8udGJoLmlsaXZlLz91cmw9JytpLnN0cmluZysnJmFtcDtsaW5rPTk5JmFtcDttb2RlPWlMaXZlUGxheScKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ3l0LWRsJykpID4wOgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ3l0LWRsJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgeXRkbCA9IGkuc3RyaW5nICsgJyZtb2RlPTE4JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZCh5dGRsKQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgndXR1YmUnKSkgPjA6CiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgndXR1YmUnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4oaS5zdHJpbmcpID09IDExOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0dWJlID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby55b3V0dWJlL3BsYXkvP3ZpZGVvX2lkPScrIGkuc3RyaW5nIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBpLnN0cmluZy5zdGFydHN3aXRoKCdQTCcpIGFuZCBub3QgJyZvcmRlcj0nIGluIGkuc3RyaW5nIDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dHViZSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ueW91dHViZS9wbGF5Lz8mb3JkZXI9ZGVmYXVsdCZwbGF5bGlzdF9pZD0nICsgaS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXR1YmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlvdXR1YmUvcGxheS8/cGxheWxpc3RfaWQ9JyArIGkuc3RyaW5nIAogICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQodXR1YmUpCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCdpbWRiJykpID4wOgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ2ltZGInKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdnZW5lc2lzb3JwdWxzYXInKSA9PSAnMCc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1kYiA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uZ2VuZXNpcy8/YWN0aW9uPXBsYXkmaW1kYj0nK2kuc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltZGIgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnB1bHNhci9tb3ZpZS90dCcraS5zdHJpbmcrJy9wbGF5JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChpbWRiKSAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ2Y0bScpKSA+MDoKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgnZjRtJyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAnLmY0bScgaW4gaS5zdHJpbmc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGY0bSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uZjRtVGVzdGVyLz91cmw9Jyt1cmxsaWIucXVvdGVfcGx1cyhpLnN0cmluZykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmICcubTN1OCcgaW4gaS5zdHJpbmc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGY0bSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uZjRtVGVzdGVyLz91cmw9Jyt1cmxsaWIucXVvdGVfcGx1cyhpLnN0cmluZykrJyZhbXA7c3RyZWFtdHlwZT1ITFMnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGY0bSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uZjRtVGVzdGVyLz91cmw9Jyt1cmxsaWIucXVvdGVfcGx1cyhpLnN0cmluZykrJyZhbXA7c3RyZWFtdHlwZT1TSU1QTEUnCiAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoZjRtKQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgnZnR2JykpID4wOgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ2Z0dicpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ0diA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uRi5ULlYvP25hbWU9Jyt1cmxsaWIucXVvdGUobmFtZSkgKycmdXJsPScgK2kuc3RyaW5nICsnJm1vZGU9MTI1JmNoX2ZhbmFydD1uYScKICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChmdHYpICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBsZW4odXJsKSA8IDE6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdFcnJvciA8bGluaz4gZWxlbWVudCwgUGFzc2luZzonK25hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgaXNYTUxTb3VyY2U9RmFsc2UKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlzWE1MU291cmNlID0gaXRlbSgnZXh0ZXJuYWxsaW5rJylbMF0uc3RyaW5nCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgaXNYTUxTb3VyY2U6CiAgICAgICAgICAgICAgICBleHRfdXJsPVtpc1hNTFNvdXJjZV0KICAgICAgICAgICAgICAgIGlzWE1MU291cmNlPVRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGlzWE1MU291cmNlPUZhbHNlCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlzSnNvbnJwYyA9IGl0ZW0oJ2pzb25ycGMnKVswXS5zdHJpbmcKICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgICAgIGlmIGlzSnNvbnJwYzoKICAgICAgICAgICAgICAgIGV4dF91cmw9W2lzSnNvbnJwY10KICAgICAgICAgICAgICAgIGlzSnNvbnJwYz1UcnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBpc0pzb25ycGM9RmFsc2UgICAgICAgICAgICAKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gaXRlbSgndGh1bWJuYWlsJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiB0aHVtYm5haWwgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSAnJwogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpZiBub3QgaXRlbSgnZmFuYXJ0Jyk6CiAgICAgICAgICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygndXNlX3RodW1iJykgPT0gInRydWUiOgogICAgICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSB0aHVtYm5haWwKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBmYW5hcnQKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gaXRlbSgnZmFuYXJ0JylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBmYW5BcnQgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBmYW5BcnQgPSBmYW5hcnQKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZGVzYyA9IGl0ZW0oJ2luZm8nKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgIGlmIGRlc2MgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBkZXNjID0gJycKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGdlbnJlID0gaXRlbSgnZ2VucmUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgIGlmIGdlbnJlID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgZ2VucmUgPSAnJwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZGF0ZSA9IGl0ZW0oJ2RhdGUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgIGlmIGRhdGUgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBkYXRlID0gJycKCiAgICAgICAgICAgIHJlZ2V4cyA9IE5vbmUKICAgICAgICAgICAgaWYgaXRlbSgncmVnZXgnKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICByZWdfaXRlbSA9IGl0ZW0oJ3JlZ2V4JykKICAgICAgICAgICAgICAgICAgICByZWdleHMgPSBwYXJzZV9yZWdleChyZWdfaXRlbSkKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBwYXNzICAgICAgICAgICAgCiAgICAgICAgICAgCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlmIGxlbih1cmwpID4gMToKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBhbHQgPSAwCiAgICAgICAgICAgICAgICAgICAgcGxheWxpc3QgPSBbXQogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHVybDoKICAgICAgICAgICAgICAgICAgICAJaWYgYWRkb24uZ2V0U2V0dGluZygnYXNrX3BsYXlsaXN0X2l0ZW1zJykgPT0gJ3RydWUnOgoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmVnZXhzOgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0LmFwcGVuZChpKycmcmVnZXhzPScrcmVnZXhzKQoJICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiAgYW55KHggaW4gaSBmb3IgeCBpbiByZXNvbHZlX3VybCkgYW5kICBpLnN0YXJ0c3dpdGgoJ2h0dHAnKToKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5bGlzdC5hcHBlbmQoaSsnJm1vZGU9MTknKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0LmFwcGVuZChpKQogICAgICAgICAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ2FkZF9wbGF5bGlzdCcpID09ICJmYWxzZSI6ICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHVybDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbHQgKz0gMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdBRERMSU5LIDEnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkTGluayhpLCclcykgJXMnICUoYWx0LCBuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLFRydWUscGxheWxpc3QscmVnZXhzLHRvdGFsKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBhZGRMaW5rKCcnLCBuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJyksdGh1bWJuYWlsLGZhbkFydCxkZXNjLGdlbnJlLGRhdGUsVHJ1ZSxwbGF5bGlzdCxyZWdleHMsdG90YWwpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGlmIGlzWE1MU291cmNlOgogICAgICAgICAgICAgICAgICAgIAlhZGREaXIobmFtZS5lbmNvZGUoJ3V0Zi04JyksZXh0X3VybFswXS5lbmNvZGUoJ3V0Zi04JyksMSx0aHVtYm5haWwsZmFuYXJ0LGRlc2MsZ2VucmUsZGF0ZSxOb25lLCdzb3VyY2UnKQogICAgICAgICAgICAgICAgICAgIGVsaWYgaXNKc29ucnBjOgogICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZS5lbmNvZGUoJ3V0Zi04JyksZXh0X3VybFswXSw1Myx0aHVtYm5haWwsZmFuYXJ0LGRlc2MsZ2VucmUsZGF0ZSxOb25lLCdzb3VyY2UnKQogICAgICAgICAgICAgICAgICAgIGVsaWYgdXJsWzBdLmZpbmQoJ3N1YmxpbmsnKSA+IDA6CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSx1cmxbMF0sMzAsdGh1bWJuYWlsLGZhbmFydCwnJywnJywnJywnJykKICAgICAgICAgICAgICAgICAgICAgICAgI2FkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSx1cmxbMF0sMzAsdGh1bWJuYWlsLGZhbmFydCxkZXNjLGdlbnJlLGRhdGUsJ3N1YmxpbmsnKQkJCQkKICAgICAgICAgICAgICAgICAgICBlbHNlOiAKICAgICAgICAgICAgICAgICAgICAgICAgYWRkTGluayh1cmxbMF0sbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLFRydWUsTm9uZSxyZWdleHMsdG90YWwpCgogICAgICAgICAgICAgICAgICAgICNwcmludCAnc3VjY2VzcycKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdUaGVyZSB3YXMgYSBwcm9ibGVtIGFkZGluZyBpdGVtIC0gJytuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpCiAgICAgICAgcHJpbnQgJ0ZJTklTSCBHRVQgSVRFTVMgKioqKionICAgICAgCgpkZWYgcGFyc2VfcmVnZXgocmVnX2l0ZW0pOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHJlZ2V4cyA9IHt9CiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gcmVnX2l0ZW06CiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXSA9IHt9CiAgICAgICAgICAgICAgICAgICAgICAgICNyZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2V4cHJlJ10gPSBpKCdleHByZXMnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydleHByZSddID0gaSgnZXhwcmVzJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydleHByZSddOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnZXhwcmUnXT0nJwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBSZWZlcmVyIC0tIikKICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydwYWdlJ10gPSBpKCdwYWdlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsncmVmZXInXSA9IGkoJ3JlZmVyZXInKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gUmVmZXJlciAtLSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnY29ubmVjdGlvbiddID0gaSgnY29ubmVjdGlvbicpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBjb25uZWN0aW9uIC0tIikKCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnbm90cGxheWFibGUnXSA9IGkoJ25vdHBsYXlhYmxlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIG5vdHBsYXlhYmxlIC0tIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ25vcmVkaXJlY3QnXSA9IGkoJ25vcmVkaXJlY3QnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gbm9yZWRpcmVjdCAtLSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnb3JpZ2luJ10gPSBpKCdvcmlnaW4nKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gb3JpZ2luIC0tIikKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydpbmNsdWRlaGVhZGVycyddID0gaSgnaW5jbHVkZWhlYWRlcnMnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gaW5jbHVkZWhlYWRlcnMgLS0iKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3gtcmVxJ10gPSBpKCd4LXJlcScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyB4LXJlcSAtLSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsneC1mb3J3YXJkJ10gPSBpKCd4LWZvcndhcmQnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8geC1mb3J3YXJkIC0tIikKCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnYWdlbnQnXSA9IGkoJ2FnZW50JylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIFVzZXIgQWdlbnQgLS0iKQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3Bvc3QnXSA9IGkoJ3Bvc3QnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm90IGEgcG9zdCIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsncmF3cG9zdCddID0gaSgncmF3cG9zdCcpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBOb3QgYSByYXdwb3N0IikKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydodG1sdW5lc2NhcGUnXSA9IGkoJ2h0bWx1bmVzY2FwZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBOb3QgYSBodG1sdW5lc2NhcGUiKQoKCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsncmVhZGNvb2tpZW9ubHknXSA9IGkoJ3JlYWRjb29raWVvbmx5JylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIHJlYWRDb29raWVPbmx5IikKICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50IGkKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydjb29raWVqYXInXSA9IGkoJ2Nvb2tpZWphcicpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnY29va2llamFyJ106CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydjb29raWVqYXInXT0nJwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBOb3QgYSBjb29raWVKYXIiKQkJCQkJCQkKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydzZXRjb29raWUnXSA9IGkoJ3NldGNvb2tpZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBOb3QgYSBzZXRjb29raWUiKQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2FwcGVuZGNvb2tpZSddID0gaSgnYXBwZW5kY29va2llJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIGFwcGVuZGNvb2tpZSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydpZ25vcmVjYWNoZSddID0gaSgnaWdub3JlY2FjaGUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gbm8gaWdub3JlY2FjaGUiKQogICAgICAgICAgICAgICAgICAgICAgICAjdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAjICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnaWdub3JlY2FjaGUnXSA9IGkoJ2lnbm9yZWNhY2hlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICNleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICMgICAgYWRkb25fbG9nKCJSZWdleDogLS0gbm8gaWdub3JlY2FjaGUiKQkJCQoKICAgICAgICAgICAgICAgICAgICByZWdleHMgPSB1cmxsaWIucXVvdGUocmVwcihyZWdleHMpKQogICAgICAgICAgICAgICAgICAgIHJldHVybiByZWdleHMKICAgICAgICAgICAgICAgICAgICAjcHJpbnQgcmVnZXhzCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgcmVnZXhzID0gTm9uZQogICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygncmVnZXggRXJyb3I6ICcrbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpKQojY29waWVzIGZyb20gbGFtZGEncyBpbXBsZW1lbnRhdGlvbgpkZWYgZ2V0X3VzdHJlYW0odXJsKToKICAgIHRyeToKICAgICAgICBmb3IgaSBpbiByYW5nZSgxLCA1MSk6CiAgICAgICAgICAgIHJlc3VsdCA9IGdldFVybCh1cmwpCiAgICAgICAgICAgIGlmICJFWFQtWC1TVFJFQU0tSU5GIiBpbiByZXN1bHQ6IHJldHVybiB1cmwKICAgICAgICAgICAgaWYgbm90ICJFWFRNM1UiIGluIHJlc3VsdDogcmV0dXJuCiAgICAgICAgICAgIHhibWMuc2xlZXAoMjAwMCkKICAgICAgICByZXR1cm4KICAgIGV4Y2VwdDoKICAgICAgICByZXR1cm4KICAgICAgICAKIApkZWYgZ2V0UmVnZXhQYXJzZWQocmVnZXhzLCB1cmwsY29va2llSmFyPU5vbmUsZm9yQ29va2llSmFyT25seT1GYWxzZSxyZWN1cnNpdmVDYWxsPUZhbHNlLGNhY2hlZFBhZ2VzPXt9LCByYXdQb3N0PUZhbHNlLCBjb29raWVfamFyX2ZpbGU9Tm9uZSk6IzAsMSwyID0gVVJMLCByZWdleE9ubHksIENvb2tpZUphck9ubHkKICAgICAgICBpZiBub3QgcmVjdXJzaXZlQ2FsbDoKICAgICAgICAgICAgcmVnZXhzID0gZXZhbCh1cmxsaWIudW5xdW90ZShyZWdleHMpKQogICAgICAgICNjYWNoZWRQYWdlcyA9IHt9CiAgICAgICAgI3ByaW50ICd1cmwnLHVybAogICAgICAgIGRvUmVnZXhzID0gcmUuY29tcGlsZSgnXCRkb3JlZ2V4XFsoW15cXV0qKVxdJykuZmluZGFsbCh1cmwpCiAgICAgICAgI3ByaW50ICdkb1JlZ2V4cycsZG9SZWdleHMscmVnZXhzCiAgICAgICAgc2V0cmVzb2x2ZWQ9VHJ1ZQogICAgICAgICAgICAgIAogCgoKICAgICAgICBmb3IgayBpbiBkb1JlZ2V4czoKICAgICAgICAgICAgaWYgayBpbiByZWdleHM6CiAgICAgICAgICAgICAgICAjcHJpbnQgJ3Byb2Nlc3NpbmcgJyAsawogICAgICAgICAgICAgICAgbSA9IHJlZ2V4c1trXQogICAgICAgICAgICAgICAgI3ByaW50IG0KICAgICAgICAgICAgICAgIGNvb2tpZUphclBhcmFtPUZhbHNlCgoKICAgICAgICAgICAgICAgIGlmICAnY29va2llamFyJyBpbiBtOiAjIHNvIGVpdGhlciBjcmVhdGUgb3IgcmV1c2UgZXhpc3RpbmcgamFyCiAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdjb29raWVqYXIgZXhpc3RzJyxtWydjb29raWVqYXInXQogICAgICAgICAgICAgICAgICAgIGNvb2tpZUphclBhcmFtPW1bJ2Nvb2tpZWphciddCiAgICAgICAgICAgICAgICAgICAgaWYgICckZG9yZWdleCcgaW4gY29va2llSmFyUGFyYW06CiAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZUphcj1nZXRSZWdleFBhcnNlZChyZWdleHMsIG1bJ2Nvb2tpZWphciddLGNvb2tpZUphcixUcnVlLCBUcnVlLGNhY2hlZFBhZ2VzKQogICAgICAgICAgICAgICAgICAgICAgICBjb29raWVKYXJQYXJhbT1UcnVlCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgY29va2llSmFyUGFyYW09VHJ1ZQogICAgICAgICAgICAgICAgI3ByaW50ICdtW2Nvb2tpZWphcl0nLG1bJ2Nvb2tpZWphciddLGNvb2tpZUphcgogICAgICAgICAgICAgICAgaWYgY29va2llSmFyUGFyYW06CiAgICAgICAgICAgICAgICAgICAgaWYgY29va2llSmFyPT1Ob25lOgogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2NyZWF0ZSBjb29raWUgamFyJwogICAgICAgICAgICAgICAgICAgICAgICBjb29raWVfamFyX2ZpbGU9Tm9uZQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnb3BlblsnIGluIG1bJ2Nvb2tpZWphciddOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29va2llX2phcl9maWxlPW1bJ2Nvb2tpZWphciddLnNwbGl0KCdvcGVuWycpWzFdLnNwbGl0KCddJylbMF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBjb29raWVKYXI9Z2V0Q29va2llSmFyKGNvb2tpZV9qYXJfZmlsZSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgY29va2llX2phcl9maWxlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZUNvb2tpZUphcihjb29raWVKYXIsY29va2llX2phcl9maWxlKQogICAgICAgICAgICAgICAgICAgICAgICAjaW1wb3J0IGNvb2tpZWxpYgogICAgICAgICAgICAgICAgICAgICAgICAjY29va2llSmFyID0gY29va2llbGliLkxXUENvb2tpZUphcigpCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnY29va2llSmFyIG5ldycsY29va2llSmFyCiAgICAgICAgICAgICAgICAgICAgZWxpZiAnc2F2ZVsnIGluIG1bJ2Nvb2tpZWphciddOgogICAgICAgICAgICAgICAgICAgICAgICBjb29raWVfamFyX2ZpbGU9bVsnY29va2llamFyJ10uc3BsaXQoJ3NhdmVbJylbMV0uc3BsaXQoJ10nKVswXQogICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZV9wYXRoPW9zLnBhdGguam9pbihwcm9maWxlLGNvb2tpZV9qYXJfZmlsZSkKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2NvbXBsZXRlX3BhdGgnLGNvbXBsZXRlX3BhdGgKICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZUNvb2tpZUphcihjb29raWVKYXIsY29va2llX2phcl9maWxlKQogICAgICAgICAgICAgICAgICAgICAgICAKIAogICAgICAgICAgICAgICAgaWYgIG1bJ3BhZ2UnXSBhbmQgJyRkb3JlZ2V4JyBpbiBtWydwYWdlJ106CiAgICAgICAgICAgICAgICAgICAgbVsncGFnZSddPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgbVsncGFnZSddLGNvb2tpZUphcixyZWN1cnNpdmVDYWxsPVRydWUsY2FjaGVkUGFnZXM9Y2FjaGVkUGFnZXMpCgogICAgICAgICAgICAgICAgaWYgJ3NldGNvb2tpZScgaW4gbSBhbmQgbVsnc2V0Y29va2llJ10gYW5kICckZG9yZWdleCcgaW4gbVsnc2V0Y29va2llJ106CiAgICAgICAgICAgICAgICAgICAgbVsnc2V0Y29va2llJ109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydzZXRjb29raWUnXSxjb29raWVKYXIscmVjdXJzaXZlQ2FsbD1UcnVlLGNhY2hlZFBhZ2VzPWNhY2hlZFBhZ2VzKQogICAgICAgICAgICAgICAgaWYgJ2FwcGVuZGNvb2tpZScgaW4gbSBhbmQgbVsnYXBwZW5kY29va2llJ10gYW5kICckZG9yZWdleCcgaW4gbVsnYXBwZW5kY29va2llJ106CiAgICAgICAgICAgICAgICAgICAgbVsnYXBwZW5kY29va2llJ109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydhcHBlbmRjb29raWUnXSxjb29raWVKYXIscmVjdXJzaXZlQ2FsbD1UcnVlLGNhY2hlZFBhZ2VzPWNhY2hlZFBhZ2VzKQoKICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmICAncG9zdCcgaW4gbSBhbmQgJyRkb3JlZ2V4JyBpbiBtWydwb3N0J106CiAgICAgICAgICAgICAgICAgICAgbVsncG9zdCddPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgbVsncG9zdCddLGNvb2tpZUphcixyZWN1cnNpdmVDYWxsPVRydWUsY2FjaGVkUGFnZXM9Y2FjaGVkUGFnZXMpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ3Bvc3QgaXMgbm93JyxtWydwb3N0J10KCiAgICAgICAgICAgICAgICBpZiAgJ3Jhd3Bvc3QnIGluIG0gYW5kICckZG9yZWdleCcgaW4gbVsncmF3cG9zdCddOgogICAgICAgICAgICAgICAgICAgIG1bJ3Jhd3Bvc3QnXT1nZXRSZWdleFBhcnNlZChyZWdleHMsIG1bJ3Jhd3Bvc3QnXSxjb29raWVKYXIscmVjdXJzaXZlQ2FsbD1UcnVlLGNhY2hlZFBhZ2VzPWNhY2hlZFBhZ2VzLHJhd1Bvc3Q9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3Jhd3Bvc3QgaXMgbm93JyxtWydyYXdwb3N0J10KICAKICAgICAgICAgICAgICAgIGlmICdyYXdwb3N0JyBpbiBtIGFuZCAnJGVwb2N0aW1lJCcgaW4gbVsncmF3cG9zdCddOgogICAgICAgICAgICAgICAgICAgIG1bJ3Jhd3Bvc3QnXT1tWydyYXdwb3N0J10ucmVwbGFjZSgnJGVwb2N0aW1lJCcsZ2V0RXBvY1RpbWUoKSkKICAKICAgICAgICAgICAgICAgIGlmICdyYXdwb3N0JyBpbiBtIGFuZCAnJGVwb2N0aW1lMiQnIGluIG1bJ3Jhd3Bvc3QnXToKICAgICAgICAgICAgICAgICAgICBtWydyYXdwb3N0J109bVsncmF3cG9zdCddLnJlcGxhY2UoJyRlcG9jdGltZTIkJyxnZXRFcG9jVGltZTIoKSkKCiAgCiAgICAgICAgICAgICAgICBsaW5rPScnCiAgICAgICAgICAgICAgICBpZiBtWydwYWdlJ10gYW5kIG1bJ3BhZ2UnXSBpbiBjYWNoZWRQYWdlcyBhbmQgbm90ICdpZ25vcmVjYWNoZScgaW4gbSBhbmQgZm9yQ29va2llSmFyT25seT09RmFsc2UgOgogICAgICAgICAgICAgICAgICAgIGxpbmsgPSBjYWNoZWRQYWdlc1ttWydwYWdlJ11dCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGlmIG1bJ3BhZ2UnXSBhbmQgIG5vdCBtWydwYWdlJ109PScnIGFuZCAgbVsncGFnZSddLnN0YXJ0c3dpdGgoJ2h0dHAnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJyRlcG9jdGltZSQnIGluIG1bJ3BhZ2UnXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1bJ3BhZ2UnXT1tWydwYWdlJ10ucmVwbGFjZSgnJGVwb2N0aW1lJCcsZ2V0RXBvY1RpbWUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJyRlcG9jdGltZTIkJyBpbiBtWydwYWdlJ106CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtWydwYWdlJ109bVsncGFnZSddLnJlcGxhY2UoJyRlcG9jdGltZTIkJyxnZXRFcG9jVGltZTIoKSkKCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnSW5nb3JpbmcgQ2FjaGUnLG1bJ3BhZ2UnXQogICAgICAgICAgICAgICAgICAgICAgICBwYWdlX3NwbGl0PW1bJ3BhZ2UnXS5zcGxpdCgnfCcpCiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VVcmw9cGFnZV9zcGxpdFswXQogICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJfaW5fcGFnZT1Ob25lCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihwYWdlX3NwbGl0KT4xOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyX2luX3BhZ2U9cGFnZV9zcGxpdFsxXQogICAgICAgICAgICAgICAgICAgICAgICByZXEgPSB1cmxsaWIyLlJlcXVlc3QocGFnZVVybCkKICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1VzZXItQWdlbnQnLCAnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgNi4xOyBydjoxNC4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzE0LjAuMScpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdyZWZlcicgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdSZWZlcmVyJywgbVsncmVmZXInXSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ2FnZW50JyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1VzZXItYWdlbnQnLCBtWydhZ2VudCddKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAneC1yZXEnIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcignWC1SZXF1ZXN0ZWQtV2l0aCcsIG1bJ3gtcmVxJ10pCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICd4LWZvcndhcmQnIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcignWC1Gb3J3YXJkZWQtRm9yJywgbVsneC1mb3J3YXJkJ10pCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdzZXRjb29raWUnIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnYWRkaW5nIGNvb2tpZScsbVsnc2V0Y29va2llJ10KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdDb29raWUnLCBtWydzZXRjb29raWUnXSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ2FwcGVuZGNvb2tpZScgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdhcHBlbmRpbmcgY29va2llIHRvIGNvb2tpZWphcicsbVsnYXBwZW5kY29va2llJ10KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZXN0b0FwZW5kPW1bJ2FwcGVuZGNvb2tpZSddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWVzdG9BcGVuZD1jb29raWVzdG9BcGVuZC5zcGxpdCgnOycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaCBpbiBjb29raWVzdG9BcGVuZDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLHY9aC5zcGxpdCgnPScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdyxuPSBuLnNwbGl0KCc6JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjayA9IGNvb2tpZWxpYi5Db29raWUodmVyc2lvbj0wLCBuYW1lPW4sIHZhbHVlPXYsIHBvcnQ9Tm9uZSwgcG9ydF9zcGVjaWZpZWQ9RmFsc2UsIGRvbWFpbj13LCBkb21haW5fc3BlY2lmaWVkPUZhbHNlLCBkb21haW5faW5pdGlhbF9kb3Q9RmFsc2UsIHBhdGg9Jy8nLCBwYXRoX3NwZWNpZmllZD1UcnVlLCBzZWN1cmU9RmFsc2UsIGV4cGlyZXM9Tm9uZSwgZGlzY2FyZD1UcnVlLCBjb21tZW50PU5vbmUsIGNvbW1lbnRfdXJsPU5vbmUsIHJlc3Q9eydIdHRwT25seSc6IE5vbmV9LCByZmMyMTA5PUZhbHNlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZUphci5zZXRfY29va2llKGNrKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ29yaWdpbicgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdPcmlnaW4nLCBtWydvcmlnaW4nXSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgaGVhZGVyX2luX3BhZ2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJfaW5fcGFnZT1oZWFkZXJfaW5fcGFnZS5zcGxpdCgnJicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaCBpbiBoZWFkZXJfaW5fcGFnZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLHY9aC5zcGxpdCgnPScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIobix2KQoKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBjb29raWVKYXI9PU5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2Nvb2tpZUphclZhbCcsY29va2llSmFyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWVfaGFuZGxlciA9IHVybGxpYjIuSFRUUENvb2tpZVByb2Nlc3Nvcihjb29raWVKYXIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuZXIgPSB1cmxsaWIyLmJ1aWxkX29wZW5lcihjb29raWVfaGFuZGxlciwgdXJsbGliMi5IVFRQQmFzaWNBdXRoSGFuZGxlcigpLCB1cmxsaWIyLkhUVFBIYW5kbGVyKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuZXIgPSB1cmxsaWIyLmluc3RhbGxfb3BlbmVyKG9wZW5lcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICdub3JlZGlyZWN0JyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lcjIgPSB1cmxsaWIyLmJ1aWxkX29wZW5lcihOb1JlZGlyZWN0aW9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lciA9IHVybGxpYjIuaW5zdGFsbF9vcGVuZXIob3BlbmVyMikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ2Nvbm5lY3Rpb24nIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi5jb25uZWN0aW9uLy8vLy8vLicsbVsnY29ubmVjdGlvbiddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tIGtlZXBhbGl2ZSBpbXBvcnQgSFRUUEhhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtlZXBhbGl2ZV9oYW5kbGVyID0gSFRUUEhhbmRsZXIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyID0gdXJsbGliMi5idWlsZF9vcGVuZXIoa2VlcGFsaXZlX2hhbmRsZXIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmxsaWIyLmluc3RhbGxfb3BlbmVyKG9wZW5lcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2FmdGVyIGNvb2tpZSBqYXInCiAgICAgICAgICAgICAgICAgICAgICAgIHBvc3Q9Tm9uZQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3Bvc3QnIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0RGF0YT1tWydwb3N0J10KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICckTGl2ZVN0cmVhbVJlY2FwdGNoYScgaW4gcG9zdERhdGE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNhcHRjaGFfY2hhbGxlbmdlLGNhdHBjaGFfd29yZCk9cHJvY2Vzc1JlY2FwdGNoYShtWydwYWdlJ10pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2FwdGNoYV9jaGFsbGVuZ2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3REYXRhKz0ncmVjYXB0Y2hhX2NoYWxsZW5nZV9maWVsZDonK2NhcHRjaGFfY2hhbGxlbmdlKycscmVjYXB0Y2hhX3Jlc3BvbnNlX2ZpZWxkOicrY2F0cGNoYV93b3JkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGxpdHBvc3Q9cG9zdERhdGEuc3BsaXQoJywnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3Q9e30KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBwIGluIHNwbGl0cG9zdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuPXAuc3BsaXQoJzonKVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2PXAuc3BsaXQoJzonKVsxXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0W25dPXYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3QgPSB1cmxsaWIudXJsZW5jb2RlKHBvc3QpCgogICAgICAgICAgICAgICAgICAgICAgICBpZiAncmF3cG9zdCcgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3Q9bVsncmF3cG9zdCddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAnJExpdmVTdHJlYW1SZWNhcHRjaGEnIGluIHBvc3Q6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNhcHRjaGFfY2hhbGxlbmdlLGNhdHBjaGFfd29yZCk9cHJvY2Vzc1JlY2FwdGNoYShtWydwYWdlJ10pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2FwdGNoYV9jaGFsbGVuZ2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdCs9JyZyZWNhcHRjaGFfY2hhbGxlbmdlX2ZpZWxkPScrY2FwdGNoYV9jaGFsbGVuZ2UrJyZyZWNhcHRjaGFfcmVzcG9uc2VfZmllbGQ9JytjYXRwY2hhX3dvcmQKCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgCgogICAgICAgICAgICAgICAgICAgICAgICBpZiBwb3N0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSB1cmxsaWIyLnVybG9wZW4ocmVxLHBvc3QpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IHVybGxpYjIudXJsb3BlbihyZXEpCgogICAgICAgICAgICAgICAgICAgICAgICBsaW5rID0gcmVzcG9uc2UucmVhZCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGxpbms9amF2YXNjcmlwdFVuRXNjYXBlKGxpbmspCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCBsaW5rIFRoaXMganVzdCBwcmludCB3aG9sZSB3ZWJwYWdlIGluIExPRwogICAgICAgICAgICAgICAgICAgICAgICBpZiAnaW5jbHVkZWhlYWRlcnMnIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rKz1zdHIocmVzcG9uc2UuaGVhZGVycy5nZXQoJ1NldC1Db29raWUnKSkKCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmNsb3NlKCkKICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGVkUGFnZXNbbVsncGFnZSddXSA9IGxpbmsKICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50IGxpbmsKICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdzdG9yZSBsaW5rIGZvcicsbVsncGFnZSddLGZvckNvb2tpZUphck9ubHkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGZvckNvb2tpZUphck9ubHk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29va2llSmFyIyBkbyBub3RoaW5nCiAgICAgICAgICAgICAgICAgICAgZWxpZiBtWydwYWdlJ10gYW5kICBub3QgbVsncGFnZSddLnN0YXJ0c3dpdGgoJ2h0dHAnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbVsncGFnZSddLnN0YXJ0c3dpdGgoJyRweUZ1bmN0aW9uOicpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPWRvRXZhbChtWydwYWdlJ10uc3BsaXQoJyRweUZ1bmN0aW9uOicpWzFdLCcnLGNvb2tpZUphciApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBmb3JDb29raWVKYXJPbmx5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb29raWVKYXIjIGRvIG5vdGhpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbms9dmFsCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rPW1bJ3BhZ2UnXQogICAgICAgICAgICAgICAgaWYgJyRweUZ1bmN0aW9uOnBsYXltZWRpYSgnIGluIG1bJ2V4cHJlJ10gb3IgJ0FjdGl2YXRlV2luZG93JyAgaW4gbVsnZXhwcmUnXSAgIG9yICBhbnkoeCBpbiB1cmwgZm9yIHggaW4gZ19pZ25vcmVTZXRSZXNvbHZlZCk6CiAgICAgICAgICAgICAgICAgICAgc2V0cmVzb2x2ZWQ9RmFsc2UKICAgICAgICAgICAgICAgIGlmICAnJGRvcmVnZXgnIGluIG1bJ2V4cHJlJ106CiAgICAgICAgICAgICAgICAgICAgbVsnZXhwcmUnXT1nZXRSZWdleFBhcnNlZChyZWdleHMsIG1bJ2V4cHJlJ10sY29va2llSmFyLHJlY3Vyc2l2ZUNhbGw9VHJ1ZSxjYWNoZWRQYWdlcz1jYWNoZWRQYWdlcykKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IG1bJ2V4cHJlJ109PScnOgogICAgICAgICAgICAgICAgICAgIHByaW50ICdkb2luZyBpdCAnLG1bJ2V4cHJlJ10KICAgICAgICAgICAgICAgICAgICBpZiAnJExpdmVTdHJlYW1DYXB0Y2hhJyBpbiBtWydleHByZSddOgogICAgICAgICAgICAgICAgICAgICAgICB2YWw9YXNrQ2FwdGNoYShtLGxpbmssY29va2llSmFyKQogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3VybCBhbmQgdmFsJyx1cmwsdmFsCiAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCIkZG9yZWdleFsiICsgayArICJdIiwgdmFsKQogICAgICAgICAgICAgICAgICAgIGVsaWYgbVsnZXhwcmUnXS5zdGFydHN3aXRoKCckcHlGdW5jdGlvbjonKToKICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdleHBlZWVlZWVlZWVlZWVlZWVlZWVlJyxtWydleHByZSddCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1kb0V2YWwobVsnZXhwcmUnXS5zcGxpdCgnJHB5RnVuY3Rpb246JylbMV0sbGluayxjb29raWVKYXIgKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnQWN0aXZhdGVXaW5kb3cnIGluIG1bJ2V4cHJlJ106IHJldHVybiAKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ3N0aWxsIGhyZScKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ3VybCBrIHZhbCcsdXJsLGssdmFsCgogICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgiJGRvcmVnZXhbIiArIGsgKyAiXSIsIHZhbCkKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgbGluaz09Jyc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWcgPSByZS5jb21waWxlKG1bJ2V4cHJlJ10pLnNlYXJjaChsaW5rKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPScnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPXJlZy5ncm91cCgxKS5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6IHRyYWNlYmFjay5wcmludF9leGMoKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPW1bJ2V4cHJlJ10KICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmF3UG9zdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdyYXdwb3N0JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPXVybGxpYi5xdW90ZV9wbHVzKHZhbCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ2h0bWx1bmVzY2FwZScgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICN2YWw9dXJsbGliLnVucXVvdGVfcGx1cyh2YWwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnQgSFRNTFBhcnNlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPUhUTUxQYXJzZXIuSFRNTFBhcnNlcigpLnVuZXNjYXBlKHZhbCkgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoIiRkb3JlZ2V4WyIgKyBrICsgIl0iLCB2YWwpCiAgICAgICAgICAgICAgICAgICAgICAgICNyZXR1cm4gdmFsCiAgICAgICAgICAgICAgICBlbHNlOiAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoIiRkb3JlZ2V4WyIgKyBrICsgIl0iLCcnKQogICAgICAgIGlmICckZXBvY3RpbWUkJyBpbiB1cmw6CiAgICAgICAgICAgIHVybD11cmwucmVwbGFjZSgnJGVwb2N0aW1lJCcsZ2V0RXBvY1RpbWUoKSkKICAgICAgICBpZiAnJGVwb2N0aW1lMiQnIGluIHVybDoKICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCckZXBvY3RpbWUyJCcsZ2V0RXBvY1RpbWUyKCkpCgogICAgICAgIGlmICckR1VJRCQnIGluIHVybDoKICAgICAgICAgICAgaW1wb3J0IHV1aWQKICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCckR1VJRCQnLHN0cih1dWlkLnV1aWQxKCkpLnVwcGVyKCkpCiAgICAgICAgaWYgJyRnZXRfY29va2llcyQnIGluIHVybDoKICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCckZ2V0X2Nvb2tpZXMkJyxnZXRDb29raWVzU3RyaW5nKGNvb2tpZUphcikpICAgCgogICAgICAgIGlmIHJlY3Vyc2l2ZUNhbGw6IHJldHVybiB1cmwKICAgICAgICBwcmludCAnZmluYWwgdXJsJyx1cmwKICAgICAgICBpZiB1cmw9PSIiOiAKICAgICAgICAJcmV0dXJuCiAgICAgICAgZWxzZToKICAgICAgICAJcmV0dXJuIHVybCxzZXRyZXNvbHZlZAoKICAgICAgICAgICAgCiAgICAgICAgCmRlZiBnZXRtZDUodCk6CiAgICBpbXBvcnQgaGFzaGxpYgogICAgaD1oYXNobGliLm1kNSgpCiAgICBoLnVwZGF0ZSh0KQogICAgcmV0dXJuIGguaGV4ZGlnZXN0KCkKCmRlZiBkZWNyeXB0X3ZhdWdobmxpdmUoZW5jcnlwdGVkKToKICAgIHJldFZhbD0iIgogICAgZm9yIHZhbCBpbiBlbmNyeXB0ZWQuc3BsaXQoJzonKToKICAgICAgICByZXRWYWwrPWNocihpbnQodmFsLnJlcGxhY2UoIjBtMCIsIiIpKS84NC81KQogICAgcmV0dXJuIHJldFZhbAoKZGVmIHBsYXltZWRpYShtZWRpYV91cmwpOgogICAgdHJ5OgogICAgICAgIGltcG9ydCAgQ3VzdG9tUGxheWVyCiAgICAgICAgcGxheWVyID0gQ3VzdG9tUGxheWVyLk15WEJNQ1BsYXllcigpCiAgICAgICAgbGlzdGl0ZW0gPSB4Ym1jZ3VpLkxpc3RJdGVtKCBsYWJlbCA9IHN0cihuYW1lKSwgaWNvbkltYWdlID0gIkRlZmF1bHRWaWRlby5wbmciLCB0aHVtYm5haWxJbWFnZSA9IHhibWMuZ2V0SW5mb0ltYWdlKCAiTGlzdEl0ZW0uVGh1bWIiICksIHBhdGg9bWVkaWFfdXJsICkKICAgICAgICBwbGF5ZXIucGxheSggbWVkaWFfdXJsLGxpc3RpdGVtKQogICAgICAgIHhibWMuc2xlZXAoMTAwMCkKICAgICAgICB3aGlsZSBwbGF5ZXIuaXNfYWN0aXZlOgogICAgICAgICAgICB4Ym1jLnNsZWVwKDIwMCkKICAgIGV4Y2VwdDoKICAgICAgICB0cmFjZWJhY2sucHJpbnRfZXhjKCkKICAgIHJldHVybiAnJwogICAgCiAgICAgICAgCmRlZiBnZXRfc2F3X3J0bXAocGFnZV92YWx1ZSwgcmVmZXJlcj1Ob25lKToKICAgIGlmIHJlZmVyZXI6CiAgICAgICAgcmVmZXJlcj1bKCdSZWZlcmVyJyxyZWZlcmVyKV0KICAgIGlmIHBhZ2VfdmFsdWUuc3RhcnRzd2l0aCgiaHR0cCIpOgogICAgICAgIHBhZ2VfdXJsPXBhZ2VfdmFsdWUKICAgICAgICBwYWdlX3ZhbHVlPSBnZXRVcmwocGFnZV92YWx1ZSxoZWFkZXJzPXJlZmVyZXIpCgogICAgc3RyX3BhdHRlcm49IihldmFsXChmdW5jdGlvblwocCxhLGMsayxlLCg/OnJ8ZCkuKikiCgogICAgcmVnX3Jlcz1yZS5jb21waWxlKHN0cl9wYXR0ZXJuKS5maW5kYWxsKHBhZ2VfdmFsdWUpCiAgICByPSIiCiAgICBpZiByZWdfcmVzIGFuZCBsZW4ocmVnX3Jlcyk+MDoKICAgICAgICBmb3IgdiBpbiByZWdfcmVzOgogICAgICAgICAgICByMT1nZXRfdW5wYWNrZWQodikKICAgICAgICAgICAgcjI9cmVfbWUocjEsJ1wnKC4qPylcJycpCiAgICAgICAgICAgIGlmICd1bmVzY2FwZScgaW4gcjE6CiAgICAgICAgICAgICAgICByMT11cmxsaWIudW5xdW90ZShyMikKICAgICAgICAgICAgcis9cjErJ1xuJwogICAgICAgIHByaW50ICdmaW5hbCB2YWx1ZSBpcyAnLHIKICAgICAgICAKICAgICAgICBwYWdlX3VybD1yZV9tZShyLCdzcmM9IiguKj8pIicpCiAgICAgICAgCiAgICAgICAgcGFnZV92YWx1ZT0gZ2V0VXJsKHBhZ2VfdXJsLGhlYWRlcnM9cmVmZXJlcikKCiAgICAjcHJpbnQgcGFnZV92YWx1ZQoKICAgIHJ0bXA9cmVfbWUocGFnZV92YWx1ZSwnc3RyZWFtZXJcJy4qP1wnKC4qPylcJ1wpJykKICAgIHBsYXlwYXRoPXJlX21lKHBhZ2VfdmFsdWUsJ2ZpbGVcJyxcc1wnKC4qPylcJycpCgogICAgCiAgICByZXR1cm4gcnRtcCsnIHBsYXlwYXRoPScrcGxheXBhdGggKycgcGFnZVVybD0nK3BhZ2VfdXJsCiAgICAKZGVmIGdldF9sZXRvbl9ydG1wKHBhZ2VfdmFsdWUsIHJlZmVyZXI9Tm9uZSk6CiAgICBpZiByZWZlcmVyOgogICAgICAgIHJlZmVyZXI9WygnUmVmZXJlcicscmVmZXJlcildCiAgICBpZiBwYWdlX3ZhbHVlLnN0YXJ0c3dpdGgoImh0dHAiKToKICAgICAgICBwYWdlX3ZhbHVlPSBnZXRVcmwocGFnZV92YWx1ZSxoZWFkZXJzPXJlZmVyZXIpCiAgICBzdHJfcGF0dGVybj0idmFyIGEgPSAoLio/KTtccyp2YXIgYiA9ICguKj8pO1xzKnZhciBjID0gKC4qPyk7XHMqdmFyIGQgPSAoLio/KTtccyp2YXIgZiA9ICguKj8pO1xzKnZhciB2X3BhcnQgPSAnKC4qPyknOyIKICAgIHJlZ19yZXM9cmUuY29tcGlsZShzdHJfcGF0dGVybikuZmluZGFsbChwYWdlX3ZhbHVlKVswXSAKCiAgICBhLGIsYyxkLGYsdj0ocmVnX3JlcykKICAgIGY9aW50KGYpCiAgICBhPWludChhKS9mCiAgICBiPWludChiKS9mCiAgICBjPWludChjKS9mCiAgICBkPWludChkKS9mCgogICAgcmV0PSAncnRtcDovLycgKyBzdHIoYSkgKyAnLicgKyBzdHIoYikgKyAnLicgKyBzdHIoYykgKyAnLicgKyBzdHIoZCkgKyB2OwogICAgcmV0dXJuIHJldAoKZGVmIGNyZWF0ZU0zdUZvckRhc2godXJsLHVzZXJhZ2VudD1Ob25lKToKICAgIHN0cj0nI0VYVE0zVScKICAgIHN0cis9J1xuI0VYVC1YLVNUUkVBTS1JTkY6UFJPR1JBTS1JRD0xLEJBTkRXSURUSD0zNjE4MTYnCiAgICBzdHIrPSdcbicrdXJsKycmYnl0ZXM9MC0yMDAwMDAnIysnfFVzZXItQWdlbnQ9Jyt1c2VyYWdlbnQKICAgIHNvdXJjZV9maWxlID0gb3MucGF0aC5qb2luKHByb2ZpbGUsICd0ZXN0ZmlsZS5tM3UnKQogICAgc3RyKz0nXG4nCiAgICBTYXZlVG9GaWxlKHNvdXJjZV9maWxlLHN0cikKICAgICNyZXR1cm4gJ0M6L1VzZXJzL3NoYW5pL0Rvd25sb2Fkcy90ZXN0Lm0zdTgnCiAgICByZXR1cm4gc291cmNlX2ZpbGUKCmRlZiBTYXZlVG9GaWxlKGZpbGVfbmFtZSxwYWdlX2RhdGEsYXBwZW5kPUZhbHNlKToKICAgIGlmIGFwcGVuZDoKICAgICAgICBmID0gb3BlbihmaWxlX25hbWUsICdhJykKICAgICAgICBmLndyaXRlKHBhZ2VfZGF0YSkKICAgICAgICBmLmNsb3NlKCkgICAgICAgIAogICAgZWxzZToKICAgICAgICBmPW9wZW4oZmlsZV9uYW1lLCd3YicpCiAgICAgICAgZi53cml0ZShwYWdlX2RhdGEpCiAgICAgICAgZi5jbG9zZSgpCiAgICAgICAgcmV0dXJuICcnCiAgICAKZGVmIExvYWRGaWxlKGZpbGVfbmFtZSk6CglmPW9wZW4oZmlsZV9uYW1lLCdyYicpCglkPWYucmVhZCgpCglmLmNsb3NlKCkKCXJldHVybiBkCiAgICAKZGVmIGdldF9wYWNrZWRfaXBob25ldHZfdXJsKHBhZ2VfZGF0YSk6CglpbXBvcnQgcmUsYmFzZTY0LHVybGxpYjsgCglzPXBhZ2VfZGF0YQoJd2hpbGUgJ2dlaCgnIGluIHM6CgkJaWYgcy5zdGFydHN3aXRoKCdsb2woJyk6IHM9c1s1Oi0xXSAgICAKIwkJcHJpbnQgJ3MgaXMgJyxzCgkJcz1yZS5jb21waWxlKCciKC4qPykiJykuZmluZGFsbChzKVswXTsgCgkJcz0gIGJhc2U2NC5iNjRkZWNvZGUocyk7IAoJCXM9dXJsbGliLnVucXVvdGUocyk7IAoJcHJpbnQgcwoJcmV0dXJuIHMKCmRlZiBnZXRfZmVycmFyaV91cmwocGFnZV9kYXRhKToKICAgIHByaW50ICdnZXRfZGFnX3VybDInLHBhZ2VfZGF0YQogICAgcGFnZV9kYXRhMj1nZXRVcmwocGFnZV9kYXRhKTsKICAgIHBhdHQ9JyhodHRwLiopJwogICAgaW1wb3J0IHV1aWQKICAgIHBsYXliYWNrPXN0cih1dWlkLnV1aWQxKCkpLnVwcGVyKCkKICAgIGxpbmtzPXJlLmNvbXBpbGUocGF0dCkuZmluZGFsbChwYWdlX2RhdGEyKQogICAgaGVhZGVycz1bKCdYLVBsYXliYWNrLVNlc3Npb24tSWQnLHBsYXliYWNrKV0KICAgIGZvciBsIGluIGxpbmtzOgogICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHBhZ2VfZGF0YXRlbXA9Z2V0VXJsKGwsaGVhZGVycz1oZWFkZXJzKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQ6IHBhc3MKICAgIAogICAgcmV0dXJuIHBhZ2VfZGF0YSsnfCZYLVBsYXliYWNrLVNlc3Npb24tSWQ9JytwbGF5YmFjawoKICAgIApkZWYgZ2V0X2RhZ191cmwocGFnZV9kYXRhKToKICAgIHByaW50ICdnZXRfZGFnX3VybCcscGFnZV9kYXRhCiAgICBpZiBwYWdlX2RhdGEuc3RhcnRzd2l0aCgnaHR0cDovL2RhZy50b3RhbC1zdHJlYW0ubmV0Jyk6CiAgICAgICAgaGVhZGVycz1bKCdVc2VyLUFnZW50JywnVmVyaXNtby1CbGFja1VJXygyLjQuNy41LjguMC4zNCknKV0KICAgICAgICBwYWdlX2RhdGE9Z2V0VXJsKHBhZ2VfZGF0YSxoZWFkZXJzPWhlYWRlcnMpOwoKICAgIGlmICcxMjcuMC4wLjEnIGluIHBhZ2VfZGF0YToKICAgICAgICByZXR1cm4gcmV2aXN0X2RhZyhwYWdlX2RhdGEpCiAgICBlbGlmIHJlX21lKHBhZ2VfZGF0YSwgJ3dtc0F1dGhTaWduJTNEKFteJSZdKyknKSAhPSAnJzoKICAgICAgICBmaW5hbF91cmwgPSByZV9tZShwYWdlX2RhdGEsICcmdmVyX3Q9KFteJl0rKSYnKSArICc/d21zQXV0aFNpZ249JyArIHJlX21lKHBhZ2VfZGF0YSwgJ3dtc0F1dGhTaWduJTNEKFteJSZdKyknKSArICc9PS9tcDQ6JyArIHJlX21lKHBhZ2VfZGF0YSwgJ1xcP3k9KFteJl0rKSYnKQogICAgZWxzZToKICAgICAgICBmaW5hbF91cmwgPSByZV9tZShwYWdlX2RhdGEsICdocmVmPSIoW14iXSspIlteIl0rJCcpCiAgICAgICAgaWYgbGVuKGZpbmFsX3VybCk9PTA6CiAgICAgICAgICAgIGZpbmFsX3VybD1wYWdlX2RhdGEKICAgIGZpbmFsX3VybCA9IGZpbmFsX3VybC5yZXBsYWNlKCcgJywgJyUyMCcpCiAgICByZXR1cm4gZmluYWxfdXJsCgpkZWYgcmVfbWUoZGF0YSwgcmVfcGF0dGVuKToKICAgIG1hdGNoID0gJycKICAgIG0gPSByZS5zZWFyY2gocmVfcGF0dGVuLCBkYXRhKQogICAgaWYgbSAhPSBOb25lOgogICAgICAgIG1hdGNoID0gbS5ncm91cCgxKQogICAgZWxzZToKICAgICAgICBtYXRjaCA9ICcnCiAgICByZXR1cm4gbWF0Y2gKCmRlZiByZXZpc3RfZGFnKHBhZ2VfZGF0YSk6CiAgICBmaW5hbF91cmwgPSAnJwogICAgaWYgJzEyNy4wLjAuMScgaW4gcGFnZV9kYXRhOgogICAgICAgIGZpbmFsX3VybCA9IHJlX21lKHBhZ2VfZGF0YSwgJyZ2ZXJfdD0oW14mXSspJicpICsgJyBsaXZlPXRydWUgdGltZW91dD0xNSBwbGF5cGF0aD0nICsgcmVfbWUocGFnZV9kYXRhLCAnXFw/eT0oW2EtekEtWjAtOS1fXFwuQF0rKScpCiAgICAgICAgCiAgICBpZiByZV9tZShwYWdlX2RhdGEsICd0b2tlbj0oW14mXSspJicpICE9ICcnOgogICAgICAgIGZpbmFsX3VybCA9IGZpbmFsX3VybCArICc/dG9rZW49JyArIHJlX21lKHBhZ2VfZGF0YSwgJ3Rva2VuPShbXiZdKykmJykKICAgIGVsaWYgcmVfbWUocGFnZV9kYXRhLCAnd21zQXV0aFNpZ24lM0QoW14lJl0rKScpICE9ICcnOgogICAgICAgIGZpbmFsX3VybCA9IHJlX21lKHBhZ2VfZGF0YSwgJyZ2ZXJfdD0oW14mXSspJicpICsgJz93bXNBdXRoU2lnbj0nICsgcmVfbWUocGFnZV9kYXRhLCAnd21zQXV0aFNpZ24lM0QoW14lJl0rKScpICsgJz09L21wNDonICsgcmVfbWUocGFnZV9kYXRhLCAnXFw/eT0oW14mXSspJicpCiAgICBlbHNlOgogICAgICAgIGZpbmFsX3VybCA9IHJlX21lKHBhZ2VfZGF0YSwgJ0hSRUY9IihbXiJdKykiJykKCiAgICBpZiAnZGFnMS5hc3gnIGluIGZpbmFsX3VybDoKICAgICAgICByZXR1cm4gZ2V0X2RhZ191cmwoZmluYWxfdXJsKQoKICAgIGlmICdkZXZpbmxpdmVmcy5mcGxpdmUubmV0JyBub3QgaW4gZmluYWxfdXJsOgogICAgICAgIGZpbmFsX3VybCA9IGZpbmFsX3VybC5yZXBsYWNlKCdkZXZpbmxpdmUnLCAnZmxpdmUnKQogICAgaWYgJ3Blcm1saXZlZnMuZnBsaXZlLm5ldCcgbm90IGluIGZpbmFsX3VybDoKICAgICAgICBmaW5hbF91cmwgPSBmaW5hbF91cmwucmVwbGFjZSgncGVybWxpdmUnLCAnZmxpdmUnKQogICAgcmV0dXJuIGZpbmFsX3VybAoKCmRlZiBnZXRfdW53aXNlKCBzdHJfZXZhbCk6CiAgICBwYWdlX3ZhbHVlPSIiCiAgICB0cnk6ICAgICAgICAKICAgICAgICBzcz0idyxpLHMsZT0oIitzdHJfZXZhbCsnKScgCiAgICAgICAgZXhlYyAoc3MpCiAgICAgICAgcGFnZV92YWx1ZT11bndpc2VfZnVuYyh3LGkscyxlKQogICAgZXhjZXB0OiB0cmFjZWJhY2sucHJpbnRfZXhjKGZpbGU9c3lzLnN0ZG91dCkKICAgICNwcmludCAndW5wYWNrZWQnLHBhZ2VfdmFsdWUKICAgIHJldHVybiBwYWdlX3ZhbHVlCiAgICAKZGVmIHVud2lzZV9mdW5jKCB3LCBpLCBzLCBlKToKICAgIGxJbGwgPSAwOwogICAgbGwxSSA9IDA7CiAgICBJbDFsID0gMDsKICAgIGxsMWwgPSBbXTsKICAgIGwxbEkgPSBbXTsKICAgIHdoaWxlIFRydWU6CiAgICAgICAgaWYgKGxJbGwgPCA1KToKICAgICAgICAgICAgbDFsSS5hcHBlbmQod1tsSWxsXSkKICAgICAgICBlbGlmIChsSWxsIDwgbGVuKHcpKToKICAgICAgICAgICAgbGwxbC5hcHBlbmQod1tsSWxsXSk7CiAgICAgICAgbElsbCs9MTsKICAgICAgICBpZiAobGwxSSA8IDUpOgogICAgICAgICAgICBsMWxJLmFwcGVuZChpW2xsMUldKQogICAgICAgIGVsaWYgKGxsMUkgPCBsZW4oaSkpOgogICAgICAgICAgICBsbDFsLmFwcGVuZChpW2xsMUldKQogICAgICAgIGxsMUkrPTE7CiAgICAgICAgaWYgKElsMWwgPCA1KToKICAgICAgICAgICAgbDFsSS5hcHBlbmQoc1tJbDFsXSkKICAgICAgICBlbGlmIChJbDFsIDwgbGVuKHMpKToKICAgICAgICAgICAgbGwxbC5hcHBlbmQoc1tJbDFsXSk7CiAgICAgICAgSWwxbCs9MTsKICAgICAgICBpZiAobGVuKHcpICsgbGVuKGkpICsgbGVuKHMpICsgbGVuKGUpID09IGxlbihsbDFsKSArIGxlbihsMWxJKSArIGxlbihlKSk6CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIAogICAgbEkxbCA9ICcnLmpvaW4obGwxbCkjLmpvaW4oJycpOwogICAgSTFsSSA9ICcnLmpvaW4obDFsSSkjLmpvaW4oJycpOwogICAgbGwxSSA9IDA7CiAgICBsMWxsID0gW107CiAgICBmb3IgbElsbCBpbiByYW5nZSgwLGxlbihsbDFsKSwyKToKICAgICAgICAjcHJpbnQgJ2FycmF5IGknLGxJbGwsbGVuKGxsMWwpCiAgICAgICAgbGwxMSA9IC0xOwogICAgICAgIGlmICggb3JkKEkxbElbbGwxSV0pICUgMik6CiAgICAgICAgICAgIGxsMTEgPSAxOwogICAgICAgICNwcmludCAndmFsIGlzICcsIGxJMWxbbElsbDogbElsbCsyXQogICAgICAgIGwxbGwuYXBwZW5kKGNociggICAgaW50KGxJMWxbbElsbDogbElsbCsyXSwgMzYpIC0gbGwxMSkpOwogICAgICAgIGxsMUkrPTE7CiAgICAgICAgaWYgKGxsMUkgPj0gbGVuKGwxbEkpKToKICAgICAgICAgICAgbGwxSSA9IDA7CiAgICByZXQ9Jycuam9pbihsMWxsKQogICAgaWYgJ2V2YWwoZnVuY3Rpb24odyxpLHMsZSknIGluIHJldDoKICAgICAgICBwcmludCAnU1RJTEwgR09pbmcnCiAgICAgICAgcmV0PXJlLmNvbXBpbGUoJ2V2YWxcKGZ1bmN0aW9uXCh3LGkscyxlXCkuKn1cKCguKj8pXCknKS5maW5kYWxsKHJldClbMF0gCiAgICAgICAgcmV0dXJuIGdldF91bndpc2UocmV0KQogICAgZWxzZToKICAgICAgICBwcmludCAnRklOSVNIRUQnCiAgICAgICAgcmV0dXJuIHJldAogICAgCmRlZiBnZXRfdW5wYWNrZWQoIHBhZ2VfdmFsdWUsIHJlZ2V4X2Zvcl90ZXh0PScnLCBpdGVyYXRpb25zPTEsIHRvdGFsX2l0ZXJhdGlvbj0xKToKICAgIHRyeTogICAgICAgIAogICAgICAgIHJlZ19kYXRhPU5vbmUKICAgICAgICBpZiBwYWdlX3ZhbHVlLnN0YXJ0c3dpdGgoImh0dHAiKToKICAgICAgICAgICAgcGFnZV92YWx1ZT0gZ2V0VXJsKHBhZ2VfdmFsdWUpCiAgICAgICAgcHJpbnQgJ3BhZ2VfdmFsdWUnLHBhZ2VfdmFsdWUKICAgICAgICBpZiByZWdleF9mb3JfdGV4dCBhbmQgbGVuKHJlZ2V4X2Zvcl90ZXh0KT4wOgogICAgICAgICAgICBwYWdlX3ZhbHVlPXJlLmNvbXBpbGUocmVnZXhfZm9yX3RleHQpLmZpbmRhbGwocGFnZV92YWx1ZSlbMF0gI2dldCB0aGUganMgdmFyaWFibGUKICAgICAgICAKICAgICAgICBwYWdlX3ZhbHVlPXVucGFjayhwYWdlX3ZhbHVlLGl0ZXJhdGlvbnMsdG90YWxfaXRlcmF0aW9uKQogICAgZXhjZXB0OiB0cmFjZWJhY2sucHJpbnRfZXhjKGZpbGU9c3lzLnN0ZG91dCkKICAgIHByaW50ICd1bnBhY2tlZCcscGFnZV92YWx1ZQogICAgaWYgJ3NhdjFsaXZlLnR2JyBpbiBwYWdlX3ZhbHVlOgogICAgICAgIHBhZ2VfdmFsdWU9cGFnZV92YWx1ZS5yZXBsYWNlKCdzYXYxbGl2ZS50dicsJ3Nhd2xpdmUudHYnKSAjcXVpY2sgZml4IHNvbWUgYnVnIHNvbWV3aGVyZQogICAgICAgIHByaW50ICdzYXYxIHVucGFja2VkJyxwYWdlX3ZhbHVlCiAgICByZXR1cm4gcGFnZV92YWx1ZQoKZGVmIHVucGFjayhzSmF2YXNjcmlwdCxpdGVyYXRpb249MSwgdG90YWxpdGVyYXRpb25zPTIgICk6CiAgICBwcmludCAnaXRlcmF0aW9uJyxpdGVyYXRpb24KICAgIGlmIHNKYXZhc2NyaXB0LnN0YXJ0c3dpdGgoJ3ZhciBfMHhjYjhhPScpOgogICAgICAgIGFTcGxpdD1zSmF2YXNjcmlwdC5zcGxpdCgndmFyIF8weGNiOGE9JykKICAgICAgICBzcz0ibXlhcnJheT0iK2FTcGxpdFsxXS5zcGxpdCgiZXZhbCgiKVswXQogICAgICAgIGV4ZWMoc3MpCiAgICAgICAgYTE9NjIKICAgICAgICBjMT1pbnQoYVNwbGl0WzFdLnNwbGl0KCIsNjIsIilbMV0uc3BsaXQoJywnKVswXSkKICAgICAgICBwMT1teWFycmF5WzBdCiAgICAgICAgazE9bXlhcnJheVszXQogICAgICAgIHdpdGggb3BlbigndGVtcCBmaWxlJytzdHIoaXRlcmF0aW9uKSsnLmpzJywgIndiIikgYXMgZmlsZXdyaXRlcjoKICAgICAgICAgICAgZmlsZXdyaXRlci53cml0ZShzdHIoazEpKQogICAgICAgICNhYT0xLzAKICAgIGVsc2U6CgogICAgICAgIGFTcGxpdCA9IHNKYXZhc2NyaXB0LnNwbGl0KCJybiBwfSgnIikKICAgICAgICBwcmludCBhU3BsaXQKICAgICAgICAKICAgICAgICBwMSxhMSxjMSxrMT0oJycsJzAnLCcwJywnJykKICAgICAKICAgICAgICBzcz0icDEsYTEsYzEsazE9KCciK2FTcGxpdFsxXS5zcGxpdCgiLnNwbGkiKVswXSsnKScgCiAgICAgICAgZXhlYyhzcykKICAgIGsxPWsxLnNwbGl0KCd8JykKICAgIGFTcGxpdCA9IGFTcGxpdFsxXS5zcGxpdCgiKSknIikKIyAgICBwcmludCAnIHAgYXJyYXkgaXMgJyxsZW4oYVNwbGl0KQojICAgcHJpbnQgbGVuKGFTcGxpdCApCgogICAgI3A9c3RyKGFTcGxpdFswXSsnKSknKSMucmVwbGFjZSgiXFwiLCIiKSMucmVwbGFjZSgnXFxcXCcsJ1xcJykKCiAgICAjcHJpbnQgYVNwbGl0WzFdCiAgICAjYVNwbGl0ID0gYVNwbGl0WzFdLnNwbGl0KCIsIikKICAgICNwcmludCBhU3BsaXRbMF0gCiAgICAjYSA9IGludChhU3BsaXRbMV0pCiAgICAjYyA9IGludChhU3BsaXRbMl0pCiAgICAjayA9IGFTcGxpdFszXS5zcGxpdCgiLiIpWzBdLnJlcGxhY2UoIiciLCAnJykuc3BsaXQoJ3wnKQogICAgI2E9aW50KGEpCiAgICAjYz1pbnQoYykKICAgIAogICAgI3A9cC5yZXBsYWNlKCdcXCcsICcnKQojICAgIHByaW50ICdwIHZhbCBpcyAnLHBbMDoxMDBdLCcuLi4uLi4uLi4uLi4nLHBbLTEwMDpdLGxlbihwKQojICAgIHByaW50ICdwMSB2YWwgaXMgJyxwMVswOjEwMF0sJy4uLi4uLi4uLi4uLicscDFbLTEwMDpdLGxlbihwMSkKICAgIAogICAgI3ByaW50IGEsYTEKICAgICNwcmludCBjLGExCiAgICAjcHJpbnQgJ2sgdmFsIGlzICcsa1stMTA6XSxsZW4oaykKIyAgICBwcmludCAnazEgdmFsIGlzICcsazFbLTEwOl0sbGVuKGsxKQogICAgZSA9ICcnCiAgICBkID0gJycjMzI4MjMKCiAgICAjc1VucGFja2VkID0gc3RyKF9fdW5wYWNrKHAsIGEsIGMsIGssIGUsIGQpKQogICAgc1VucGFja2VkMSA9IHN0cihfX3VucGFjayhwMSwgYTEsIGMxLCBrMSwgZSwgZCxpdGVyYXRpb24pKQogICAgCiAgICAjcHJpbnQgc1VucGFja2VkWzoyMDBdKycuLi4uJytzVW5wYWNrZWRbLTEwMDpdLCBsZW4oc1VucGFja2VkKQojICAgIHByaW50IHNVbnBhY2tlZDFbOjIwMF0rJy4uLi4nK3NVbnBhY2tlZDFbLTEwMDpdLCBsZW4oc1VucGFja2VkMSkKICAgIAogICAgI2V4ZWMoJ3NVbnBhY2tlZDE9Iicrc1VucGFja2VkMSsnIicpCiAgICBpZiBpdGVyYXRpb24+PXRvdGFsaXRlcmF0aW9uczoKIyAgICAgICAgcHJpbnQgJ2ZpbmFsIHJlcycsc1VucGFja2VkMVs6MjAwXSsnLi4uLicrc1VucGFja2VkMVstMTAwOl0sIGxlbihzVW5wYWNrZWQxKQogICAgICAgIHJldHVybiBzVW5wYWNrZWQxIy5yZXBsYWNlKCdcXFxcJywgJ1xcJykKICAgIGVsc2U6CiMgICAgICAgIHByaW50ICdmaW5hbCByZXMgZm9yIHRoaXMgaXRlcmF0aW9uIGlzJyxpdGVyYXRpb24KICAgICAgICByZXR1cm4gdW5wYWNrKHNVbnBhY2tlZDEsaXRlcmF0aW9uKzEpIy5yZXBsYWNlKCdcXCcsICcnKSxpdGVyYXRpb24pIy5yZXBsYWNlKCdcXCcsICcnKTsjdW5wYWNrKHNVbnBhY2tlZC5yZXBsYWNlKCdcXCcsICcnKSkKCmRlZiBfX3VucGFjayhwLCBhLCBjLCBrLCBlLCBkLCBpdGVyYXRpb24sdj0xKToKCiAgICAjd2l0aCBvcGVuKCdiZWZvcmUgZmlsZScrc3RyKGl0ZXJhdGlvbikrJy5qcycsICJ3YiIpIGFzIGZpbGV3cml0ZXI6CiAgICAjICAgIGZpbGV3cml0ZXIud3JpdGUoc3RyKHApKQogICAgd2hpbGUgKGMgPj0gMSk6CiAgICAgICAgYyA9IGMgLTEKICAgICAgICBpZiAoa1tjXSk6CiAgICAgICAgICAgIGFhPXN0cihfX2l0b2FOZXcoYywgYSkpCiAgICAgICAgICAgIGlmIHY9PTE6CiAgICAgICAgICAgICAgICBwPXJlLnN1YignXFxiJyArIGFhICsnXFxiJywga1tjXSwgcCkjIFRISVMgSVMgQmxvb2R5IHNsb3chCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwPWZpbmRBbmRSZXBsYWNlV29yZChwLGFhLGtbY10pCgogICAgICAgICAgICAjcD1maW5kQW5kUmVwbGFjZVdvcmQocCxhYSxrW2NdKQoKICAgICAgICAgICAgCiAgICAjd2l0aCBvcGVuKCdhZnRlciBmaWxlJytzdHIoaXRlcmF0aW9uKSsnLmpzJywgIndiIikgYXMgZmlsZXdyaXRlcjoKICAgICMgICAgZmlsZXdyaXRlci53cml0ZShzdHIocCkpCiAgICByZXR1cm4gcAoKIwojZnVuY3Rpb24gZXF1YWxhdmVudCB0byByZS5zdWIoJ1xcYicgKyBhYSArJ1xcYicsIGtbY10sIHApCmRlZiBmaW5kQW5kUmVwbGFjZVdvcmQoc291cmNlX3N0ciwgd29yZF90b19maW5kLHJlcGxhY2Vfd2l0aCk6CiAgICBzcGxpdHM9Tm9uZQogICAgc3BsaXRzPXNvdXJjZV9zdHIuc3BsaXQod29yZF90b19maW5kKQogICAgaWYgbGVuKHNwbGl0cyk+MToKICAgICAgICBuZXdfc3RyaW5nPVtdCiAgICAgICAgY3VycmVudF9pbmRleD0wCiAgICAgICAgZm9yIGN1cnJlbnRfc3BsaXQgaW4gc3BsaXRzOgogICAgICAgICAgICAjcHJpbnQgJ2hlcmUnLGkKICAgICAgICAgICAgbmV3X3N0cmluZy5hcHBlbmQoY3VycmVudF9zcGxpdCkKICAgICAgICAgICAgdmFsPXdvcmRfdG9fZmluZCNieSBkZWZhdWx0IGFzc3VtZSBpdCB3YXMgd3JvbmcgdG8gc3BsaXQKCiAgICAgICAgICAgICNpZiBpdHMgZmlyc3Qgb25lIGFuZCBpdGVtIGlzIGJsYW5rIHRoZW4gY2hlY2sgbmV4dCBpdGVtIGlzIHZhbGlkIG9yIG5vdAogICAgICAgICAgICBpZiBjdXJyZW50X2luZGV4PT1sZW4oc3BsaXRzKS0xOgogICAgICAgICAgICAgICAgdmFsPScnICMgbGFzdCBvbmUgbm90aGluZyB0byBhcHBlbmQgbm9ybWFsbHkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGlmIGxlbihjdXJyZW50X3NwbGl0KT09MDogI2lmIGJsYW5rIGNoZWNrIG5leHQgb25lIHdpdGggY3VycmVudCBzcGxpdCB2YWx1ZQogICAgICAgICAgICAgICAgICAgIGlmICggbGVuKHNwbGl0c1tjdXJyZW50X2luZGV4KzFdKT09MCBhbmQgd29yZF90b19maW5kWzBdLmxvd2VyKCkgbm90IGluICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejEyMzQ1Njc4OTBfJykgb3IgKGxlbihzcGxpdHNbY3VycmVudF9pbmRleCsxXSk+MCAgYW5kIHNwbGl0c1tjdXJyZW50X2luZGV4KzFdWzBdLmxvd2VyKCkgbm90IGluICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejEyMzQ1Njc4OTBfJyk6IyBmaXJzdCBqdXN0IGp1c3QgY2hlY2sgbmV4dAogICAgICAgICAgICAgICAgICAgICAgICB2YWw9cmVwbGFjZV93aXRoCiAgICAgICAgICAgICAgICAjbm90IGJsYW5rLCB0aGVuIGNoZWNrIGN1cnJlbnQgZW5kdmFsdWUgYW5kIG5leHQgZmlyc3QgdmFsdWUKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgaWYgKHNwbGl0c1tjdXJyZW50X2luZGV4XVstMV0ubG93ZXIoKSBub3QgaW4gJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MTIzNDU2Nzg5MF8nKSBhbmQgKCggbGVuKHNwbGl0c1tjdXJyZW50X2luZGV4KzFdKT09MCBhbmQgd29yZF90b19maW5kWzBdLmxvd2VyKCkgbm90IGluICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejEyMzQ1Njc4OTBfJykgb3IgKGxlbihzcGxpdHNbY3VycmVudF9pbmRleCsxXSk+MCAgYW5kIHNwbGl0c1tjdXJyZW50X2luZGV4KzFdWzBdLmxvd2VyKCkgbm90IGluICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejEyMzQ1Njc4OTBfJykpOiMgZmlyc3QganVzdCBqdXN0IGNoZWNrIG5leHQKICAgICAgICAgICAgICAgICAgICAgICAgdmFsPXJlcGxhY2Vfd2l0aAogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgbmV3X3N0cmluZy5hcHBlbmQodmFsKQogICAgICAgICAgICBjdXJyZW50X2luZGV4Kz0xCiAgICAgICAgI2FhYWE9MS8wCiAgICAgICAgc291cmNlX3N0cj0nJy5qb2luKG5ld19zdHJpbmcpCiAgICByZXR1cm4gc291cmNlX3N0ciAgICAgICAgCgpkZWYgX19pdG9hKG51bSwgcmFkaXgpOgojICAgIHByaW50ICdudW0gcmVkJyxudW0sIHJhZGl4CiAgICByZXN1bHQgPSAiIgogICAgaWYgbnVtPT0wOiByZXR1cm4gJzAnCiAgICB3aGlsZSBudW0gPiAwOgogICAgICAgIHJlc3VsdCA9ICIwMTIzNDU2Nzg5YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoiW251bSAlIHJhZGl4XSArIHJlc3VsdAogICAgICAgIG51bSAvPSByYWRpeAogICAgcmV0dXJuIHJlc3VsdAoJCmRlZiBfX2l0b2FOZXcoY2MsIGEpOgogICAgYWE9IiIgaWYgY2MgPCBhIGVsc2UgX19pdG9hTmV3KGludChjYyAvIGEpLGEpIAogICAgY2MgPSAoY2MgJSBhKQogICAgYmI9Y2hyKGNjICsgMjkpIGlmIGNjPiAzNSBlbHNlIHN0cihfX2l0b2EoY2MsMzYpKQogICAgcmV0dXJuIGFhK2JiCgoKZGVmIGdldENvb2tpZXNTdHJpbmcoY29va2llSmFyKToKICAgIHRyeToKICAgICAgICBjb29raWVTdHJpbmc9IiIKICAgICAgICBmb3IgaW5kZXgsIGNvb2tpZSBpbiBlbnVtZXJhdGUoY29va2llSmFyKToKICAgICAgICAgICAgY29va2llU3RyaW5nKz1jb29raWUubmFtZSArICI9IiArIGNvb2tpZS52YWx1ZSArIjsiCiAgICBleGNlcHQ6IHBhc3MKICAgICNwcmludCAnY29va2llU3RyaW5nJyxjb29raWVTdHJpbmcKICAgIHJldHVybiBjb29raWVTdHJpbmcKCgpkZWYgc2F2ZUNvb2tpZUphcihjb29raWVKYXIsQ09PS0lFRklMRSk6Cgl0cnk6CgkJY29tcGxldGVfcGF0aD1vcy5wYXRoLmpvaW4ocHJvZmlsZSxDT09LSUVGSUxFKQoJCWNvb2tpZUphci5zYXZlKGNvbXBsZXRlX3BhdGgsaWdub3JlX2Rpc2NhcmQ9VHJ1ZSkKCWV4Y2VwdDogcGFzcwoKZGVmIGdldENvb2tpZUphcihDT09LSUVGSUxFKToKCgljb29raWVKYXI9Tm9uZQoJaWYgQ09PS0lFRklMRToKCQl0cnk6CgkJCWNvbXBsZXRlX3BhdGg9b3MucGF0aC5qb2luKHByb2ZpbGUsQ09PS0lFRklMRSkKCQkJY29va2llSmFyID0gY29va2llbGliLkxXUENvb2tpZUphcigpCgkJCWNvb2tpZUphci5sb2FkKGNvbXBsZXRlX3BhdGgsaWdub3JlX2Rpc2NhcmQ9VHJ1ZSkKCQlleGNlcHQ6IAoJCQljb29raWVKYXI9Tm9uZQoJCglpZiBub3QgY29va2llSmFyOgoJCWNvb2tpZUphciA9IGNvb2tpZWxpYi5MV1BDb29raWVKYXIoKQoJCglyZXR1cm4gY29va2llSmFyCiAgICAKZGVmIGRvRXZhbChmdW5fY2FsbCxwYWdlX2RhdGEsQ29va2llX0phcik6CiAgICByZXRfdmFsPScnCiAgICBpZiBmdW5jdGlvbnNfZGlyIG5vdCBpbiBzeXMucGF0aDoKICAgICAgICBzeXMucGF0aC5hcHBlbmQoZnVuY3Rpb25zX2RpcikKICAgIAogICAgcHJpbnQgZnVuX2NhbGwKICAgIHRyeToKICAgICAgICBweV9maWxlPSdpbXBvcnQgJytmdW5fY2FsbC5zcGxpdCgnLicpWzBdCiAgICAgICAgcHJpbnQgcHlfZmlsZSxzeXMucGF0aAogICAgICAgIGV4ZWMoIHB5X2ZpbGUpCiAgICAgICAgcHJpbnQgJ2RvbmUnCiAgICBleGNlcHQ6CiAgICAgICAgcHJpbnQgJ2Vycm9yIGluIGltcG9ydCcKICAgICAgICB0cmFjZWJhY2sucHJpbnRfZXhjKGZpbGU9c3lzLnN0ZG91dCkKICAgIHByaW50ICdyZXRfdmFsPScrZnVuX2NhbGwKICAgIGV4ZWMgKCdyZXRfdmFsPScrZnVuX2NhbGwpCiAgICBwcmludCByZXRfdmFsCiAgICAjZXhlYygncmV0X3ZhbD0xKzEnKQogICAgcmV0dXJuIHN0cihyZXRfdmFsKQogICAgCmRlZiBwcm9jZXNzUmVjYXB0Y2hhKHVybCk6CglodG1sX3RleHQ9Z2V0VXJsKHVybCkKCXJlY2FwQ2hhbGxlbmdlPSIiCglzb2x1dGlvbj0iIgoJY2FwX3JlZz0iPHNjcmlwdC4qP3NyYz1cIiguKj9yZWNhcC4qPylcIiIKCW1hdGNoID1yZS5maW5kYWxsKGNhcF9yZWcsIGh0bWxfdGV4dCkKCWNhcHRjaGE9RmFsc2UKCWNhcHRjaGFfcmVsb2FkX3Jlc3BvbnNlX2NoYWxsPU5vbmUKCXNvbHV0aW9uPU5vbmUKCQoJaWYgbWF0Y2ggYW5kIGxlbihtYXRjaCk+MDogI25ldyBzaGlueSBjYXB0Y2hhIQoJCWNhcHRjaGFfdXJsPW1hdGNoWzBdCgkJY2FwdGNoYT1UcnVlCgkJCgkJY2FwX2NoYWxsX3JlZz0nY2hhbGxlbmdlLio/XCcoLio/KVwnJwoJCWNhcF9pbWFnZV9yZWc9J1wnKC4qPylcJycKCQljYXB0Y2hhX3NjcmlwdD1nZXRVcmwoY2FwdGNoYV91cmwpCgkJcmVjYXBDaGFsbGVuZ2U9cmUuZmluZGFsbChjYXBfY2hhbGxfcmVnLCBjYXB0Y2hhX3NjcmlwdClbMF0KCQljYXB0Y2hhX3JlbG9hZD0naHR0cDovL3d3dy5nb29nbGUuY29tL3JlY2FwdGNoYS9hcGkvcmVsb2FkP2M9JzsKCQljYXB0Y2hhX2s9Y2FwdGNoYV91cmwuc3BsaXQoJ2s9JylbMV0KCQljYXB0Y2hhX3JlbG9hZCs9cmVjYXBDaGFsbGVuZ2UrJyZrPScrY2FwdGNoYV9rKycmY2FwdGNoYV9rPTEmdHlwZT1pbWFnZSZsYW5nPWVuLUdCJwoJCWNhcHRjaGFfcmVsb2FkX2pzPWdldFVybChjYXB0Y2hhX3JlbG9hZCkKCQljYXB0Y2hhX3JlbG9hZF9yZXNwb25zZV9jaGFsbD1yZS5maW5kYWxsKGNhcF9pbWFnZV9yZWcsIGNhcHRjaGFfcmVsb2FkX2pzKVswXQoJCWNhcHRjaGFfaW1hZ2VfdXJsPSdodHRwOi8vd3d3Lmdvb2dsZS5jb20vcmVjYXB0Y2hhL2FwaS9pbWFnZT9jPScrY2FwdGNoYV9yZWxvYWRfcmVzcG9uc2VfY2hhbGwKCQlpZiBub3QgY2FwdGNoYV9pbWFnZV91cmwuc3RhcnRzd2l0aCgiaHR0cCIpOgoJCQljYXB0Y2hhX2ltYWdlX3VybD0naHR0cDovL3d3dy5nb29nbGUuY29tL3JlY2FwdGNoYS9hcGkvJytjYXB0Y2hhX2ltYWdlX3VybAoJCWltcG9ydCByYW5kb20KCQluPXJhbmRvbS5yYW5kcmFuZ2UoMTAwLDEwMDAsNSkKCQlsb2NhbF9jYXB0Y2hhID0gb3MucGF0aC5qb2luKHByb2ZpbGUsc3RyKG4pICsiY2FwdGNoYS5pbWciICkKCQlsb2NhbEZpbGUgPSBvcGVuKGxvY2FsX2NhcHRjaGEsICJ3YiIpCgkJbG9jYWxGaWxlLndyaXRlKGdldFVybChjYXB0Y2hhX2ltYWdlX3VybCkpCgkJbG9jYWxGaWxlLmNsb3NlKCkKCQlzb2x2ZXIgPSBJbnB1dFdpbmRvdyhjYXB0Y2hhPWxvY2FsX2NhcHRjaGEpCgkJc29sdXRpb24gPSBzb2x2ZXIuZ2V0KCkKCQlvcy5yZW1vdmUobG9jYWxfY2FwdGNoYSkKCXJldHVybiBjYXB0Y2hhX3JlbG9hZF9yZXNwb25zZV9jaGFsbCAsc29sdXRpb24KCmRlZiBnZXRVcmwodXJsLCBjb29raWVKYXI9Tm9uZSxwb3N0PU5vbmUsIHRpbWVvdXQ9MjAsIGhlYWRlcnM9Tm9uZSk6CgoKCWNvb2tpZV9oYW5kbGVyID0gdXJsbGliMi5IVFRQQ29va2llUHJvY2Vzc29yKGNvb2tpZUphcikKCW9wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKGNvb2tpZV9oYW5kbGVyLCB1cmxsaWIyLkhUVFBCYXNpY0F1dGhIYW5kbGVyKCksIHVybGxpYjIuSFRUUEhhbmRsZXIoKSkKCSNvcGVuZXIgPSB1cmxsaWIyLmluc3RhbGxfb3BlbmVyKG9wZW5lcikKCXJlcSA9IHVybGxpYjIuUmVxdWVzdCh1cmwpCglyZXEuYWRkX2hlYWRlcignVXNlci1BZ2VudCcsJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMTsgV09XNjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8zMy4wLjE3NTAuMTU0IFNhZmFyaS81MzcuMzYnKQoJaWYgaGVhZGVyczoKCQlmb3IgaCxodiBpbiBoZWFkZXJzOgoJCQlyZXEuYWRkX2hlYWRlcihoLGh2KQoKCXJlc3BvbnNlID0gb3BlbmVyLm9wZW4ocmVxLHBvc3QsdGltZW91dD10aW1lb3V0KQoJbGluaz1yZXNwb25zZS5yZWFkKCkKCXJlc3BvbnNlLmNsb3NlKCkKCXJldHVybiBsaW5rOwoKZGVmIGdldF9kZWNvZGUoc3RyLHJlZz1Ob25lKToKCWlmIHJlZzoKCQlzdHI9cmUuZmluZGFsbChyZWcsIHN0cilbMF0KCXMxID0gdXJsbGliLnVucXVvdGUoc3RyWzA6IGxlbihzdHIpLTFdKTsKCXQgPSAnJzsKCWZvciBpIGluIHJhbmdlKCBsZW4oczEpKToKCQl0ICs9IGNocihvcmQoczFbaV0pIC0gczFbbGVuKHMxKS0xXSk7Cgl0PXVybGxpYi51bnF1b3RlKHQpCglwcmludCB0CglyZXR1cm4gdAoKZGVmIGphdmFzY3JpcHRVbkVzY2FwZShzdHIpOgoJanM9cmUuZmluZGFsbCgndW5lc2NhcGVcKFwnKC4qPylcJycsc3RyKQoJcHJpbnQgJ2pzJyxqcwoJaWYgKG5vdCBqcz09Tm9uZSkgYW5kIGxlbihqcyk+MDoKCQlmb3IgaiBpbiBqczoKCQkJI3ByaW50IHVybGxpYi51bnF1b3RlKGopCgkJCXN0cj1zdHIucmVwbGFjZShqICx1cmxsaWIudW5xdW90ZShqKSkKCXJldHVybiBzdHIKCmlpZD0wCmRlZiBhc2tDYXB0Y2hhKG0saHRtbF9wYWdlLCBjb29raWVKYXIpOgogICAgZ2xvYmFsIGlpZAogICAgaWlkKz0xCiAgICBleHByZT0gbVsnZXhwcmUnXQogICAgcGFnZV91cmwgPSBtWydwYWdlJ10KICAgIGNhcHRjaGFfcmVnZXg9cmUuY29tcGlsZSgnXCRMaXZlU3RyZWFtQ2FwdGNoYVxbKFteXF1dKilcXScpLmZpbmRhbGwoZXhwcmUpWzBdCgogICAgY2FwdGNoYV91cmw9cmUuY29tcGlsZShjYXB0Y2hhX3JlZ2V4KS5maW5kYWxsKGh0bWxfcGFnZSlbMF0KICAgIHByaW50IGV4cHJlLGNhcHRjaGFfcmVnZXgsY2FwdGNoYV91cmwKICAgIGlmIG5vdCBjYXB0Y2hhX3VybC5zdGFydHN3aXRoKCJodHRwIik6CiAgICAgICAgcGFnZV89J2h0dHA6Ly8nKyIiLmpvaW4ocGFnZV91cmwuc3BsaXQoJy8nKVsyOjNdKQogICAgICAgIGlmIGNhcHRjaGFfdXJsLnN0YXJ0c3dpdGgoIi8iKToKICAgICAgICAgICAgY2FwdGNoYV91cmw9cGFnZV8rY2FwdGNoYV91cmwKICAgICAgICBlbHNlOgogICAgICAgICAgICBjYXB0Y2hhX3VybD1wYWdlXysnLycrY2FwdGNoYV91cmwKICAgIAogICAgbG9jYWxfY2FwdGNoYSA9IG9zLnBhdGguam9pbihwcm9maWxlLCBzdHIoaWlkKSsiY2FwdGNoYS5qcGciICkKICAgIGxvY2FsRmlsZSA9IG9wZW4obG9jYWxfY2FwdGNoYSwgIndiIikKICAgIHByaW50ICcgYyBjYXB1cmwnLGNhcHRjaGFfdXJsCiAgICByZXEgPSB1cmxsaWIyLlJlcXVlc3QoY2FwdGNoYV91cmwpCiAgICByZXEuYWRkX2hlYWRlcignVXNlci1BZ2VudCcsICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjE7IHJ2OjE0LjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMTQuMC4xJykKICAgIGlmICdyZWZlcicgaW4gbToKICAgICAgICByZXEuYWRkX2hlYWRlcignUmVmZXJlcicsIG1bJ3JlZmVyJ10pCiAgICBpZiAnYWdlbnQnIGluIG06CiAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1VzZXItYWdlbnQnLCBtWydhZ2VudCddKQogICAgaWYgJ3NldGNvb2tpZScgaW4gbToKICAgICAgICBwcmludCAnYWRkaW5nIGNvb2tpZScsbVsnc2V0Y29va2llJ10KICAgICAgICByZXEuYWRkX2hlYWRlcignQ29va2llJywgbVsnc2V0Y29va2llJ10pCiAgICAgICAgCiAgICAjY29va2llX2hhbmRsZXIgPSB1cmxsaWIyLkhUVFBDb29raWVQcm9jZXNzb3IoY29va2llSmFyKQogICAgI29wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKGNvb2tpZV9oYW5kbGVyLCB1cmxsaWIyLkhUVFBCYXNpY0F1dGhIYW5kbGVyKCksIHVybGxpYjIuSFRUUEhhbmRsZXIoKSkKICAgICNvcGVuZXIgPSB1cmxsaWIyLmluc3RhbGxfb3BlbmVyKG9wZW5lcikKICAgIHVybGxpYjIudXJsb3BlbihyZXEpCiAgICByZXNwb25zZSA9IHVybGxpYjIudXJsb3BlbihyZXEpCgogICAgbG9jYWxGaWxlLndyaXRlKHJlc3BvbnNlLnJlYWQoKSkKICAgIHJlc3BvbnNlLmNsb3NlKCkKICAgIGxvY2FsRmlsZS5jbG9zZSgpCiAgICBzb2x2ZXIgPSBJbnB1dFdpbmRvdyhjYXB0Y2hhPWxvY2FsX2NhcHRjaGEpCiAgICBzb2x1dGlvbiA9IHNvbHZlci5nZXQoKQogICAgcmV0dXJuIHNvbHV0aW9uCiAgICAKY2xhc3MgSW5wdXRXaW5kb3coeGJtY2d1aS5XaW5kb3dEaWFsb2cpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsICphcmdzLCAqKmt3YXJncyk6CiAgICAgICAgc2VsZi5jcHRsb2MgPSBrd2FyZ3MuZ2V0KCdjYXB0Y2hhJykKICAgICAgICBzZWxmLmltZyA9IHhibWNndWkuQ29udHJvbEltYWdlKDMzNSwzMCw2MjQsNjAsc2VsZi5jcHRsb2MpCiAgICAgICAgc2VsZi5hZGRDb250cm9sKHNlbGYuaW1nKQogICAgICAgIHNlbGYua2JkID0geGJtYy5LZXlib2FyZCgpCgogICAgZGVmIGdldChzZWxmKToKICAgICAgICBzZWxmLnNob3coKQogICAgICAgIHRpbWUuc2xlZXAoMikgICAgICAgIAogICAgICAgIHNlbGYua2JkLmRvTW9kYWwoKQogICAgICAgIGlmIChzZWxmLmtiZC5pc0NvbmZpcm1lZCgpKToKICAgICAgICAgICAgdGV4dCA9IHNlbGYua2JkLmdldFRleHQoKQogICAgICAgICAgICBzZWxmLmNsb3NlKCkKICAgICAgICAgICAgcmV0dXJuIHRleHQKICAgICAgICBzZWxmLmNsb3NlKCkKICAgICAgICByZXR1cm4gRmFsc2UKICAgIApkZWYgZ2V0RXBvY1RpbWUoKToKICAgIGltcG9ydCB0aW1lCiAgICByZXR1cm4gc3RyKGludCh0aW1lLnRpbWUoKSoxMDAwKSkKCmRlZiBnZXRFcG9jVGltZTIoKToKICAgIGltcG9ydCB0aW1lCiAgICByZXR1cm4gc3RyKGludCh0aW1lLnRpbWUoKSkpCgpkZWYgZ2V0X3BhcmFtcygpOgogICAgICAgIHBhcmFtPVtdCiAgICAgICAgcGFyYW1zdHJpbmc9c3lzLmFyZ3ZbMl0KICAgICAgICBpZiBsZW4ocGFyYW1zdHJpbmcpPj0yOgogICAgICAgICAgICBwYXJhbXM9c3lzLmFyZ3ZbMl0KICAgICAgICAgICAgY2xlYW5lZHBhcmFtcz1wYXJhbXMucmVwbGFjZSgnPycsJycpCiAgICAgICAgICAgIGlmIChwYXJhbXNbbGVuKHBhcmFtcyktMV09PScvJyk6CiAgICAgICAgICAgICAgICBwYXJhbXM9cGFyYW1zWzA6bGVuKHBhcmFtcyktMl0KICAgICAgICAgICAgcGFpcnNvZnBhcmFtcz1jbGVhbmVkcGFyYW1zLnNwbGl0KCcmJykKICAgICAgICAgICAgcGFyYW09e30KICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKHBhaXJzb2ZwYXJhbXMpKToKICAgICAgICAgICAgICAgIHNwbGl0cGFyYW1zPXt9CiAgICAgICAgICAgICAgICBzcGxpdHBhcmFtcz1wYWlyc29mcGFyYW1zW2ldLnNwbGl0KCc9JykKICAgICAgICAgICAgICAgIGlmIChsZW4oc3BsaXRwYXJhbXMpKT09MjoKICAgICAgICAgICAgICAgICAgICBwYXJhbVtzcGxpdHBhcmFtc1swXV09c3BsaXRwYXJhbXNbMV0KICAgICAgICByZXR1cm4gcGFyYW0KCgpkZWYgZ2V0RmF2b3JpdGVzKCk6CiAgICAgICAgaXRlbXMgPSBqc29uLmxvYWRzKG9wZW4oZmF2b3JpdGVzKS5yZWFkKCkpCiAgICAgICAgdG90YWwgPSBsZW4oaXRlbXMpCiAgICAgICAgZm9yIGkgaW4gaXRlbXM6CiAgICAgICAgICAgIG5hbWUgPSBpWzBdCiAgICAgICAgICAgIHVybCA9IGlbMV0KICAgICAgICAgICAgaWNvbmltYWdlID0gaVsyXQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBmYW5BcnQgPSBpWzNdCiAgICAgICAgICAgICAgICBpZiBmYW5BcnQgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCd1c2VfdGh1bWInKSA9PSAidHJ1ZSI6CiAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gaWNvbmltYWdlCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGZhbmFydAogICAgICAgICAgICB0cnk6IHBsYXlsaXN0ID0gaVs1XQogICAgICAgICAgICBleGNlcHQ6IHBsYXlsaXN0ID0gTm9uZQogICAgICAgICAgICB0cnk6IHJlZ2V4cyA9IGlbNl0KICAgICAgICAgICAgZXhjZXB0OiByZWdleHMgPSBOb25lCgogICAgICAgICAgICBpZiBpWzRdID09IDA6CiAgICAgICAgICAgICAgICBhZGRMaW5rKHVybCxuYW1lLGljb25pbWFnZSxmYW5BcnQsJycsJycsJycsJ2ZhdicscGxheWxpc3QscmVnZXhzLHRvdGFsKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsLGlbNF0saWNvbmltYWdlLGZhbmFydCwnJywnJywnJywnJywnZmF2JykKCgpkZWYgYWRkRmF2b3JpdGUobmFtZSx1cmwsaWNvbmltYWdlLGZhbmFydCxtb2RlLHBsYXlsaXN0PU5vbmUscmVnZXhzPU5vbmUpOgogICAgICAgIGZhdkxpc3QgPSBbXQogICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhmYXZvcml0ZXMgKyAndHh0Jyk6CiAgICAgICAgICAgIG9zLm1ha2VkaXJzKGZhdm9yaXRlcyArICd0eHQnKQogICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhoaXN0b3J5KToKICAgICAgICAgICAgb3MubWFrZWRpcnMoaGlzdG9yeSkKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgc2VlbXMgdGhhdCBhZnRlcgogICAgICAgICAgICBuYW1lID0gbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoZmF2b3JpdGVzKT09RmFsc2U6CiAgICAgICAgICAgIGFkZG9uX2xvZygnTWFraW5nIEZhdm9yaXRlcyBGaWxlJykKICAgICAgICAgICAgZmF2TGlzdC5hcHBlbmQoKG5hbWUsdXJsLGljb25pbWFnZSxmYW5hcnQsbW9kZSxwbGF5bGlzdCxyZWdleHMpKQogICAgICAgICAgICBhID0gb3BlbihmYXZvcml0ZXMsICJ3IikKICAgICAgICAgICAgYS53cml0ZShqc29uLmR1bXBzKGZhdkxpc3QpKQogICAgICAgICAgICBhLmNsb3NlKCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBhZGRvbl9sb2coJ0FwcGVuZGluZyBGYXZvcml0ZXMnKQogICAgICAgICAgICBhID0gb3BlbihmYXZvcml0ZXMpLnJlYWQoKQogICAgICAgICAgICBkYXRhID0ganNvbi5sb2FkcyhhKQogICAgICAgICAgICBkYXRhLmFwcGVuZCgobmFtZSx1cmwsaWNvbmltYWdlLGZhbmFydCxtb2RlKSkKICAgICAgICAgICAgYiA9IG9wZW4oZmF2b3JpdGVzLCAidyIpCiAgICAgICAgICAgIGIud3JpdGUoanNvbi5kdW1wcyhkYXRhKSkKICAgICAgICAgICAgYi5jbG9zZSgpCgoKZGVmIHJtRmF2b3JpdGUobmFtZSk6CiAgICAgICAgZGF0YSA9IGpzb24ubG9hZHMob3BlbihmYXZvcml0ZXMpLnJlYWQoKSkKICAgICAgICBmb3IgaW5kZXggaW4gcmFuZ2UobGVuKGRhdGEpKToKICAgICAgICAgICAgaWYgZGF0YVtpbmRleF1bMF09PW5hbWU6CiAgICAgICAgICAgICAgICBkZWwgZGF0YVtpbmRleF0KICAgICAgICAgICAgICAgIGIgPSBvcGVuKGZhdm9yaXRlcywgInciKQogICAgICAgICAgICAgICAgYi53cml0ZShqc29uLmR1bXBzKGRhdGEpKQogICAgICAgICAgICAgICAgYi5jbG9zZSgpCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuQ29udGFpbmVyLlJlZnJlc2giKQoKZGVmIHVybHNvbHZlcih1cmwpOgogICAgaWYgYWRkb24uZ2V0U2V0dGluZygnVXBkYXRlY29tbW9ucmVzb2x2ZXJzJykgPT0gJ3RydWUnOgogICAgICAgIGwgPSBvcy5wYXRoLmpvaW4oaG9tZSwnZ2VuZXNpc3Jlc29sdmVycy5weScpCiAgICAgICAgaWYgeGJtY3Zmcy5leGlzdHMobCk6CiAgICAgICAgICAgIG9zLnJlbW92ZShsKQoKICAgICAgICBnZW5lc2lzX3VybCA9ICdodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vbGFtYmRhODEvbGFtYmRhLWFkZG9ucy9tYXN0ZXIvcGx1Z2luLnZpZGVvLmdlbmVzaXMvY29tbW9ucmVzb2x2ZXJzLnB5JwogICAgICAgIHRoPSB1cmxsaWIudXJscmV0cmlldmUoZ2VuZXNpc191cmwsbCkKICAgICAgICBhZGRvbi5zZXRTZXR0aW5nKCdVcGRhdGVjb21tb25yZXNvbHZlcnMnLCAnZmFsc2UnKQogICAgdHJ5OgogICAgICAgIGltcG9ydCBnZW5lc2lzcmVzb2x2ZXJzCiAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKEdlbi1YLFBsZWFzZSBlbmFibGUgVXBkYXRlIENvbW1vbnJlc29sdmVycyB0byBQbGF5IGluIFNldHRpbmdzLiAtICwxMDAwMCkiKQoKICAgIHJlc29sdmVkPWdlbmVzaXNyZXNvbHZlcnMuZ2V0KHVybCkucmVzdWx0CiAgICBpZiB1cmwgPT0gcmVzb2x2ZWQgb3IgcmVzb2x2ZWQgaXMgTm9uZToKICAgICAgICAjaW1wb3J0CiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oR2VuLVgsSXMgRmluZGluZyBZb3VyIExpbmsgLSAsNTAwMCkiKQogICAgICAgIGltcG9ydCByZXNvbHZldXJsCiAgICAgICAgaG9zdCA9IHJlc29sdmV1cmwuSG9zdGVkTWVkaWFGaWxlKHVybCkKICAgICAgICBpZiBob3N0OgogICAgICAgICAgICByZXNvbHZlciA9IHJlc29sdmV1cmwucmVzb2x2ZSh1cmwpCiAgICAgICAgICAgIHJlc29sdmVkID0gcmVzb2x2ZXIKICAgIGlmIHJlc29sdmVkIDoKICAgICAgICBpZiBpc2luc3RhbmNlKHJlc29sdmVkLGxpc3QpOgogICAgICAgICAgICBmb3IgayBpbiByZXNvbHZlZDoKICAgICAgICAgICAgICAgIHF1YWxpdHkgPSBhZGRvbi5nZXRTZXR0aW5nKCdxdWFsaXR5JykKICAgICAgICAgICAgICAgIGlmIGtbJ3F1YWxpdHknXSA9PSAnSEQnICA6CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZXIgPSBrWyd1cmwnXQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbGlmIGtbJ3F1YWxpdHknXSA9PSAnU0QnIDoKICAgICAgICAgICAgICAgICAgICByZXNvbHZlciA9IGtbJ3VybCddCiAgICAgICAgICAgICAgICBlbGlmIGtbJ3F1YWxpdHknXSA9PSAnMTA4MHAnIGFuZCBhZGRvbi5nZXRTZXR0aW5nKCcxMDgwcHF1YWxpdHknKSA9PSAndHJ1ZScgOgogICAgICAgICAgICAgICAgICAgIHJlc29sdmVyID0ga1sndXJsJ10KICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJlc29sdmVyID0gcmVzb2x2ZWQKICAgIHJldHVybiByZXNvbHZlcgpkZWYgcGxheV9wbGF5bGlzdChuYW1lLCBtdV9wbGF5bGlzdCk6CiAgICAgICAgaW1wb3J0IHVybHBhcnNlCiAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygnYXNrX3BsYXlsaXN0X2l0ZW1zJykgPT0gJ3RydWUnOgogICAgICAgICAgICBuYW1lcyA9IFtdCiAgICAgICAgICAgIGZvciBpIGluIG11X3BsYXlsaXN0OgogICAgICAgICAgICAgICAgZF9uYW1lPXVybHBhcnNlLnVybHBhcnNlKGkpLm5ldGxvYwogICAgICAgICAgICAgICAgaWYgZF9uYW1lID09ICcnOgogICAgICAgICAgICAgICAgICAgIG5hbWVzLmFwcGVuZChuYW1lKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBuYW1lcy5hcHBlbmQoZF9uYW1lKQogICAgICAgICAgICBkaWFsb2cgPSB4Ym1jZ3VpLkRpYWxvZygpCiAgICAgICAgICAgIGluZGV4ID0gZGlhbG9nLnNlbGVjdCgnQ2hvb3NlIGEgdmlkZW8gc291cmNlJywgbmFtZXMpCiAgICAgICAgICAgIGlmIGluZGV4ID49IDA6CiAgICAgICAgICAgICAgICBpZiAiJm1vZGU9MTkiIGluIG11X3BsYXlsaXN0W2luZGV4XToKICAgICAgICAgICAgICAgICAgICB4Ym1jLlBsYXllcigpLnBsYXkodXJsc29sdmVyKG11X3BsYXlsaXN0W2luZGV4XS5yZXBsYWNlKCcmbW9kZT0xOScsJycpKSkKICAgICAgICAgICAgICAgIGVsaWYgIiRkb3JlZ2V4IiBpbiBtdV9wbGF5bGlzdFtpbmRleF0gOgoKICAgICAgICAgICAgICAgICAgICBzZXBhdGUgPSBtdV9wbGF5bGlzdFtpbmRleF0uc3BsaXQoJyZyZWdleHM9JykKCiAgICAgICAgICAgICAgICAgICAgdXJsLHNldHJlc29sdmVkID0gZ2V0UmVnZXhQYXJzZWQoc2VwYXRlWzFdLCBzZXBhdGVbMF0pCiAgICAgICAgICAgICAgICAgICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHVybCkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgdXJsID0gbXVfcGxheWxpc3RbaW5kZXhdCiAgICAgICAgICAgICAgICAgICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHVybCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBwbGF5bGlzdCA9IHhibWMuUGxheUxpc3QoMSkgIyAxIG1lYW5zIHZpZGVvCiAgICAgICAgICAgIHBsYXlsaXN0LmNsZWFyKCkKICAgICAgICAgICAgaXRlbSA9IDAKICAgICAgICAgICAgZm9yIGkgaW4gbXVfcGxheWxpc3Q6CiAgICAgICAgICAgICAgICBpdGVtICs9IDEKICAgICAgICAgICAgICAgIGluZm8gPSB4Ym1jZ3VpLkxpc3RJdGVtKCclcykgJXMnICUoc3RyKGl0ZW0pLG5hbWUpKQogICAgICAgICAgICAgICAgcGxheWxpc3QuYWRkKGksIGluZm8pCiAgICAgICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCdwbGF5bGlzdC5wbGF5b2Zmc2V0KHZpZGVvLDApJykKCgpkZWYgZG93bmxvYWRfZmlsZShuYW1lLCB1cmwpOgogICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ3NhdmVfbG9jYXRpb24nKSA9PSAiIjoKICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oJ0dlbi1YJywnQ2hvb3NlIGEgbG9jYXRpb24gdG8gc2F2ZSBmaWxlcy4nLDE1MDAwLCIraWNvbisiKSIpCiAgICAgICAgICAgIGFkZG9uLm9wZW5TZXR0aW5ncygpCiAgICAgICAgcGFyYW1zID0geyd1cmwnOiB1cmwsICdkb3dubG9hZF9wYXRoJzogYWRkb24uZ2V0U2V0dGluZygnc2F2ZV9sb2NhdGlvbicpfQogICAgICAgIGRvd25sb2FkZXIuZG93bmxvYWQobmFtZSwgcGFyYW1zKQogICAgICAgIGRpYWxvZyA9IHhibWNndWkuRGlhbG9nKCkKICAgICAgICByZXQgPSBkaWFsb2cueWVzbm8oJ0dlbi1YJywgJ0RvIHlvdSB3YW50IHRvIGFkZCB0aGlzIGZpbGUgYXMgYSBzb3VyY2U/JykKICAgICAgICBpZiByZXQ6CiAgICAgICAgICAgIGFkZFNvdXJjZShvcy5wYXRoLmpvaW4oYWRkb24uZ2V0U2V0dGluZygnc2F2ZV9sb2NhdGlvbicpLCBuYW1lKSkKCgpkZWYgYWRkRGlyKG5hbWUsdXJsLG1vZGUsaWNvbmltYWdlLGZhbmFydCxkZXNjcmlwdGlvbixnZW5yZSxkYXRlLGNyZWRpdHMsc2hvd2NvbnRleHQ9RmFsc2UpOgogICAgICAgIAogICAgICAgIHU9c3lzLmFyZ3ZbMF0rIj91cmw9Iit1cmxsaWIucXVvdGVfcGx1cyh1cmwpKyImbW9kZT0iK3N0cihtb2RlKSsiJm5hbWU9Iit1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSsiJmljb25pbWFnZT0iK3VybGxpYi5xdW90ZV9wbHVzKGljb25pbWFnZSkrIiZmYW5hcnQ9Iit1cmxsaWIucXVvdGVfcGx1cyhmYW5hcnQpCiAgICAgICAgb2s9VHJ1ZQogICAgICAgIGlmIGRhdGUgPT0gJyc6CiAgICAgICAgICAgIGRhdGUgPSBOb25lCiAgICAgICAgZWxzZToKICAgICAgICAgICAgZGVzY3JpcHRpb24gKz0gJ1xuXG5EYXRlOiAlcycgJWRhdGUKICAgICAgICBsaXo9eGJtY2d1aS5MaXN0SXRlbShuYW1lLCBpY29uSW1hZ2U9IkRlZmF1bHRGb2xkZXIucG5nIiwgdGh1bWJuYWlsSW1hZ2U9aWNvbmltYWdlKQogICAgICAgIGxpei5zZXRJbmZvKHR5cGU9IlZpZGVvIiwgaW5mb0xhYmVscz17ICJUaXRsZSI6IG5hbWUsICJQbG90IjogZGVzY3JpcHRpb24sICJHZW5yZSI6IGdlbnJlLCAiZGF0ZWFkZGVkIjogZGF0ZSwgImNyZWRpdHMiOiBjcmVkaXRzIH0pCiAgICAgICAgbGl6LnNldFByb3BlcnR5KCJGYW5hcnRfSW1hZ2UiLCBmYW5hcnQpCiAgICAgICAgaWYgc2hvd2NvbnRleHQ6CiAgICAgICAgICAgIGNvbnRleHRNZW51ID0gW10KICAgICAgICAgICAgaWYgc2hvd2NvbnRleHQgPT0gJ3NvdXJjZSc6CiAgICAgICAgICAgICAgICBpZiBuYW1lIGluIHN0cihTT1VSQ0VTKToKICAgICAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdSZW1vdmUgZnJvbSBTb3VyY2VzJywnWEJNQy5SdW5QbHVnaW4oJXM/bW9kZT04Jm5hbWU9JXMpJyAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQogICAgICAgICAgICBlbGlmIHNob3djb250ZXh0ID09ICdkb3dubG9hZCc6CiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdEb3dubG9hZCcsJ1hCTUMuUnVuUGx1Z2luKCVzP3VybD0lcyZtb2RlPTkmbmFtZT0lcyknCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpCiAgICAgICAgICAgIGVsaWYgc2hvd2NvbnRleHQgPT0gJ2Zhdic6CiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdSZW1vdmUgZnJvbSBBZGQtb24gRmF2b3JpdGVzJywnWEJNQy5SdW5QbHVnaW4oJXM/bW9kZT02Jm5hbWU9JXMpJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQoJCQkJCQkJCQkKICAgICAgICAgICAgaWYgbm90IG5hbWUgaW4gRkFWOgogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnQWRkIHRvIEFkZC1vbiBGYXZvcml0ZXMnLCdYQk1DLlJ1blBsdWdpbiglcz9tb2RlPTUmbmFtZT0lcyZ1cmw9JXMmaWNvbmltYWdlPSVzJmZhbmFydD0lcyZmYXZfbW9kZT0lcyknCiAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMoaWNvbmltYWdlKSwgdXJsbGliLnF1b3RlX3BsdXMoZmFuYXJ0KSwgbW9kZSkpKQogICAgICAgICAgICBsaXouYWRkQ29udGV4dE1lbnVJdGVtcyhjb250ZXh0TWVudSkKICAgICAgICBvaz14Ym1jcGx1Z2luLmFkZERpcmVjdG9yeUl0ZW0oaGFuZGxlPWludChzeXMuYXJndlsxXSksdXJsPXUsbGlzdGl0ZW09bGl6LGlzRm9sZGVyPVRydWUpCgogICAgICAgIHJldHVybiBvawpkZWYgeXRkbF9kb3dubG9hZCh1cmwsdGl0bGUsbWVkaWFfdHlwZT0ndmlkZW8nKToKICAgICMgcGxheSBpbiB4Ym1jIHdoaWxlIHBsYXlpbmcgZ28gYmFjayB0byBjb250ZXh0TWVudShjKSB0byAiISFEb3dubG9hZCEhIgogICAgIyBUcmlhbCB5YXNjZWVuOiBzZXBlcmF0ZSB8VXNlci1BZ2VudD0KICAgIGltcG9ydCB5b3V0dWJlZGwKICAgIGlmIG5vdCB1cmwgPT0gJyc6CiAgICAgICAgaWYgbWVkaWFfdHlwZT09ICdhdWRpbyc6CiAgICAgICAgICAgIHlvdXR1YmVkbC5zaW5nbGVfWUQodXJsLGRvd25sb2FkPVRydWUsYXVkaW89VHJ1ZSkKICAgICAgICBlbHNlOgogICAgICAgICAgICB5b3V0dWJlZGwuc2luZ2xlX1lEKHVybCxkb3dubG9hZD1UcnVlKSAgIAogICAgZWxpZiB4Ym1jLlBsYXllcigpLmlzUGxheWluZygpID09IFRydWUgOgogICAgICAgIGltcG9ydCBZRFN0cmVhbUV4dHJhY3RvcgogICAgICAgIGlmIFlEU3RyZWFtRXh0cmFjdG9yLmlzRG93bmxvYWRpbmcoKSA9PSBUcnVlOgoKICAgICAgICAgICAgWURTdHJlYW1FeHRyYWN0b3IubWFuYWdlRG93bmxvYWRzKCkKICAgICAgICBlbHNlOgogICAgICAgICAgICB4Ym1jX3VybCA9IHhibWMuUGxheWVyKCkuZ2V0UGxheWluZ0ZpbGUoKQoKICAgICAgICAgICAgeGJtY191cmwgPSB4Ym1jX3VybC5zcGxpdCgnfFVzZXItQWdlbnQ9JylbMF0KICAgICAgICAgICAgaW5mbyA9IHsndXJsJzp4Ym1jX3VybCwndGl0bGUnOnRpdGxlLCdtZWRpYV90eXBlJzptZWRpYV90eXBlfQogICAgICAgICAgICB5b3V0dWJlZGwuc2luZ2xlX1lEKCcnLGRvd25sb2FkPVRydWUsZGxfaW5mbz1pbmZvKSAgICAKICAgIGVsc2U6CiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oRE9XTkxPQUQsRmlyc3QgUGxheSBbQ09MT1IgeWVsbG93XVdISUxFIHBsYXlpbmcgZG93bmxvYWRbL0NPTE9SXSAsMTAwMDApIikKIApkZWYgc2VhcmNoKHNpdGVfbmFtZSxzZWFyY2hfdGVybT1Ob25lKToKICAgIHRodW1ibmFpbD0nJwogICAgaWYgb3MucGF0aC5leGlzdHMoaGlzdG9yeSkgPT0gRmFsc2Ugb3IgYWRkb24uZ2V0U2V0dGluZygnY2xlYXJzZWFjaGhpc3RvcnknKT09J3RydWUnOgogICAgICAgIFNhdmVUb0ZpbGUoaGlzdG9yeSwnJykKICAgICAgICBhZGRvbi5zZXRTZXR0aW5nKCJjbGVhcnNlYWNoaGlzdG9yeSIsImZhbHNlIikKICAgIGlmIHNpdGVfbmFtZSA9PSAnaGlzdG9yeScgOgogICAgICAgIGNvbnRlbnQgPSBMb2FkRmlsZShoaXN0b3J5KQogICAgICAgIG1hdGNoID0gcmUuY29tcGlsZSgnKC4rPyk6KC4qPykoPzpccnxcbiknKS5maW5kYWxsKGNvbnRlbnQpCgogICAgICAgIGZvciBuYW1lLHNlYXJjaF90ZXJtIGluIG1hdGNoOgogICAgICAgICAgICBpZiAncGx1Z2luOi8vJyBpbiBzZWFyY2hfdGVybToKICAgICAgICAgICAgICAgIGFkZExpbmsoc2VhcmNoX3Rlcm0sIG5hbWUsdGh1bWJuYWlsLCcnLCcnLCcnLCcnLCcnLE5vbmUsJycsdG90YWw9aW50KGxlbihtYXRjaCkpKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUrJzonK3NlYXJjaF90ZXJtLG5hbWUsMjYsaWNvbixGQU5BUlQsJycsJycsJycsJycpCiAgICBpZiBub3Qgc2VhcmNoX3Rlcm06ICAgIAogICAgICAgIGtleWJvYXJkID0geGJtYy5LZXlib2FyZCgnJywnRW50ZXIgU2VhcmNoIFRlcm0nKQogICAgICAgIGtleWJvYXJkLmRvTW9kYWwoKQogICAgICAgIGlmIChrZXlib2FyZC5pc0NvbmZpcm1lZCgpID09IEZhbHNlKToKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgc2VhcmNoX3Rlcm0gPSBrZXlib2FyZC5nZXRUZXh0KCkKICAgICAgICBpZiBsZW4oc2VhcmNoX3Rlcm0pID09IDA6CiAgICAgICAgICAgIHJldHVybiAgICAgICAgCiAgICBzZWFyY2hfdGVybSA9IHNlYXJjaF90ZXJtLnJlcGxhY2UoJyAnLCcrJykKICAgIHNlYXJjaF90ZXJtID0gc2VhcmNoX3Rlcm0uZW5jb2RlKCd1dGYtOCcpCiAgICBpZiAneW91dHViZScgaW4gc2l0ZV9uYW1lOgogICAgICAgICN5b3V0dWJlID0geW91dHViZSNMYW5hIERlbCBSZXkKICAgICAgICBpbXBvcnQgX3l0cGxpc3QKCiAgICAgICAgc2VhcmNoX3JlcyA9IHt9CiAgICAgICAgc2VhcmNoX3JlcyA9IF95dHBsaXN0LllvVVR1YmUoJ3NlYXJjaFlUJyx5b3V0dWJlPXNlYXJjaF90ZXJtLG1heF9wYWdlPTQsbm9zYXZlPSdub3NhdmUnKQogICAgICAgIHRvdGFsID0gbGVuKHNlYXJjaF9yZXMpCiAgICAgICAgZm9yIGl0ZW0gaW4gc2VhcmNoX3JlczoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgbmFtZSA9IHNlYXJjaF9yZXNbaXRlbV1bJ3RpdGxlJ10KICAgICAgICAgICAgICAgIGRhdGU9IHNlYXJjaF9yZXNbaXRlbV1bJ2RhdGUnXQogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gc2VhcmNoX3Jlc1tpdGVtXVsnZGVzYyddCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gJ1VOQVZBSUFCTEUnCgogICAgICAgICAgICAgICAgdXJsID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby55b3V0dWJlL3BsYXkvP3ZpZGVvX2lkPScgKyBzZWFyY2hfcmVzW2l0ZW1dWyd1cmwnXQogICAgICAgICAgICAgICAgdGh1bWJuYWlsID0naHR0cDovL2ltZy55b3V0dWJlLmNvbS92aS8nK3NlYXJjaF9yZXNbaXRlbV1bJ3VybCddKycvMC5qcGcnCiAgICAgICAgICAgICAgICBhZGRMaW5rKHVybCwgbmFtZSx0aHVtYm5haWwsJycsJycsJycsJycsJycsTm9uZSwnJyx0b3RhbCkKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgCWFkZG9uX2xvZyggJ1RoaXMgaXRlbSBpcyBpZ25vcmVkOjonKQogICAgICAgIHBhZ2VfZGF0YSA9IHNpdGVfbmFtZSArJzonKyBzZWFyY2hfdGVybSArICdcbicKICAgICAgICBTYXZlVG9GaWxlKG9zLnBhdGguam9pbihwcm9maWxlLCdoaXN0b3J5JykscGFnZV9kYXRhLGFwcGVuZD1UcnVlKQogICAgZWxpZiAnZG1vdGlvbicgaW4gc2l0ZV9uYW1lOgogICAgICAgIHVybE1haW4gPSAiaHR0cHM6Ly9hcGkuZGFpbHltb3Rpb24uY29tIiAKICAgICAgICAjeW91dHViZSA9IHlvdXR1YmUjTGFuYSBEZWwgUmV5CiAgICAgICAgaW1wb3J0IF9ETXNlYXJjaAogICAgICAgIGZhbWlseUZpbHRlciA9IHN0cihhZGRvbi5nZXRTZXR0aW5nKCdmYW1pbHlGaWx0ZXInKSkKICAgICAgICBfRE1zZWFyY2gubGlzdFZpZGVvcyh1cmxNYWluKyIvdmlkZW9zP2ZpZWxkcz1kZXNjcmlwdGlvbixkdXJhdGlvbixpZCxvd25lci51c2VybmFtZSx0YWtlbl90aW1lLHRodW1ibmFpbF9sYXJnZV91cmwsdGl0bGUsdmlld3NfdG90YWwmc2VhcmNoPSIrc2VhcmNoX3Rlcm0rIiZzb3J0PXJlbGV2YW5jZSZsaW1pdD0xMDAmZmFtaWx5X2ZpbHRlcj0iK2ZhbWlseUZpbHRlcisiJmxvY2FsaXphdGlvbj1lbl9FTiZwYWdlPTEiKQogICAgCiAgICAgICAgcGFnZV9kYXRhID0gc2l0ZV9uYW1lICsnOicrIHNlYXJjaF90ZXJtKyAnXG4nCiAgICAgICAgU2F2ZVRvRmlsZShvcy5wYXRoLmpvaW4ocHJvZmlsZSwnaGlzdG9yeScpLHBhZ2VfZGF0YSxhcHBlbmQ9VHJ1ZSkgICAgICAgIAogICAgZWxpZiAnSU1EQmlkcGxheScgaW4gc2l0ZV9uYW1lOgogICAgICAgIHVybE1haW4gPSAiaHR0cDovL3d3dy5vbWRiYXBpLmNvbS8/dD0iIAogICAgICAgIHVybD0gdXJsTWFpbitzZWFyY2hfdGVybQoKICAgICAgICBoZWFkZXJzID0gZGljdCh7J1VzZXItQWdlbnQnOidNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjM7IHJ2OjMzLjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMzMuMCcsJ1JlZmVyZXInOiAnaHR0cDovL2pva2VyLm9yZy8nLCdBY2NlcHQtRW5jb2RpbmcnOidnemlwLCBkZWZsYXRlJywnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb247Y2hhcnNldD11dGYtOCcsJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uLCB0ZXh0L3BsYWluLCAqLyonfSkKICAgIAogICAgICAgIHI9cmVxdWVzdHMuZ2V0KHVybCxoZWFkZXJzPWhlYWRlcnMpCiAgICAgICAgZGF0YSA9IHIuanNvbigpCiAgICAgICAgcmVzID0gZGF0YVsnUmVzcG9uc2UnXQogICAgICAgIGlmIHJlcyA9PSAnVHJ1ZSc6CiAgICAgICAgICAgIGltZGJJRCA9IGRhdGFbJ2ltZGJJRCddCiAgICAgICAgICAgIG5hbWU9IGRhdGFbJ1RpdGxlJ10gKyBkYXRhWydSZWxlYXNlZCddCiAgICAgICAgICAgIGRpYWxvZyA9IHhibWNndWkuRGlhbG9nKCkKICAgICAgICAgICAgcmV0ID0gZGlhbG9nLnllc25vKCdDaGVjayBNb3ZpZSBUaXRsZScsICdQTEFZIDo6ICVzID8nJW5hbWUpCiAgICAgICAgICAgIGlmIHJldDoKICAgICAgICAgICAgICAgIHVybCA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ucHVsc2FyL21vdmllLycraW1kYklEKycvcGxheScKICAgICAgICAgICAgICAgIHBhZ2VfZGF0YSA9IG5hbWUgKyc6JysgdXJsKyAnXG4nCiAgICAgICAgICAgICAgICBTYXZlVG9GaWxlKGhpc3RvcnkscGFnZV9kYXRhLGFwcGVuZD1UcnVlKQogICAgICAgICAgICAgICAgcmV0dXJuIHVybAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKFNpbXBsZUtvcmUsTm8gSU1EQiBtYXRjaCBmb3VuZCAsNzAwMCwiK2ljb24rIikiKQojIyBMdW5hdGl4eiBQc2V1ZG9UViBmZWF0dXJlCmRlZiBhc2NpaShzdHJpbmcpOgogICAgaWYgaXNpbnN0YW5jZShzdHJpbmcsIGJhc2VzdHJpbmcpOgogICAgICAgIGlmIGlzaW5zdGFuY2Uoc3RyaW5nLCB1bmljb2RlKToKICAgICAgICAgICBzdHJpbmcgPSBzdHJpbmcuZW5jb2RlKCdhc2NpaScsICdpZ25vcmUnKQogICAgcmV0dXJuIHN0cmluZwpkZWYgdW5pKHN0cmluZywgZW5jb2RpbmcgPSAndXRmLTgnKToKICAgIGlmIGlzaW5zdGFuY2Uoc3RyaW5nLCBiYXNlc3RyaW5nKToKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShzdHJpbmcsIHVuaWNvZGUpOgogICAgICAgICAgICBzdHJpbmcgPSB1bmljb2RlKHN0cmluZywgZW5jb2RpbmcsICdpZ25vcmUnKQogICAgcmV0dXJuIHN0cmluZwpkZWYgcmVtb3ZlTm9uQXNjaWkocyk6IHJldHVybiAiIi5qb2luKGZpbHRlcihsYW1iZGEgeDogb3JkKHgpPDEyOCwgcykpCgpkZWYgc2VuZEpTT04oIGNvbW1hbmQpOgogICAgZGF0YSA9ICcnCiAgICB0cnk6CiAgICAgICAgZGF0YSA9IHhibWMuZXhlY3V0ZUpTT05SUEModW5pKGNvbW1hbmQpKQogICAgZXhjZXB0IFVuaWNvZGVFbmNvZGVFcnJvcjoKICAgICAgICBkYXRhID0geGJtYy5leGVjdXRlSlNPTlJQQyhhc2NpaShjb21tYW5kKSkKCiAgICByZXR1cm4gdW5pKGRhdGEpCgojaGFrYW1hYyB0aGFua3MgUm9tYW5fVl9NCmRlZiBTZXRWaWV3VGh1bWJuYWlsKCk6CiAgICBza2luX3VzZWQgPSB4Ym1jLmdldFNraW5EaXIoKQogICAgaWYgc2tpbl91c2VkID09ICdza2luLmNvbmZsdWVuY2UnOgogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oJ0NvbnRhaW5lci5TZXRWaWV3TW9kZSg1MDApJykKICAgIGVsaWYgc2tpbl91c2VkID09ICdza2luLmFlb24ubm94JzoKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCdDb250YWluZXIuU2V0Vmlld01vZGUoNTExKScpIAogICAgZWxzZToKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCdDb250YWluZXIuU2V0Vmlld01vZGUoNTAwKScpCgkKCQpkZWYgcGx1Z2lucXVlcnlieUpTT04odXJsKToKICAgIGpzb25fcXVlcnkgPSB1bmkoJ3sianNvbnJwYyI6IjIuMCIsIm1ldGhvZCI6IkZpbGVzLkdldERpcmVjdG9yeSIsInBhcmFtcyI6eyJkaXJlY3RvcnkiOiIlcyIsIm1lZGlhIjoidmlkZW8iLCJwcm9wZXJ0aWVzIjpbInRodW1ibmFpbCIsInRpdGxlIiwieWVhciIsImRhdGVhZGRlZCIsImZhbmFydCIsInJhdGluZyIsInNlYXNvbiIsImVwaXNvZGUiLCJzdHVkaW8iXX0sImlkIjoxfScpICV1cmwKCiAgICBqc29uX2ZvbGRlcl9kZXRhaWwgPSBqc29uLmxvYWRzKHNlbmRKU09OKGpzb25fcXVlcnkpKQogICAgZm9yIGkgaW4ganNvbl9mb2xkZXJfZGV0YWlsWydyZXN1bHQnXVsnZmlsZXMnXSA6CiAgICAgICAgdXJsID0gaVsnZmlsZSddCiAgICAgICAgbmFtZSA9IHJlbW92ZU5vbkFzY2lpKGlbJ2xhYmVsJ10pCiAgICAgICAgdGh1bWJuYWlsID0gcmVtb3ZlTm9uQXNjaWkoaVsndGh1bWJuYWlsJ10pCiAgICAgICAgdHJ5OgogICAgICAgICAgICBmYW5hcnQgPSByZW1vdmVOb25Bc2NpaShpWydmYW5hcnQnXSkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICBmYW5hcnQgPSAnJwogICAgICAgIHRyeToKICAgICAgICAgICAgZGF0ZSA9IGlbJ3llYXInXQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIGRhdGUgPSAnJwogICAgICAgIHRyeToKICAgICAgICAgICAgZXBpc29kZSA9IGlbJ2VwaXNvZGUnXQogICAgICAgICAgICBzZWFzb24gPSBpWydzZWFzb24nXQogICAgICAgICAgICBpZiBlcGlzb2RlID09IC0xIG9yIHNlYXNvbiA9PSAtMToKICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gJycKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gJ1tDT0xPUiB5ZWxsb3ddIFMnICsgc3RyKHNlYXNvbikrJ1svQ09MT1JdW0NPTE9SIGhvdHBpbmtdIEUnICsgc3RyKGVwaXNvZGUpICsnWy9DT0xPUl0nCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgZGVzY3JpcHRpb24gPSAnJwogICAgICAgIHRyeToKICAgICAgICAgICAgc3R1ZGlvID0gaVsnc3R1ZGlvJ10KICAgICAgICAgICAgaWYgc3R1ZGlvOgogICAgICAgICAgICAgICAgZGVzY3JpcHRpb24gKz0gJ1xuIFN0dWRpbzpbQ09MT1Igc3RlZWxibHVlXSAnICsgc3R1ZGlvWzBdICsgJ1svQ09MT1JdJwogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIHN0dWRpbyA9ICcnCgogICAgICAgIGlmIGlbJ2ZpbGV0eXBlJ10gPT0gJ2ZpbGUnOgogICAgICAgICAgICBhZGRMaW5rKHVybCxuYW1lLHRodW1ibmFpbCxmYW5hcnQsZGVzY3JpcHRpb24sJycsZGF0ZSwnJyxOb25lLCcnLHRvdGFsPWxlbihqc29uX2ZvbGRlcl9kZXRhaWxbJ3Jlc3VsdCddWydmaWxlcyddKSkKICAgICAgICAgICAgI3hibWMuZXhlY3V0ZWJ1aWx0aW4oIkNvbnRhaW5lci5TZXRWaWV3TW9kZSg1MDApIikKCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsLDUzLHRodW1ibmFpbCxmYW5hcnQsZGVzY3JpcHRpb24sJycsZGF0ZSwnJykKICAgICAgICAgICAgI3hibWMuZXhlY3V0ZWJ1aWx0aW4oIkNvbnRhaW5lci5TZXRWaWV3TW9kZSg1MDApIikKCmRlZiBhZGRMaW5rKHVybCxuYW1lLGljb25pbWFnZSxmYW5hcnQsZGVzY3JpcHRpb24sZ2VucmUsZGF0ZSxzaG93Y29udGV4dCxwbGF5bGlzdCxyZWdleHMsdG90YWwsc2V0Q29va2llPSIiKToKICAgICAgICAjcHJpbnQgJ3VybCxuYW1lJyx1cmwsbmFtZQogICAgICAgIGNvbnRleHRNZW51ID1bXQogICAgICAgIHRyeToKICAgICAgICAgICAgbmFtZSA9IG5hbWUuZW5jb2RlKCd1dGYtOCcpCiAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgb2sgPSBUcnVlCiAgICAgICAKICAgICAgICBpZiByZWdleHM6IAogICAgICAgICAgICBtb2RlID0gJzE3JwogICAgICAgICAgIAogICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdbQ09MT1Igd2hpdGVdISFEb3dubG9hZCBDdXJyZW50bHkgUGxheWluZyEhWy9DT0xPUl0nLCdYQk1DLlJ1blBsdWdpbiglcz91cmw9JXMmbW9kZT0yMSZuYW1lPSVzKScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkgICAgICAgICAgIAogICAgICAgIGVsaWYgIGFueSh4IGluIHVybCBmb3IgeCBpbiByZXNvbHZlX3VybCkgYW5kICB1cmwuc3RhcnRzd2l0aCgnaHR0cCcpOgogICAgICAgICAgICBtb2RlID0gJzE5JwogICAgICAgICAgCiAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ1tDT0xPUiB3aGl0ZV0hIURvd25sb2FkIEN1cnJlbnRseSBQbGF5aW5nISFbL0NPTE9SXScsJ1hCTUMuUnVuUGx1Z2luKCVzP3VybD0lcyZtb2RlPTIxJm5hbWU9JXMpJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKSAgICAgICAgICAgCiAgICAgICAgZWxpZiB1cmwuZW5kc3dpdGgoJyZtb2RlPTE4Jyk6CiAgICAgICAgICAgIHVybD11cmwucmVwbGFjZSgnJm1vZGU9MTgnLCcnKQogICAgICAgICAgICBtb2RlID0gJzE4JyAKICAgICAgICAgIAogICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdbQ09MT1Igd2hpdGVdISFEb3dubG9hZCEhWy9DT0xPUl0nLCdYQk1DLlJ1blBsdWdpbiglcz91cmw9JXMmbW9kZT0yMyZuYW1lPSVzKScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkgCiAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ2RsYXVkaW9vbmx5JykgPT0gJ3RydWUnOgogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnISFEb3dubG9hZCBbQ09MT1Igc2VhYmx1ZV1BdWRpbyEhWy9DT0xPUl0nLCdYQk1DLlJ1blBsdWdpbiglcz91cmw9JXMmbW9kZT0yNCZuYW1lPSVzKScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgIGVsaWYgdXJsLnN0YXJ0c3dpdGgoJ21hZ25ldDo/eHQ9Jykgb3IgJy50b3JyZW50JyBpbiB1cmw6CiAgICAgICAgICAKICAgICAgICAgICAgaWYgJyYnIGluIHVybCBhbmQgbm90ICcmYW1wOycgaW4gdXJsIDoKICAgICAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCcmJywnJmFtcDsnKQogICAgICAgICAgICB1cmwgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnB1bHNhci9wbGF5P3VyaT0nICsgdXJsCiAgICAgICAgICAgIG1vZGUgPSAnMTInCiAgICAgICAgICAgICAgICAgICAgIAogICAgICAgIGVsc2U6IAogICAgICAgICAgICBtb2RlID0gJzEyJwogICAgICAKICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnW0NPTE9SIHdoaXRlXSEhRG93bmxvYWQgQ3VycmVudGx5IFBsYXlpbmchIVsvQ09MT1JdJywnWEJNQy5SdW5QbHVnaW4oJXM/dXJsPSVzJm1vZGU9MjEmbmFtZT0lcyknCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpICAgICAgICAgICAKICAgICAgICB1PXN5cy5hcmd2WzBdKyI/IgogICAgICAgIHBsYXlfbGlzdCA9IEZhbHNlCiAgICAgIAogICAgICAgIGlmIHBsYXlsaXN0OgogICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdhZGRfcGxheWxpc3QnKSA9PSAiZmFsc2UiOgogICAgICAgICAgICAgICAgdSArPSAidXJsPSIrdXJsbGliLnF1b3RlX3BsdXModXJsKSsiJm1vZGU9Iittb2RlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICB1ICs9ICJtb2RlPTEzJm5hbWU9JXMmcGxheWxpc3Q9JXMiICUodXJsbGliLnF1b3RlX3BsdXMobmFtZSksIHVybGxpYi5xdW90ZV9wbHVzKHN0cihwbGF5bGlzdCkucmVwbGFjZSgnLCcsJ3x8JykpKQogICAgICAgICAgICAgICAgbmFtZSA9IG5hbWUgKyAnW0NPTE9SIG1hZ2VudGFdICgnICsgc3RyKGxlbihwbGF5bGlzdCkpICsgJyBpdGVtcyApWy9DT0xPUl0nCiAgICAgICAgICAgICAgICBwbGF5X2xpc3QgPSBUcnVlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdSArPSAidXJsPSIrdXJsbGliLnF1b3RlX3BsdXModXJsKSsiJm1vZGU9Iittb2RlCiAgICAgICAgaWYgcmVnZXhzOgogICAgICAgICAgICB1ICs9ICImcmVnZXhzPSIrcmVnZXhzCiAgICAgICAgaWYgbm90IHNldENvb2tpZSA9PSAnJzoKICAgICAgICAgICAgdSArPSAiJnNldENvb2tpZT0iK3VybGxpYi5xdW90ZV9wbHVzKHNldENvb2tpZSkKICAKICAgICAgICBpZiBkYXRlID09ICcnOgogICAgICAgICAgICBkYXRlID0gTm9uZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGRlc2NyaXB0aW9uICs9ICdcblxuRGF0ZTogJXMnICVkYXRlCiAgICAgICAgbGl6PXhibWNndWkuTGlzdEl0ZW0obmFtZSwgaWNvbkltYWdlPSJEZWZhdWx0VmlkZW8ucG5nIiwgdGh1bWJuYWlsSW1hZ2U9aWNvbmltYWdlKQogICAgICAgIGxpei5zZXRJbmZvKHR5cGU9IlZpZGVvIiwgaW5mb0xhYmVscz17ICJUaXRsZSI6IG5hbWUsICJQbG90IjogZGVzY3JpcHRpb24sICJHZW5yZSI6IGdlbnJlLCAiZGF0ZWFkZGVkIjogZGF0ZSB9KQogICAgICAgIGxpei5zZXRQcm9wZXJ0eSgiRmFuYXJ0X0ltYWdlIiwgZmFuYXJ0KQogICAgICAgIAogICAgICAgIGlmIChub3QgcGxheV9saXN0KSBhbmQgbm90IGFueSh4IGluIHVybCBmb3IgeCBpbiBnX2lnbm9yZVNldFJlc29sdmVkKTojICAobm90IHVybC5zdGFydHN3aXRoKCdwbHVnaW46Ly9wbHVnaW4udmlkZW8uZjRtVGVzdGVyJykpOgogICAgICAgICAgICBpZiByZWdleHM6CiAgICAgICAgICAgICAgICBpZiAnJHB5RnVuY3Rpb246cGxheW1lZGlhKCcgbm90IGluIHVybGxpYi51bnF1b3RlX3BsdXMocmVnZXhzKSBhbmQgJ25vdHBsYXlhYmxlJyBub3QgaW4gdXJsbGliLnVucXVvdGVfcGx1cyhyZWdleHMpICA6CiAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdzZXR0aW5nIGlzcGxheWFibGUnLHVybCwgdXJsbGliLnVucXVvdGVfcGx1cyhyZWdleHMpLHVybAogICAgICAgICAgICAgICAgICAgIGxpei5zZXRQcm9wZXJ0eSgnSXNQbGF5YWJsZScsICd0cnVlJykKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxpei5zZXRQcm9wZXJ0eSgnSXNQbGF5YWJsZScsICd0cnVlJykKICAgICAgICBlbHNlOgogICAgICAgICAgICBhZGRvbl9sb2coICdOT1Qgc2V0dGluZyBpc3BsYXlhYmxlJyt1cmwpCiAgICAgICAKICAgICAgICBpZiBzaG93Y29udGV4dDoKICAgICAgICAgICAgY29udGV4dE1lbnUgPSBbXQogICAgICAgICAgICBpZiBzaG93Y29udGV4dCA9PSAnZmF2JzoKICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgKICAgICAgICAgICAgICAgICAgICAoJ1JlbW92ZSBmcm9tIEFkZC1vbiBGYXZvcml0ZXMnLCdYQk1DLlJ1blBsdWdpbiglcz9tb2RlPTYmbmFtZT0lcyknCiAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkKICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICBlbGlmIG5vdCBuYW1lIGluIEZBVjoKICAgICAgICAgICAgICAgIGZhdl9wYXJhbXMgPSAoCiAgICAgICAgICAgICAgICAgICAgJyVzP21vZGU9NSZuYW1lPSVzJnVybD0lcyZpY29uaW1hZ2U9JXMmZmFuYXJ0PSVzJmZhdl9tb2RlPTAnCiAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSksIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKGljb25pbWFnZSksIHVybGxpYi5xdW90ZV9wbHVzKGZhbmFydCkpCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgaWYgcGxheWxpc3Q6CiAgICAgICAgICAgICAgICAgICAgZmF2X3BhcmFtcyArPSAncGxheWxpc3Q9Jyt1cmxsaWIucXVvdGVfcGx1cyhzdHIocGxheWxpc3QpLnJlcGxhY2UoJywnLCd8fCcpKQogICAgICAgICAgICAgICAgaWYgcmVnZXhzOgogICAgICAgICAgICAgICAgICAgIGZhdl9wYXJhbXMgKz0gIiZyZWdleHM9IityZWdleHMKICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ0FkZCB0byBBZGQtb24gRmF2b3JpdGVzJywnWEJNQy5SdW5QbHVnaW4oJXMpJyAlZmF2X3BhcmFtcykpCiAgICAgICAgICAgIGxpei5hZGRDb250ZXh0TWVudUl0ZW1zKGNvbnRleHRNZW51KQogICAgICAgCiAgICAgICAgaWYgbm90IHBsYXlsaXN0IGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ2FkZF9wbGF5bGlzdCcpID09ICJmYWxzZSI6CiAgICAgICAgICAgICAgICBwbGF5bGlzdF9uYW1lID0gbmFtZS5zcGxpdCgnKSAnKVsxXQogICAgICAgICAgICAgICAgY29udGV4dE1lbnVfID0gWwogICAgICAgICAgICAgICAgICAgICgnUGxheSAnK3BsYXlsaXN0X25hbWUrJyBQbGF5TGlzdCcsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9MTMmbmFtZT0lcyZwbGF5bGlzdD0lcyknCiAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHBsYXlsaXN0X25hbWUpLCB1cmxsaWIucXVvdGVfcGx1cyhzdHIocGxheWxpc3QpLnJlcGxhY2UoJywnLCd8fCcpKSkpCiAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgIGxpei5hZGRDb250ZXh0TWVudUl0ZW1zKGNvbnRleHRNZW51XykKICAgICAgICAjcHJpbnQgJ2FkZGluZycsbmFtZQogIyAgICAgICBwcmludCB1cmwsdG90YWxpdGVtcwogICAgICAgIG9rPXhibWNwbHVnaW4uYWRkRGlyZWN0b3J5SXRlbShoYW5kbGU9aW50KHN5cy5hcmd2WzFdKSx1cmw9dSxsaXN0aXRlbT1saXosdG90YWxJdGVtcz10b3RhbCkKICAgICAgICAjcHJpbnQgJ2FkZGVkJyxuYW1lCiAgICAgICAgcmV0dXJuIG9rCgpkZWYgcGxheXNldHJlc29sdmVkKHVybCxuYW1lLGljb25pbWFnZSxzZXRyZXNvbHZlZD1UcnVlKToKICAgIGlmIHNldHJlc29sdmVkOgogICAgICAgIGxpeiA9IHhibWNndWkuTGlzdEl0ZW0obmFtZSwgaWNvbkltYWdlPWljb25pbWFnZSkKICAgICAgICBsaXouc2V0SW5mbyh0eXBlPSdWaWRlbycsIGluZm9MYWJlbHM9eydUaXRsZSc6bmFtZX0pCiAgICAgICAgbGl6LnNldFByb3BlcnR5KCJJc1BsYXlhYmxlIiwidHJ1ZSIpCiAgICAgICAgbGl6LnNldFBhdGgoc3RyKHVybCkpCiAgICAgICAgeGJtY3BsdWdpbi5zZXRSZXNvbHZlZFVybChpbnQoc3lzLmFyZ3ZbMV0pLCBUcnVlLCBsaXopCiAgICBlbHNlOgogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oJ1hCTUMuUnVuUGx1Z2luKCcrdXJsKycpJykgICAgICAKCgojIyBUaGFua3MgdG8gZGFzY2hhY2thLCBhbiBlcGcgc2NyYXBlciBmb3IgaHR0cDovL2kudGVsZWJveS5jaC9wcm9ncmFtbS9zdGF0aW9uX3NlbGVjdC5waHAKIyMgIGh0dHA6Ly9mb3J1bS54Ym1jLm9yZy9wb3N0LnBocD9wPTkzNjIyOCZwb3N0Y291bnQ9MTA3NgpkZWYgZ2V0ZXBnKGxpbmspOgogICAgICAgIHVybD11cmxsaWIudXJsb3BlbihsaW5rKQogICAgICAgIHNvdXJjZT11cmwucmVhZCgpCiAgICAgICAgdXJsLmNsb3NlKCkKICAgICAgICBzb3VyY2UyID0gc291cmNlLnNwbGl0KCJKZXR6dCIpCiAgICAgICAgc291cmNlMyA9IHNvdXJjZTJbMV0uc3BsaXQoJ3Byb2dyYW1tL2RldGFpbC5waHA/Y29uc3RfaWQ9JykKICAgICAgICBzb3VyY2V1aHJ6ZWl0ID0gc291cmNlM1sxXS5zcGxpdCgnPGJyIC8+PGEgaHJlZj0iLycpCiAgICAgICAgbm93dGltZSA9IHNvdXJjZXVocnplaXRbMF1bNDA6bGVuKHNvdXJjZXVocnplaXRbMF0pXQogICAgICAgIHNvdXJjZXRpdGxlID0gc291cmNlM1syXS5zcGxpdCgiPC9hPjwvcD48L2Rpdj4iKQogICAgICAgIG5vd3RpdGxlID0gc291cmNldGl0bGVbMF1bMTc6bGVuKHNvdXJjZXRpdGxlWzBdKV0KICAgICAgICBub3d0aXRsZSA9IG5vd3RpdGxlLmVuY29kZSgndXRmLTgnKQogICAgICAgIHJldHVybiAiICAtICIrbm93dGl0bGUrIiAtICIrbm93dGltZQoKCmRlZiBnZXRfZXBnKHVybCwgcmVnZXgpOgogICAgICAgIGRhdGEgPSBtYWtlUmVxdWVzdCh1cmwpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpdGVtID0gcmUuZmluZGFsbChyZWdleCwgZGF0YSlbMF0KICAgICAgICAgICAgcmV0dXJuIGl0ZW0KICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIGFkZG9uX2xvZygncmVnZXggZmFpbGVkJykKICAgICAgICAgICAgYWRkb25fbG9nKHJlZ2V4KQogICAgICAgICAgICByZXR1cm4KCgp4Ym1jcGx1Z2luLnNldENvbnRlbnQoaW50KHN5cy5hcmd2WzFdKSwgJ21vdmllcycpCgp0cnk6CiAgICB4Ym1jcGx1Z2luLmFkZFNvcnRNZXRob2QoaW50KHN5cy5hcmd2WzFdKSwgeGJtY3BsdWdpbi5TT1JUX01FVEhPRF9VTlNPUlRFRCkKZXhjZXB0OgogICAgcGFzcwp0cnk6CiAgICB4Ym1jcGx1Z2luLmFkZFNvcnRNZXRob2QoaW50KHN5cy5hcmd2WzFdKSwgeGJtY3BsdWdpbi5TT1JUX01FVEhPRF9MQUJFTCkKZXhjZXB0OgogICAgcGFzcwp0cnk6CiAgICB4Ym1jcGx1Z2luLmFkZFNvcnRNZXRob2QoaW50KHN5cy5hcmd2WzFdKSwgeGJtY3BsdWdpbi5TT1JUX01FVEhPRF9EQVRFKQpleGNlcHQ6CiAgICBwYXNzCnRyeToKICAgIHhibWNwbHVnaW4uYWRkU29ydE1ldGhvZChpbnQoc3lzLmFyZ3ZbMV0pLCB4Ym1jcGx1Z2luLlNPUlRfTUVUSE9EX0dFTlJFKQpleGNlcHQ6CiAgICBwYXNzCgpwYXJhbXM9Z2V0X3BhcmFtcygpCgp1cmw9Tm9uZQpuYW1lPU5vbmUKbW9kZT1Ob25lCnBsYXlsaXN0PU5vbmUKaWNvbmltYWdlPU5vbmUKZmFuYXJ0PUZBTkFSVApwbGF5bGlzdD1Ob25lCmZhdl9tb2RlPU5vbmUKcmVnZXhzPU5vbmUKCnRyeToKICAgIHVybD11cmxsaWIudW5xdW90ZV9wbHVzKHBhcmFtc1sidXJsIl0pLmRlY29kZSgndXRmLTgnKQpleGNlcHQ6CiAgICBwYXNzCnRyeToKICAgIG5hbWU9dXJsbGliLnVucXVvdGVfcGx1cyhwYXJhbXNbIm5hbWUiXSkKZXhjZXB0OgogICAgcGFzcwp0cnk6CiAgICBpY29uaW1hZ2U9dXJsbGliLnVucXVvdGVfcGx1cyhwYXJhbXNbImljb25pbWFnZSJdKQpleGNlcHQ6CiAgICBwYXNzCnRyeToKICAgIGZhbmFydD11cmxsaWIudW5xdW90ZV9wbHVzKHBhcmFtc1siZmFuYXJ0Il0pCmV4Y2VwdDoKICAgIHBhc3MKdHJ5OgogICAgbW9kZT1pbnQocGFyYW1zWyJtb2RlIl0pCmV4Y2VwdDoKICAgIHBhc3MKdHJ5OgogICAgcGxheWxpc3Q9ZXZhbCh1cmxsaWIudW5xdW90ZV9wbHVzKHBhcmFtc1sicGxheWxpc3QiXSkucmVwbGFjZSgnfHwnLCcsJykpCmV4Y2VwdDoKICAgIHBhc3MKdHJ5OgogICAgZmF2X21vZGU9aW50KHBhcmFtc1siZmF2X21vZGUiXSkKZXhjZXB0OgogICAgcGFzcwp0cnk6CiAgICByZWdleHM9cGFyYW1zWyJyZWdleHMiXQpleGNlcHQ6CiAgICBwYXNzCgphZGRvbl9sb2coIk1vZGU6ICIrc3RyKG1vZGUpKQppZiBub3QgdXJsIGlzIE5vbmU6CiAgICBhZGRvbl9sb2coIlVSTDogIitzdHIodXJsLmVuY29kZSgndXRmLTgnKSkpCmFkZG9uX2xvZygiTmFtZTogIitzdHIobmFtZSkpCgppZiBtb2RlPT1Ob25lOgogICAgYWRkb25fbG9nKCJJbmRleCIpCiAgICBTS2luZGV4KCkJCgplbGlmIG1vZGU9PTE6CiAgICBhZGRvbl9sb2coImdldERhdGEiKQogICAgZ2V0RGF0YSh1cmwsZmFuYXJ0KQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQoKZWxpZiBtb2RlPT0yOgogICAgYWRkb25fbG9nKCJnZXRDaGFubmVsSXRlbXMiKQogICAgZ2V0Q2hhbm5lbEl0ZW1zKG5hbWUsdXJsLGZhbmFydCkKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKCmVsaWYgbW9kZT09MzoKICAgIGFkZG9uX2xvZygiZ2V0U3ViQ2hhbm5lbEl0ZW1zIikKICAgIGdldFN1YkNoYW5uZWxJdGVtcyhuYW1lLHVybCxmYW5hcnQpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCgplbGlmIG1vZGU9PTQ6CiAgICBhZGRvbl9sb2coImdldEZhdm9yaXRlcyIpCiAgICBnZXRGYXZvcml0ZXMoKQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQoKZWxpZiBtb2RlPT01OgogICAgYWRkb25fbG9nKCJhZGRGYXZvcml0ZSIpCiAgICB0cnk6CiAgICAgICAgbmFtZSA9IG5hbWUuc3BsaXQoJ1xcICcpWzFdCiAgICBleGNlcHQ6CiAgICAgICAgcGFzcwogICAgdHJ5OgogICAgICAgIG5hbWUgPSBuYW1lLnNwbGl0KCcgIC0gJylbMF0KICAgIGV4Y2VwdDoKICAgICAgICBwYXNzCiAgICBhZGRGYXZvcml0ZShuYW1lLHVybCxpY29uaW1hZ2UsZmFuYXJ0LGZhdl9tb2RlKQoKZWxpZiBtb2RlPT02OgogICAgYWRkb25fbG9nKCJybUZhdm9yaXRlIikKICAgIHRyeToKICAgICAgICBuYW1lID0gbmFtZS5zcGxpdCgnXFwgJylbMV0KICAgIGV4Y2VwdDoKICAgICAgICBwYXNzCiAgICB0cnk6CiAgICAgICAgbmFtZSA9IG5hbWUuc3BsaXQoJyAgLSAnKVswXQogICAgZXhjZXB0OgogICAgICAgIHBhc3MKICAgIHJtRmF2b3JpdGUobmFtZSkKCmVsaWYgbW9kZT09NzoKICAgIGFkZG9uX2xvZygiYWRkU291cmNlIikKICAgIGFkZFNvdXJjZSh1cmwpCgplbGlmIG1vZGU9PTg6CiAgICBhZGRvbl9sb2coInJtU291cmNlIikKICAgIHJtU291cmNlKG5hbWUpCgplbGlmIG1vZGU9PTk6CiAgICBhZGRvbl9sb2coImRvd25sb2FkX2ZpbGUiKQogICAgZG93bmxvYWRfZmlsZShuYW1lLCB1cmwpCgplbGlmIG1vZGU9PTEwOgogICAgYWRkb25fbG9nKCJnZXRDb21tdW5pdHlTb3VyY2VzIikKICAgIGdldENvbW11bml0eVNvdXJjZXMoKQoKZWxpZiBtb2RlPT0xMToKICAgIGFkZG9uX2xvZygiYWRkU291cmNlIikKICAgIGFkZFNvdXJjZSh1cmwpCgplbGlmIG1vZGU9PTEyOgogICAgYWRkb25fbG9nKCJzZXRSZXNvbHZlZFVybCIpCiAgICBpZiBub3QgdXJsLnN0YXJ0c3dpdGgoInBsdWdpbjovL3BsdWdpbiIpIG9yIG5vdCBhbnkoeCBpbiB1cmwgZm9yIHggaW4gZ19pZ25vcmVTZXRSZXNvbHZlZCk6I25vdCB1cmwuc3RhcnRzd2l0aCgicGx1Z2luOi8vcGx1Z2luLnZpZGVvLmY0bVRlc3RlciIpIDoKICAgICAgICBpdGVtID0geGJtY2d1aS5MaXN0SXRlbShwYXRoPXVybCkKICAgICAgICB4Ym1jcGx1Z2luLnNldFJlc29sdmVkVXJsKGludChzeXMuYXJndlsxXSksIFRydWUsIGl0ZW0pCiAgICBlbHNlOgogICAgICAgIHByaW50ICdOb3Qgc2V0dGluZyBzZXRSZXNvbHZlZFVybCcKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCdYQk1DLlJ1blBsdWdpbignK3VybCsnKScpCgoKZWxpZiBtb2RlPT0xMzoKICAgIGFkZG9uX2xvZygicGxheV9wbGF5bGlzdCIpCiAgICBwbGF5X3BsYXlsaXN0KG5hbWUsIHBsYXlsaXN0KQoKZWxpZiBtb2RlPT0xNDoKICAgIGFkZG9uX2xvZygiZ2V0X3htbF9kYXRhYmFzZSIpCiAgICBnZXRfeG1sX2RhdGFiYXNlKHVybCkKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKCmVsaWYgbW9kZT09MTU6CiAgICBhZGRvbl9sb2coImJyb3dzZV94bWxfZGF0YWJhc2UiKQogICAgZ2V0X3htbF9kYXRhYmFzZSh1cmwsIFRydWUpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCgplbGlmIG1vZGU9PTE2OgogICAgYWRkb25fbG9nKCJicm93c2VfY29tbXVuaXR5IikKICAgIGdldENvbW11bml0eVNvdXJjZXMoVHJ1ZSkKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKCmVsaWYgbW9kZT09MTc6CiAgICBhZGRvbl9sb2coImdldFJlZ2V4UGFyc2VkIikKICAgIHVybCxzZXRyZXNvbHZlZCA9IGdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgdXJsKQogICAgaWYgdXJsOgogICAgICAgIHBsYXlzZXRyZXNvbHZlZCh1cmwsbmFtZSxpY29uaW1hZ2Usc2V0cmVzb2x2ZWQpCiAgICBlbHNlOgogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKEdlbi1YLEZhaWxlZCB0byBleHRyYWN0IHJlZ2V4LiAtICIrInRoaXMiKyIsNDAwMCwiK2ljb24rIikiKQplbGlmIG1vZGU9PTE4OgogICAgYWRkb25fbG9nKCJ5b3V0dWJlZGwiKQogICAgdHJ5OgogICAgICAgIGltcG9ydCB5b3V0dWJlZGwKICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oR2VuLVgsUGxlYXNlIFtDT0xPUiB5ZWxsb3ddaW5zdGFsbCB0aGUgWW91dHViZSBBZGRvblsvQ09MT1JdIG1vZHVsZSAsMTAwMDAsIiIpIikKICAgIHN0cmVhbV91cmw9eW91dHViZWRsLnNpbmdsZV9ZRCh1cmwpCiAgICBwbGF5c2V0cmVzb2x2ZWQoc3RyZWFtX3VybCxuYW1lLGljb25pbWFnZSkKZWxpZiBtb2RlPT0xOToKCWFkZG9uX2xvZygiR2VuZXNpc2NvbW1vbnJlc29sdmVycyIpCglwbGF5c2V0cmVzb2x2ZWQgKHVybHNvbHZlcih1cmwpLG5hbWUsaWNvbmltYWdlLFRydWUpCQoKZWxpZiBtb2RlPT0yMToKICAgIGFkZG9uX2xvZygiZG93bmxvYWQgY3VycmVudCBmaWxlIHVzaW5nIHlvdXR1YmUtZGwgc2VydmljZSIpCiAgICB5dGRsX2Rvd25sb2FkKCcnLG5hbWUsJ3ZpZGVvJykKZWxpZiBtb2RlPT0yMzoKICAgIGFkZG9uX2xvZygiZ2V0IGluZm8gdGhlbiBkb3dubG9hZCIpCiAgICB5dGRsX2Rvd25sb2FkKHVybCxuYW1lLCd2aWRlbycpIAplbGlmIG1vZGU9PTI0OgogICAgYWRkb25fbG9nKCJBdWRpbyBvbmx5IHlvdXR1YmUgZG93bmxvYWQiKQogICAgeXRkbF9kb3dubG9hZCh1cmwsbmFtZSwnYXVkaW8nKQplbGlmIG1vZGU9PTI1OgogICAgYWRkb25fbG9nKCJZb3VUdWJlL0RNb3Rpb24iKQogICAgc2VhcmNoKHVybCkKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKZWxpZiBtb2RlPT0yNjoKICAgIGFkZG9uX2xvZygiWW91VHViZS9ETW90aW9uIEZyb20gU2VhcmNoIEhpc3RvcnkiKQogICAgbmFtZSA9IG5hbWUuc3BsaXQoJzonKQogICAgc2VhcmNoKHVybCxzZWFyY2hfdGVybT1uYW1lWzFdKQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQplbGlmIG1vZGU9PTI3OgogICAgYWRkb25fbG9nKCJVc2luZyBJTURCIGlkIHRvIHBsYXkgaW4gUHVsc2FyIikKICAgIHB1bHNhcklNREI9c2VhcmNoKHVybCkKICAgIHhibWMuUGxheWVyKCkucGxheShwdWxzYXJJTURCKSAKZWxpZiBtb2RlPT0zMDoKICAgIEdldFN1YmxpbmtzKG5hbWUsdXJsLGljb25pbWFnZSxmYW5hcnQpCmVsaWYgbW9kZT09MzE6CiAgICBXaXpIRE1lbnUodXJsLGljb25pbWFnZSxmYW5hcnQpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCmVsaWYgbW9kZT09MzI6CglXaXpfR2V0X3VybCh1cmwpCgl4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCQoJCmVsaWYgbW9kZT09NDA6CiAgICBTZWFyY2hDaGFubmVscygpCiAgICBTZXRWaWV3VGh1bWJuYWlsKCkKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKZWxpZiBtb2RlID09IDQxIDogCiAgICBTZWFyY2hfaW5wdXQodXJsKQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQoJCmVsaWYgbW9kZT09NTM6CiAgICBhZGRvbl9sb2coIlJlcXVlc3RpbmcgSlNPTi1SUEMgSXRlbXMiKQogICAgcGx1Z2lucXVlcnlieUpTT04odXJsKQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQ==')
